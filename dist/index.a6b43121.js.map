{"mappings":"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","sources":["src/utilities/TemplateGen.ts","src/utilities/eventbus.ts","src/elements/block.ts","src/utilities/validation.ts","src/elements/form-block.ts","src/elements/input-block.ts","src/elements/button-block.ts","src/utilities/route.ts","src/utilities/Router.ts","src/utilities/createRouter.ts","src/utilities/HTTPTransport.ts","src/api/apiBase.ts","src/api/apiAuthorization.ts","src/utilities/effects.ts","src/controllers/AuthentificationController2.ts","src/pages/authorization.ts","src/elements/textarea-block.ts","src/elements/select-block.ts","src/elements/option-block.ts","src/elements/link-block.ts","src/elements/menu-link-block.ts","src/elements/chat-wrapper.ts","src/elements/chat-block.ts","src/elements/chat-name.ts","src/elements/files-name.ts","src/elements/message-block.ts","src/elements/modal-block.ts","src/api/apiChats.ts","src/controllers/ChatController.ts","src/api/apiUser.ts","src/controllers/UsersController.ts","src/controllers/MessengerController.ts","src/pages/chat.ts","src/pages/registration.ts","src/elements/image-input-block.ts","src/pages/profile.ts","src/elements/error-block.ts","src/pages/error.ts","src/main.ts"],"sourcesContent":["//Генератор шаблонов\r\n//На вход подаётся строка с макросами в скобках {{}} и объект со значениями макросов\r\n//Пример:\r\n/*\r\n\tСтрока: '<div class=\"{{className}}\"></div>'\r\n\tОбъект: {className: 'test-class'}\r\n*/\r\n\r\nexport default class TemplateGen {\r\n\r\n\treadonly TEMPLATE_REGULAR = /\\{\\{(.*?)\\}\\}/;\r\n\r\n\treadonly templateBlock: string = \"\";\r\n\r\n\tconstructor(templateBlock: string) {\r\n\t\tthis.templateBlock = templateBlock;\r\n\t}\r\n\r\n\tgenerateTemplate(template: Record<string, unknown>): string {\r\n\t\tif (template && this.templateBlock){\r\n\t\t\treturn this.changeTemplateKeys(template, this.templateBlock, this.TEMPLATE_REGULAR);\r\n\t\t}\r\n\t\treturn \"\";\r\n\t}\r\n\r\n\tchangeTemplateKeys(template, tmp, templateRegular): string {\r\n\t\tconst templateKeys = templateRegular.exec(tmp);\r\n\t\tif (templateKeys && templateKeys[1]){\r\n\t\t\tconst templateKey = templateKeys[1];\r\n\t\t\tif (templateKey in template){\r\n\t\t\t\tlet templateValue = template[templateKey];\r\n\t\t\t\tif ((typeof templateValue != \"object\") && (typeof templateValue != \"function\")){\r\n\t\t\t\t\ttemplateValue = templateValue.toString();\r\n\t\t\t\t} else {\r\n\t\t\t\t\ttemplateValue = \"\";\r\n\t\t\t\t}\r\n\t\t\t\ttmp = tmp.replace(templateKeys[0], templateValue);\r\n\t\t\t} else {\r\n\t\t\t\ttmp = tmp.replace(templateKeys[0], \"\");\r\n\t\t\t}\t\r\n\t\t}\r\n\t\tif (templateRegular.exec(tmp)){\r\n\t\t\treturn this.changeTemplateKeys(template, tmp, templateRegular);\r\n\t\t} else {\r\n\t\t\treturn tmp;\r\n\t\t}\r\n\t}\r\n}","//Шина событий\r\n\r\nexport class EventBus {\r\n\tlisteners: Record<string, Array<() => void>>;\r\n\r\n\tconstructor() {\r\n\t\tthis.listeners = {};\r\n\t}\r\n\r\n\ton(event: string, callback: () => void): void {\r\n\t\tif (!this.listeners[event]) {\r\n\t\t\tthis.listeners[event] = [];\r\n\t\t}\r\n\t\tthis.listeners[event].push(callback);\r\n\t}\r\n\r\n\toff(event: string, callback: () => void): void {\r\n\t\tif (!this.listeners[event]) {\r\n\t\t\tthrow new Error(`Нет события: ${event}`);\r\n\t\t}\r\n\r\n\t\tthis.listeners[event] = this.listeners[event].filter(\r\n\t\t\tlistener => listener !== callback\r\n\t\t);\r\n\t}\r\n\r\n\temit(event: string, ...args: unknown[]) {\r\n\t\tif (!this.listeners[event]) {\r\n\t\t\tthrow new Event(`Нет события: ${event}`);\r\n\t\t}\r\n\r\n\t\tthis.listeners[event].forEach(function (listener: (...args: unknown[]) => void) {\r\n\t\t\tlistener(...args);\r\n\t\t});\r\n\t}\r\n}","//Блоки - общее\r\nimport TemplateGen from '../utilities/TemplateGen';\r\nimport {EventBus} from '../utilities/eventbus';\r\n\r\nexport type PropsType = Record<string, any>;\r\n\r\ntype BlockMetaData = {\r\n\ttagName: string,\r\n\tprops: Record<string, unknown>\r\n}\r\n\r\nexport default class Block {\r\n\tstatic EVENTS = {\r\n\t\tINIT: \"init\",\r\n\t\tFLOW_CDM: \"flow:component-did-mount\",\r\n\t\tFLOW_CDU: \"flow:component-did-update\",\r\n\t\tFLOW_RENDER: \"flow:render\"\r\n\t};\r\n\r\n\tnoTagName: false;\r\n\ttemplate: string;\r\n\tprops: PropsType;\r\n\teventBus: () => EventBus;\r\n\r\n\t_element: HTMLElement = null;\r\n\t_meta: BlockMetaData;\r\n\r\n\tconstructor(params: Record<string, unknown>, template: string, noTagName: boolean, tagName = 'div') {\r\n\t\tthis.template = template;\r\n\t\tthis.noTagName = noTagName;\r\n\t\tconst eventBus = new EventBus();\r\n\t\tthis._meta = {\r\n\t\t\ttagName,\r\n\t\t\tparams\r\n\t\t};\r\n\r\n\t\tthis.props = this._makePropsProxy(params);\r\n\r\n\t\tthis.eventBus = () => eventBus;\r\n\r\n\t\tthis._registerEvents(eventBus);\r\n\t\teventBus.emit(Block.EVENTS.INIT);\r\n\t}\r\n\r\n\t_registerEvents(eventBus) {\r\n\t\teventBus.on(Block.EVENTS.INIT, this.init.bind(this));\r\n\t\teventBus.on(Block.EVENTS.FLOW_CDM, this._componentDidMount.bind(this));\r\n\t\teventBus.on(Block.EVENTS.FLOW_CDU, this._componentDidUpdate.bind(this));\r\n\t\teventBus.on(Block.EVENTS.FLOW_RENDER, this._render.bind(this));\r\n\t}\r\n\r\n\t_createResources(): void {\r\n\t\tconst { tagName } = this._meta;\r\n\t\tthis._element = this._createDocumentElement(tagName);\r\n\t\tthis._element;\r\n\t}\r\n\r\n\tinit(): void {\r\n\t\tthis._createResources();\r\n\t\tthis.eventBus().emit(Block.EVENTS.FLOW_CDM);\r\n\t}\r\n\r\n\t_componentDidMount(): void {\r\n\t\tthis.componentDidMount();\r\n\t\tthis.eventBus().emit(Block.EVENTS.FLOW_RENDER);\r\n\t}\r\n\r\n\tcomponentDidMount(): void {\r\n\t\treturn;\r\n\t}\r\n\r\n\tdispatchComponentDidMoun() {return;}\r\n\r\n\t_componentDidUpdate(oldProps: Record<string, unknown>, newProps: Record<string, unknown>): void {\r\n\t\tconst response = this.componentDidUpdate(oldProps, newProps);\r\n\t\tif (!response) {\r\n\t\t\treturn;\r\n\t\t}\r\n\t\tthis._render();\r\n\t}\r\n\r\n\tcomponentDidUpdate(oldProps: Record<string, unknown>, newProps: Record<string, unknown>,): boolean {\r\n\t\treturn true;\r\n\t}\r\n\r\n\tsetProps = nextProps => {\r\n\t\tif (!nextProps) {\r\n\t\t\treturn;\r\n\t\t}\r\n\t\tObject.assign(this.props, nextProps);\r\n\t};\r\n\r\n\tget element(): HTMLElement {\r\n\t\treturn this._element;\r\n\t}\r\n\r\n\t_render() {\r\n\t\tconst block = this.render();\r\n\t\tif (this._element){\r\n\t\t\tthis._element.innerHTML = block;\r\n\t\t}\r\n\t}\r\n\r\n\trender(): string {\r\n\t\treturn new TemplateGen(this.template).generateTemplate(this.props);\r\n\t}\r\n\r\n\tgetContent(): HTMLElement {\r\n\t\treturn this.element;\r\n\t}\r\n\r\n\t_makePropsProxy(props: Record<string, unknown>): Record<string, unknown> {\r\n\t\tconst self = this;\r\n\r\n\t\treturn new Proxy(props, {\r\n\t\t\tget(target, property) {\r\n\t\t\t\tif (typeof target[property] == 'function'){\r\n\t\t\t\t\treturn target[property].bind(target);\r\n\t\t\t\t} else {\r\n\t\t\t\t\treturn target[property];\r\n\t\t\t\t}\r\n\t\t\t},\r\n\t\t\tset(target, property, value) {\r\n\t\t\t\ttarget[property] = value;\r\n\t\t\t\tself.eventBus().emit(Block.EVENTS.FLOW_CDU, {...target}, target);\r\n\t\t\t\treturn true;\r\n\t\t\t},\r\n\t\t\tdeleteProperty() {\r\n\t\t\t\tthrow new Error(\"Нет доступа\");\r\n\t\t\t}\r\n\t\t});\r\n\t}\r\n\r\n\t_createDocumentElement(tagName): HTMLElement {\r\n\t\treturn document.createElement(tagName);\r\n\t}\r\n\r\n\tshow(): void {\r\n\t\tconst element = this.getContent();\r\n\t\tif (element){\r\n\t\t\telement.style.display = \"block\";\r\n\t\t}\t\t\r\n\t}\r\n\r\n\thide(): void {\r\n\t\tconst element = this.getContent();\r\n\t\tif (element){\r\n\t\t\telement.style.display = \"none\";\r\n\t\t}\r\n\t}\r\n\r\n\tdestroy() {\r\n\t\tthis._element.remove();\r\n\t\tthis.onDestroy();\r\n\t}\r\n\r\n\tonDestroy() {}\r\n\r\n\tinsertBlock(element: string, clean: boolean, prepend: boolean): Record<string, HTMLElement> {\r\n\t\tlet inner = this.getContent(); //new DOMParser().parseFromString(new TemplateGen(this.template).generateTemplate(this.props), \"text/html\").getElementsByTagName(\"body\")[0].childNodes[0];\r\n\t\tconst wrapper = document.querySelector(element);\r\n\t\tif (!inner || !wrapper) return {};\r\n\t\tif (this.noTagName){\r\n\t\t\tinner = inner.children[0];\r\n\t\t}\r\n\t\tfor (let el of wrapper.querySelectorAll('[id=\"\"]')) {\r\n\t\t\tel.removeAttribute('id');\r\n\t\t}\r\n\t\tif (clean){\r\n\t\t\twrapper.innerHTML = \"\";\r\n\t\t}\r\n\t\tif (prepend){\r\n\t\t\twrapper.prepend(inner);\r\n\t\t} else {\r\n\t\t\twrapper.appendChild(inner);\r\n\t\t}\r\n\t\treturn {\r\n\t\t\tinner: inner,\r\n\t\t\twrapper: wrapper\r\n\t\t};\r\n\t}\r\n}","//Валидация\r\n\r\nconst defaultValidationErrorMessage = \"Возникла ошибка при заполнении формы. Пожалуйста, проверьте введённые данные.\";\r\nconst repeatPasswordErrorMessage = \"Пароли не совпадают.\";\r\nconst requiredFieldsErrorMessage = \"Не все обязательные поля заполнены.\";\r\nconst requiredFieldMessage = \"Обязательное поле.\";\r\n\r\nconst validationRegex: Record<string, RegExp> = {\r\n\temail: new RegExp(/^([A-Za-z0-9_\\.-]+)@([A-Za-z0-9_\\.-]+)\\.([a-z\\.]{2,6})$/),\r\n\tlogin: new RegExp(/^[A-Za-z0-9_\\.-]{3,20}$/),\r\n\tname: new RegExp(/^[A-ZА-Я][a-zA-Zа-яА-Я-]+$/),\r\n\tphone: new RegExp(/^\\+?\\d{10,15}$/),\r\n\tpassword: new RegExp(/^((?=.*?[A-Z])(?=.*?[0-9])\\S{8,40})\\S$/),\r\n};\r\n\r\nexport const validValue = function(input: HTMLInputElement): boolean {\r\n\tconst validationType = input.getAttribute(\"data-validation-type\");\r\n\tconst errorText = input.getAttribute(\"data-error-text\");\r\n\r\n\tconst value = input.value;\r\n\tconst regex = validationRegex[validationType];\r\n\r\n\tconst inputWrapper = input.parentElement;\r\n\tconst errorBlock = inputWrapper.querySelector(\".error-text-block\");\r\n\r\n\tif (regex && !regex.test(value)) {\r\n\t\tinputWrapper.classList.add('error-input');\r\n\t\tif (errorBlock){\r\n\t\t\tif (errorText){\r\n\t\t\t\terrorBlock.textContent = errorText;\r\n\t\t\t} else {\r\n\t\t\t\terrorBlock.textContent = defaultValidationErrorMessage;\r\n\t\t\t}\r\n\t\t}\t\t\r\n\t\treturn false;\r\n\t}\r\n\tinputWrapper.classList.remove('error-input');\r\n\tif (errorBlock){\r\n\t\terrorBlock.textContent = \"\";\r\n\t}\r\n\treturn true;\r\n};\r\n\r\nexport const validForm = function(form: HTMLFormElement): boolean {\r\n\tconst formBlocks = form.querySelectorAll('.form-block');\r\n\tconst infoBlock = form.querySelector(\".info-block\");\r\n\r\n\tlet isFormValid = true;\r\n\tlet password = \"\", repeatPassword = \"\";\r\n\r\n\tif (infoBlock){\r\n\t\tinfoBlock.textContent = \"\";\r\n\t}\r\n\r\n\tformBlocks.forEach(function(formBlock) {\r\n\t\tconst input = formBlock.querySelector(\"input\") || formBlock.querySelector(\"textarea\") || formBlock.querySelector(\"select\");\r\n\t\tif (input){\r\n\t\t\tconst errorText = input.getAttribute(\"data-error-text\");\r\n\r\n\t\t\tif (!formBlock.classList.contains(\"none-block\") && !validValue(input)) {\r\n\t\t\t\tisFormValid = false;\r\n\t\t\t}\r\n\t\t\tif (!input.value && input.getAttribute(\"data-required\") && !formBlock.classList.contains(\"none-block\")){\r\n\t\t\t\tisFormValid = false;\r\n\r\n\t\t\t\tconst errorWrapper = input.closest(\".wrapper-element\");\r\n\t\t\t\tif (errorWrapper) {\r\n\t\t\t\t\terrorWrapper.classList.add(\"error-input\");\r\n\r\n\t\t\t\t\tif (errorText){\r\n\t\t\t\t\t\terrorWrapper.querySelector(\".error-text-block\").textContent = errorText;\r\n\t\t\t\t\t} else {\r\n\t\t\t\t\t\terrorWrapper.querySelector(\".error-text-block\").textContent = requiredFieldMessage;\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\r\n\t\t\t\tif (infoBlock){\r\n\t\t\t\t\tinfoBlock.textContent = requiredFieldsErrorMessage;\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t\tif (input.name == \"password\"){\r\n\t\t\t\tpassword = input.value;\r\n\t\t\t}\r\n\t\t\tif (input.name == \"repeat_password\"){\r\n\t\t\t\trepeatPassword = input.value;\r\n\t\t\t}\r\n\t\t}\r\n\t});\r\n\t\r\n\tif (password && repeatPassword && (password != repeatPassword)){\r\n\t\tisFormValid = false;\r\n\t\tinfoBlock.textContent = repeatPasswordErrorMessage;\r\n\t}\t\r\n\treturn isFormValid;\r\n};","//Блок input\r\n\r\nimport Block from '../elements/block';\r\nimport {validForm} from \"../utilities/validation\";\r\n\r\nconst formBlockTemplate = `\r\n\t<div class=\"reg-form-page\">\r\n\t\t<div class=\"reg-form-wrapper\">\r\n\t\t\t<h2>{{title}}</h2>\r\n\t\t\t<form class=\"reg-form\">\r\n\t\t\t\t<fieldset>\r\n\t\t\t\t\t<div class=\"reg-form-fieldset\"></div>\r\n\t\t\t\t\t<div class=\"form-block info-block\" id=\"formInfoBlock\"></div>\r\n\t\t\t\t\t<div class=\"form-block buttons-wrapper\"></div>\r\n\t\t\t\t</fieldset>\r\n\t\t\t</form>\r\n\t\t</div>\r\n\t</div>`;\r\n\r\nexport type FormParams = {\r\n\ttitle: string\r\n};\r\n\r\nexport default class Form extends Block {\r\n\r\n\tconstructor(params: FormParams, template: string) {\r\n\t\tif (!template){\r\n\t\t\ttemplate = formBlockTemplate;\r\n\t\t}\r\n\t\tsuper(params, template);\r\n\t}\r\n}\r\n\r\nexport function onSubmitForm(selector: string, callback): void {\r\n\tconst form: HTMLFormElement = document.querySelector(selector);\r\n\tif (!form) return;\r\n\r\n\tif (validForm(form)){\r\n\t\tconst data: FormData = new FormData(form);\r\n\t\tconsole.log(...data);\r\n\t\tif (callback){\r\n\t\t\tlet obj : Record<any, any> = {};\r\n\t\t\tfor (let key of data.keys()) {\r\n\t\t\t\tobj[key] = data.get(key);\r\n\t\t\t}\r\n\t\t\tcallback(obj);\r\n\t\t}\r\n\t}\r\n\treturn;\r\n}","//Блок input\r\n\r\nimport Block from '../elements/block';\r\nimport {validValue} from \"../utilities/validation\";\r\n\r\nconst inputBlockTemplate = `\r\n\t<div class=\"form-block {{classList}}\">\r\n\t\t<label class=\"form-label\" for=\"{{id}}\">{{label}}</label>\r\n\t\t<div class=\"input-wrapper wrapper-element\">\r\n\t\t\t<input class=\"form-control input-styles\" data-required=\"{{required}}\" data-error-text=\"{{errorText}}\" \r\n\t\t\tdata-validation-type=\"{{validationType}}\" id=\"{{id}}\" type=\"{{type}}\" value=\"{{value}}\" name=\"{{name}}\">\r\n\t\t\t<div class=\"error-text-block\"></div>\r\n\t\t</div>\r\n\t</div>`;\r\n\r\nexport type InputParams = {\r\n\telement: string,\r\n\tid: string,\r\n\tlabel: string,\r\n\tvalue: string,\r\n\ttype: string,\r\n\tname: string,\r\n\trequired: boolean,\r\n\terrorText: string,\r\n\tvalidationType: string,\r\n\tclassList: string,\r\n\tonBlur: (event: Event) => void\r\n}\r\n\r\nexport default class Input extends Block {\r\n\t//params: InputParams\r\n\r\n\tconstructor(params: InputParams, template: string) {\r\n\t\tif (!template){\r\n\t\t\ttemplate = inputBlockTemplate;\r\n\t\t}\r\n\t\tsuper(params, template);\r\n\t}\r\n\r\n\tinsertBlock(element: string, clean: boolean): Record<string, HTMLElement> {\r\n\r\n\t\tconst insertedBlock = super.insertBlock(element, clean);\r\n\t\tconst $this = this;\r\n\t\tif (insertedBlock.inner){\r\n\t\t\tconst input = insertedBlock.inner.querySelector('input');\r\n\t\t\tif (input){\r\n\t\t\t\tinput.addEventListener('focus', function(){\r\n\t\t\t\t\tthis.classList.add('focus-input');\r\n\t\t\t\t});\r\n\t\t\t\tinput.addEventListener('blur', function(event){\r\n\t\t\t\t\tthis.classList.remove('focus-input');\r\n\t\t\t\t\t$this.props.onBlur(event);\r\n\t\t\t\t\tvalidValue(this);\r\n\t\t\t\t});\r\n\t\t\t}\t\t\t\r\n\t\t}\r\n\t\treturn insertedBlock;\r\n\t}\r\n}","//Блок кнопки\r\n\r\nimport Block from '../elements/block';\r\n\r\nconst buttonBlockTemplate = `<button id=\"{{id}}\" class=\"button-link {{classes}}\">{{name}}</button>`;\r\n\r\nexport type ButtonParams = {\r\n\telement: string,\r\n\tid: string,\r\n\tclasses: string,\r\n\tname: string,\r\n\tonClick: (event: Event) => void\r\n}\r\n\r\nexport default class Button extends Block {\r\n\r\n\tconstructor(params: ButtonParams, template: string) {\r\n\t\tif (!template){\r\n\t\t\ttemplate = buttonBlockTemplate;\r\n\t\t}\r\n\t\tsuper(params, template);\r\n\t}\r\n\r\n\tinsertBlock(element: string, clean: boolean): Record<string, HTMLElement> {\r\n\t\tconst insertedBlock = super.insertBlock(element, clean);\r\n\t\tif (insertedBlock.inner){\r\n\t\t\tinsertedBlock.inner.addEventListener('click', this.props.onClick);\r\n\t\t\tinsertedBlock.inner.addEventListener('touchstart', this.props.onClick);\t\t\t\r\n\t\t}\r\n\t\treturn insertedBlock;\r\n\t}\r\n}","import Block, { PropsType } from '../elements/block';\r\n\r\nfunction isEqual(lhs: string, rhs: string) {\r\n\treturn lhs === rhs;\r\n}\r\n\r\nfunction renderBlock(query: string, block: Block) {\r\n\tconst root = document.querySelector(query);\r\n\tif (root && block) {\r\n\t\t//root.append(block.getContent());\r\n\t\treturn root;\r\n\t}\r\n\treturn false;\r\n}\r\n\r\nclass Route {\r\n\tpathname: string;\r\n\tblockClass: typeof Block;\r\n\tblock: Block | null;\r\n\tprops: PropsType;\r\n\r\n\tconstructor(pathname: string, view: typeof Block, props: PropsType) {\r\n\t\tthis.pathname = pathname;\r\n\t\tthis.blockClass = view;\r\n\t\tthis.block = null;\r\n\t\tthis.props = props;\r\n\t}\r\n\r\n\tgetPathname() {\r\n\t\treturn this.pathname;\r\n\t}\r\n\r\n\tleave() {\r\n\t\tif (this.block && (Object.keys(this.block).length)) {\r\n\t\t\tthis.block.destroy();\r\n\t\t}\r\n\t}\r\n\r\n\tmatch(pathname: string) {\r\n\t\treturn isEqual(pathname, this.pathname);\r\n\t}\r\n\r\n\trender() {\r\n\t\t//if (!this.block) {\r\n\t\t\tthis.block = new this.blockClass();\r\n\t\t\trenderBlock(this.props.rootQuery, this.block);\r\n\t\t\treturn;\r\n\t\t//}\r\n\t\t//if (this.block && (Object.keys(this.block).length)) {\r\n\t\t//\tthis.block.show();\r\n\t\t//}\r\n\t}\r\n}\r\n\r\nexport default Route;","import Route from './route';\r\nimport Block from '../elements/block';\r\n\r\nclass Router {\r\n\tpublic routes: Route[];\r\n\tpublic history: History;\r\n\tprivate _currentRoute: Route | null;\r\n\tprivate _rootQuery: string;\r\n\tprivate _pathnames: string[];\r\n\tprivate _onRouteCallback: () => void;\r\n\tprivate _unprotectedPaths: `/${string}`[];\r\n\tstatic __instance: Router;\r\n\r\n\tconstructor(rootQuery: string) {\r\n\t\tif (Router.__instance) {\r\n\t\t\treturn Router.__instance;\r\n\t\t}\r\n\t\tthis.routes = [];\r\n\t\tthis._pathnames = [];\r\n\t\tthis._unprotectedPaths = [];\r\n\t\tthis.history = window.history;\r\n\t\tthis._currentRoute = null;\r\n\t\tthis._rootQuery = rootQuery;\r\n\t\tthis._onRouteCallback = () => {};\r\n\t\tRouter.__instance = this;\r\n\t}\r\n\r\n\tget currentRoute() {\r\n\t\treturn this._currentRoute;\r\n\t}\r\n\r\n\tpublic use(pathname: string, block: typeof Block) {\r\n\t\tconst route = new Route(pathname, block, { rootQuery: this._rootQuery });\r\n\t\tthis.routes.push(route);\r\n\t\tthis._pathnames.push(pathname);\r\n\t\treturn this;\r\n\t}\r\n\r\n\tprivate _hasRoute(pathname: string) {\r\n\t\tif (!this._pathnames.includes(pathname)) {\r\n\t\t\treturn '*';\r\n\t\t}\r\n\t\treturn pathname;\r\n\t}\r\n\r\n\tpublic start() {\r\n\t\t/*window.onpopstate = (() => {\r\n\t        this._onRoute(window.location.pathname);\r\n\t      }).bind(this);\r\n\t      this._onRoute(window.location.pathname);*/\r\n\t\twindow.onpopstate = () => {\r\n\t\tconst pathname = this._hasRoute(window.location.pathname);\r\n\t\t\tthis._onRoute(pathname);\r\n\t\t};\r\n\t\tconst pathname = this._hasRoute(window.location.pathname);\r\n\t\tthis._onRoute(pathname);\r\n\t}\r\n\r\n\tprivate _onRoute(pathname: string) {\r\n\t\tconst route = this.getRoute(pathname);\r\n\t\tif (!route) {\r\n\t\t\treturn;\r\n\t\t}\r\n\t\tif (this._currentRoute) {\r\n\t\t\tthis._currentRoute.leave();\r\n\t\t}\r\n\t\tthis._currentRoute = route;\r\n\t\troute.render();\r\n\t\tif (!this._unprotectedPaths.includes(pathname as `/${string}`)) {\r\n\t\t\tthis._onRouteCallback();\r\n\t\t}\r\n\t}\r\n\r\n\tpublic onRoute(callback: () => void) {\r\n\t\tthis._onRouteCallback = callback;\r\n\t\treturn this;\r\n\t}\r\n\r\n\tpublic setUnprotectedPaths(paths: `/${string}`[]) {\r\n\t\tthis._unprotectedPaths = paths;\r\n\t\treturn this;\r\n\t}\r\n\r\n\tpublic go(pathname: string) {\r\n\t\tthis.history.pushState({}, '', pathname);\r\n\t\tthis._onRoute(pathname);\r\n\t}\r\n\r\n\tpublic back() {\r\n\t\tthis.history.back();\r\n\t}\r\n\r\n\tpublic forward() {\r\n\t\tthis.history.forward();\r\n\t}\r\n\r\n\tpublic getRoute(pathname: string) {\r\n\t\treturn this.routes.find((route) => route.match(pathname));\r\n\t}\r\n\r\n\tpublic getLocationPathname() {\r\n\t\treturn window.location.pathname;\r\n\t}\r\n}\r\n\r\nexport default Router;","import Router from './Router';\r\n\r\nexport const router = new Router('#app');","//HTTPTransport\r\nconst METHODS = {\r\n\tGET: 'GET',\r\n\tPOST: 'POST',\r\n\tPUT: 'PUT',\r\n\tDELETE: 'DELETE',\r\n};\r\n\r\nfunction queryStringify(data) {\r\n\tlet result: string = \"\";\r\n\tif (typeof data == 'object') {\r\n\t\tresult = \"\"\r\n\t\tfor (let key in data){\r\n\t\t\tif (result == \"\"){\r\n\t\t\t\tresult = result + \"?\"\r\n\t\t\t} else {\r\n\t\t\t\tresult = result + \"&\"\r\n\t\t\t}\r\n\t\t\tresult = result + key + \"=\" + data[key];\r\n\t\t}\r\n\t}\r\n\treturn result;\r\n}\r\n \r\nclass HTTPTransport {\r\n\tget = (url: string, options = {}) => {\r\n\t\treturn this.request(url, {...options, method: METHODS.GET}, options.timeout);\r\n\t};\r\n\r\n\tpost = (url: string, options = {}) => {\r\n\t\treturn this.request(url, {...options, method: METHODS.POST}, options.timeout);\r\n\t};\r\n\r\n\tput = (url: string, options = {}) => {\r\n\t\treturn this.request(url, {...options, method: METHODS.PUT}, options.timeout);\r\n\t};\r\n\r\n\tdelete = (url: string, options = {}) => { \r\n\t\treturn this.request(url, {...options, method: METHODS.DELETE}, options.timeout);\r\n\t};\r\n\r\n\trequest = (url: string, options = {}, timeout = 5000) => {\r\n\t\treturn new Promise(function(resolve, reject) {\r\n\t\t\tconst xhr = new XMLHttpRequest();\r\n\r\n\t\t\tif ((options.method == METHODS.GET) && options.data && (typeof options.data == 'object')){\r\n\t\t\t\txhr.open(options.method, queryStringify(options.data));\r\n\t\t\t} else {\r\n\t\t\t\txhr.open(options.method, url);\r\n\t\t\t}\r\n\r\n\t\t\tfor (let key in options.headers){\r\n\t\t\t\txhr.setRequestHeader(key, options.headers[key]);\r\n\t\t\t}\r\n\r\n\t\t\tif (options.withCredentials) {\r\n\t\t\t\txhr.withCredentials = true;\r\n\t\t\t}\r\n\r\n\t\t\txhr.onload = function() {\r\n\t\t\t\tresolve(xhr);\r\n\t\t\t};\r\n\r\n\t\t\txhr.onabort = reject;\r\n\t\t\txhr.onerror = reject;\r\n\r\n\t\t\txhr.timeout = timeout;\r\n\t\t\txhr.ontimeout = reject;\r\n\r\n\t\t\tif (options.method === METHODS.GET || !options.data) {\r\n\t\t\t\txhr.send();\r\n\t\t\t} else {\r\n\t\t\t\txhr.send(options.data);\r\n\t\t\t}\r\n\t\t});\r\n\t};\r\n}\r\n\r\nexport default new HTTPTransport();","import HTTPTransport from '../utilities/HTTPTransport';\r\n\r\nconst defaultHeaders = {\r\n\t'Content-type': 'application/json',\r\n};\r\n\r\nclass APIBase {\r\n\thttp: typeof HTTPTransport;\r\n\tbaseHref: string;\r\n\tpath: string;\r\n\theaders: Record<string, string>;\r\n\r\n\tconstructor(baseHref: string, path: string, headers: Record<string, string>) {\r\n\t\tthis.http = HTTPTransport;\r\n\t\tthis.baseHref = baseHref || \"https://ya-praktikum.tech/api/v2\";\r\n\t\tthis.path = path || '';\r\n\t\tthis.headers = defaultHeaders;\r\n\t}\r\n\r\n\tgetPath() {\r\n\t\treturn this.baseHref + this.path;\r\n\t}\r\n\r\n\thandleOptions(newOptions: Record<any, any>) {\r\n\t\tconst options = newOptions || {};\r\n\t\tif (newOptions.headers){\r\n\t\t\toptions.headers = newOptions.headers\r\n\t\t} else {\r\n\t\t\toptions.headers = this.headers\r\n\t\t}\r\n\t\treturn options;\r\n\t}\r\n\r\n\thandleResponse(res: XMLHttpRequest) {\r\n\t\tif (res.response == 'OK') {\r\n\t\t\treturn {ok: true};\r\n\t\t}\r\n\t\tlet response = JSON.parse(res.response);\r\n\t\treturn response;\r\n\t}\r\n\r\n\tgetHeaders() {\r\n\t\treturn this.headers;\r\n\t}\r\n\r\n\tget(endpoint: `/${string}`, options?: {}) {\r\n\t\treturn this.http.get(this.getPath() + endpoint, this.handleOptions(options))\r\n\t\t.then(this.handleResponse);\r\n\t}\r\n\r\n\tpost(endpoint: `/${string}`, options?: {}) {\r\n\t\treturn this.http.post(this.getPath() + endpoint, this.handleOptions(options))\r\n\t\t.then(this.handleResponse);\r\n\t}\r\n\r\n\tput(endpoint: `/${string}`, options?: {}) {\r\n\t\treturn this.http.put(this.getPath() + endpoint, this.handleOptions(options))\r\n\t\t.then(this.handleResponse);\r\n\t}\r\n\r\n\tdelete(endpoint: `/${string}`, options?: {}) {\r\n\t\treturn this.http.delete(this.getPath() + endpoint, this.handleOptions(options))\r\n\t\t.then(this.handleResponse);\r\n\t}\r\n}\r\n\r\nexport default APIBase;","import APIBase from './apiBase';\r\nimport { AuthorizationSignInInterface, AuthorizationSignUpInterface } from '../interfaces/interfaces';\r\n\r\nclass APIAuthorization extends APIBase {\r\n\tconstructor() {\r\n\t\tsuper('','/auth');\r\n\t}\r\n\r\n\tsignIn(data: AuthorizationSignInInterface) {\r\n\t\treturn this.post('/signin', {\r\n\t\t\twithCredentials: true,\r\n\t\t\tdata: JSON.stringify(data),\r\n\t\t});\r\n\t}\r\n\r\n\tsignUp(data: AuthorizationSignUpInterface) {\r\n\t\treturn this.post('/signup', {\r\n\t\t\tdata: JSON.stringify(data),\r\n\t\t});\r\n\t}\r\n\r\n\tcheckAuth() {\r\n\t\treturn this.get('/user', {\r\n\t\t\twithCredentials: true,\r\n\t\t});\r\n\t}\r\n\r\n\tsignOut() {\r\n\t\treturn this.post('/logout', {\r\n\t\t\twithCredentials: true,\r\n\t\t});\r\n\t}\r\n}\r\n\r\nexport default new APIAuthorization();","export function showBodyMask(){\r\n\tdocument.getElementById(\"app\").classList.add('loading');\r\n}\r\n\r\nexport function hideBodyMask(){\r\n\tdocument.getElementById(\"app\").classList.remove('loading');\r\n}","import apiAuthorization from '../api/apiAuthorization';\r\nimport { router } from '../utilities/createRouter';\r\nimport { AuthorizationSignInInterface, AuthorizationSignUpInterface } from '../interfaces/interfaces';\r\nimport { showBodyMask, hideBodyMask } from '../utilities/effects';\r\n\r\nfunction afterAuthorizationAnswer(answer, callback, redirect: string){\r\n\tif (answer.error && callback){\r\n\t\tif (answer.reason){\r\n\t\t\tcallback(answer.reason);\r\n\t\t} else {\r\n\t\t\tcallback(answer.error);\r\n\t\t}\t\t\t\t\r\n\t} else {\r\n\t\tif (redirect){\r\n\t\t\trouter.go(redirect);\r\n\t\t}\t\t\r\n\t}\r\n\thideBodyMask();\r\n}\r\n\r\nfunction afterAuthorizationError(error, callback, redirect: string){\r\n\tif (error.response && callback){\r\n\t\tcallback(error.response);\r\n\t} else {\r\n\t\trouter.go(redirect);\r\n\t}\r\n\thideBodyMask();\r\n}\r\n\r\nclass AuthentificationController2 {\r\n\tsignIn(user: AuthorizationSignInInterface, callback) {\r\n\t\tshowBodyMask();\r\n\t\treturn apiAuthorization.signIn(user)\r\n\t\t.then((answer) => {\r\n\t\t\tafterAuthorizationAnswer(answer, callback, '/messenger');\r\n\t\t})\r\n\t\t.catch((error) => {\r\n\t\t\tconsole.error(error);\r\n\t\t\tafterAuthorizationError(error, callback, '/500');\r\n\t\t});\r\n\t}\r\n\r\n\tsignUp(user: AuthorizationSignUpInterface, callback) {\r\n\t\tshowBodyMask();\r\n\t\treturn apiAuthorization.signUp(user)\r\n\t\t.then((answer) => {\r\n\t\t\tafterAuthorizationAnswer(answer, callback, '/messenger');\r\n\t\t})\r\n\t\t.catch((error) => {\r\n\t\t\tconsole.error(error);\r\n\t\t\tafterAuthorizationError(error, callback, '/500');\r\n\t\t});\r\n\t}\r\n\r\n\tsignOut() {\r\n\t\tshowBodyMask();\r\n\t\treturn apiAuthorization.signOut()\r\n\t\t.then((answer) => {\r\n\t\t\thideBodyMask();\r\n\t\t\trouter.go('/');\r\n\t\t});\r\n\t}\r\n\r\n\tcheckAuth(callback) {\r\n\t\treturn apiAuthorization.checkAuth()\r\n\t\t.then((answer) => {\r\n\t\t\tcallback(answer);\r\n\t\t\t//afterAuthorizationAnswer(answer, callback, '/messenger');\t\t\r\n\t\t})\r\n\t\t.catch((error) => {\r\n\t\t\tconsole.error(error);\r\n\t\t\thideBodyMask();\r\n\t\t\trouter.go('/');\r\n\t\t});\r\n\t}\r\n}\r\n\r\nexport default new AuthentificationController2();","//Страница авторизации\r\n\r\nimport Form, { FormParams, onSubmitForm } from '../elements/form-block';\r\nimport Input, { InputParams } from '../elements/input-block';\r\nimport Button, { ButtonParams } from '../elements/button-block';\r\n\r\nimport { router } from '../utilities/createRouter';\r\n\r\nimport AuthentificationController2 from '../controllers/AuthentificationController2';\r\n\r\nconst documentTitle = \"Вход\";\r\n\r\nconst authorizationForm: FormParams = {\r\n\ttitle: 'Вход',\r\n};\r\n\r\nconst authorizationInputs: InputParams[] = [\r\n\t{\r\n\t\telement: '.reg-form-fieldset',\r\n\t\tid: 'login',\r\n\t\tname: 'login',\r\n\t\tlabel: 'Логин',\r\n\t\tvalue: '',\r\n\t\ttype: 'text',\r\n\t\trequired: true,\r\n\t\terrorText: 'Обязательное поле',\r\n\t\tvalidationType: '',\r\n\t\tclassList: '',\r\n\t\tonBlur: (event) => {}\r\n\t},\r\n\t{\r\n\t\telement: '.reg-form-fieldset',\r\n\t\tid: 'password',\r\n\t\tname: 'password',\r\n\t\tlabel: 'Пароль',\r\n\t\tvalue: '',\r\n\t\ttype: 'password',\r\n\t\trequired: true,\r\n\t\terrorText: 'Обязательное поле',\r\n\t\tvalidationType: '',\r\n\t\tclassList: '',\r\n\t\tonBlur: (event) => {}\r\n\t},\r\n];\r\n\r\nconst authorizationButtons: ButtonParams[] = [\r\n\t{\r\n\t\telement: '.buttons-wrapper',\r\n\t\tid: '',\r\n\t\tname: 'Авторизоваться',\r\n\t\tclasses: 'add-link',\r\n\t\tonClick: (event) => {\r\n\t\t\tevent.preventDefault();\r\n\t\t\tonSubmitForm('.reg-form', function(formData){\r\n\t\t\t\tAuthentificationController2.signIn(formData, function(error){\r\n\t\t\t\t\tdocument.getElementById(\"formInfoBlock\").textContent = error;\r\n\t\t\t\t});\r\n\t\t\t});\t\t\t\r\n\t\t},\r\n\t},\r\n\t{\r\n\t\telement: '.buttons-wrapper',\r\n\t\tid: '',\r\n\t\tname: 'Зарегистрироваться',\r\n\t\tclasses: 'reg-link',\r\n\t\tonClick: (event) => {\r\n\t\t\tevent.preventDefault();\r\n\t\t\trouter.go('/sign-up');\r\n\t\t},\r\n\t},\r\n];\r\n\r\nexport default function(): void {\r\n\r\n\tdocument.title = documentTitle;\r\n\r\n\tnew Form(authorizationForm).insertBlock(\"#app\", true);\r\n\r\n\tauthorizationInputs.forEach(function(input) {\r\n\t\tnew Input(input, '').insertBlock(input.element);\r\n\t});\r\n\r\n\tauthorizationButtons.forEach(function(button) {\r\n\t\tnew Button(button).insertBlock(button.element);\r\n\t});\r\n\r\n\t\r\n}","//Блок textarea\r\n\r\nimport Block from '../elements/block';\r\n\r\nconst textareaBlockTemplate = `\r\n\t<div class=\"form-block\">\r\n\t\t<textarea id=\"{{id}}\"  data-required=\"{{required}}\" name=\"{{name}}\" value=\"{{value}}\"></textarea>\r\n\t</div>\r\n\t`;\r\n\r\nexport type TextareaParams = {\r\n\telement: string,\r\n\tid: string,\r\n\tname: string,\r\n\tvalue: string,\r\n\trequired: boolean,\r\n}\r\n\r\nexport default class Textarea extends Block {\r\n\t//params: InputParams\r\n\r\n\tconstructor(params: TextareaParams, template: string) {\r\n\t\tif (!template){\r\n\t\t\ttemplate = textareaBlockTemplate;\r\n\t\t}\r\n\t\tsuper(params, template);\r\n\t}\r\n\r\n\tinsertBlock(element: string, clean: boolean): Record<string, HTMLElement> {\r\n\r\n\t\tconst insertedBlock = super.insertBlock(element, clean);\r\n\t\tif (insertedBlock.inner){\r\n\t\t\tconst textarea = insertedBlock.inner.querySelector('textarea');\r\n\t\t\tif (textarea){\r\n\t\t\t\ttextarea.addEventListener('focus', function(){\r\n\t\t\t\t\tthis.classList.add('focus-input');\r\n\t\t\t\t});\r\n\t\t\t\ttextarea.addEventListener('blur', function(){\r\n\t\t\t\t\tthis.classList.remove('focus-input');\r\n\t\t\t\t});\r\n\t\t\t}\r\n\t\t}\r\n\t\treturn insertedBlock;\r\n\t}\r\n}","//Блок select\r\n\r\nimport Block from '../elements/block';\r\n\r\nconst selectBlockTemplate = `\r\n\t<div class=\"form-block {{classList}}\">\r\n\t\t<label class=\"form-label\" for=\"{{id}}\">{{label}}</label>\r\n\t\t<div class=\"select-wrapper  wrapper-element clear\">\r\n\t\t\t<div class=\"select-block\">\r\n\t\t\t\t<select id=\"{{id}}\" name=\"{{name}}\" data-required=\"{{required}}\" data-error-text=\"{{errorText}}\">\r\n\t\t\t\t\t<option value=\"\" selected disabled></option>\r\n\t\t\t\t</select>\r\n\t\t\t</div>\r\n\t\t\t<div class=\"error-text-block\"></div>\r\n\t\t</div>\r\n\t</div>`;\r\n\r\nexport type SelectParams = {\r\n\telement: string,\r\n\tid: string,\r\n\tname: string,\r\n\tclassList: string,\r\n\tlabel: string,\r\n\terrorText: string,\r\n\trequired: boolean\r\n}\r\n\r\nexport default class Select extends Block {\r\n\r\n\tconstructor(params: SelectParams, template: string, noTagName: boolean = true) {\r\n\t\tif (!template){\r\n\t\t\ttemplate = selectBlockTemplate;\r\n\t\t}\r\n\t\tsuper(params, template, noTagName);\r\n\t}\r\n}","//Блок option\r\n\r\nimport Block from '../elements/block';\r\n\r\nconst optionBlockTemplate = `<option value=\"{{value}}\">{{name}}</option>`;\r\n\r\nexport type OptionParams = {\r\n\telement: string,\r\n\tvalue: string,\r\n\tname: string,\r\n}\r\n\r\nexport default class Option extends Block {\r\n\r\n\tconstructor(params: OptionParams, template: string) {\r\n\t\tif (!template){\r\n\t\t\ttemplate = optionBlockTemplate;\r\n\t\t}\r\n\t\tsuper(params, template, true);\r\n\t}\r\n}","//Блок ссылки\r\n\r\nimport Block from '../elements/block';\r\n\r\nconst linkBlockTemplate = `<a id=\"{{id}}\" class=\"{{classes}}\" href=\"{{href}}\">{{name}}</a>`;\r\n\r\nexport type LinkParams = {\r\n\telement: string,\r\n\tid: string,\r\n\tclasses: string,\r\n\tname: string,\r\n\thref: string,\r\n\tonClick: (event: Event) => void\r\n}\r\n\r\nexport default class Link extends Block {\r\n\r\n\tconstructor(params: LinkParams, template: string, noTagName: boolean = false) {\r\n\t\tif (!template){\r\n\t\t\ttemplate = linkBlockTemplate;\r\n\t\t}\r\n\t\tsuper(params, template, noTagName);\r\n\t}\r\n\r\n\tinsertBlock(element: string, clean: boolean): Record<string, HTMLElement> {\r\n\t\tconst insertedBlock = super.insertBlock(element, clean);\r\n\t\tif (insertedBlock.inner){\r\n\t\t\tinsertedBlock.inner.addEventListener('click', this.props.onClick);\r\n\t\t\tinsertedBlock.inner.addEventListener('touchstart', this.props.onClick);\r\n\t\t}\r\n\t\treturn insertedBlock;\r\n\t}\r\n}","//Блок ссылки в меню\r\n\r\nimport Link from '../elements/link-block';\r\n\r\nconst menuLinkBlockTemplate = `<li id=\"{{id}}\" class=\"{{wrapClasses}}\"><a class=\"{{classes}}\" href=\"{{href}}\">{{name}}</a></li>`;\r\n\r\nexport type MenuLinkParams = {\r\n\telement: string,\r\n\tid: string,\r\n\tclasses: string,\r\n\twrapClasses: string,\r\n\tname: string,\r\n\thref: string,\r\n\tonClick: (event: Event) => void\r\n}\r\n\r\nexport default class MenuLink extends Link {\r\n\r\n\tconstructor(params: MenuLinkParams, template: string, noTagName: boolean = true) {\r\n\t\tif (!template){\r\n\t\t\ttemplate = menuLinkBlockTemplate;\r\n\t\t}\r\n\t\tsuper(params, template, noTagName);\r\n\t}\r\n}","//Блок чата (общий)\r\n\r\nimport Block from '../elements/block';\r\n\r\nconst chatWrapperTemplate = `\r\n\t<div class=\"chat-form-page clear\">\r\n\t\t<div class=\"chat-list-column\" id=\"chatList\">\r\n\t\t\t<div class=\"profile-block clear\"></div>\r\n\t\t\t<ul class=\"menu-list none-block\" id=\"menuBlock\"></ul>\r\n\t\t\t<!--<form class=\"search-wrapper\">\r\n\t\t\t\t<input class=\"input-styles search-input\" type=\"text\" placeholder=\"Поиск\" name=\"search\">\r\n\t\t\t</form> -->\r\n\t\t\t<div class=\"chat-list\" id=\"chatListBlock\"></div>\r\n\t\t</div>\r\n\t\t<div class=\"chat-full-block\" id=\"chatFullBlock\">\r\n\t\t\t<div class=\"chat-full-name\"></div>\r\n\t\t\t<div class=\"select-chat-wrapper\" id=\"selectChat\">\r\n\t\t\t\t<div class=\"select-chat-cell\">\r\n\t\t\t\t\t<span>Выберите чат</span>\r\n\t\t\t\t</div>\r\n\t\t\t</div>\r\n\t\t\t<div class=\"chat-wrapper\" id=\"chatWrapper\"><div class=\"chat\" id=\"chat\"></div></div>\r\n\t\t</div>\r\n\t</div>\r\n\t`;\r\n\r\nexport type ChatParams = Record<string, unknown>;\r\n\r\nexport default class Chat extends Block {\r\n\r\n\tconstructor(params: ChatParams, template: string) {\r\n\t\tif (!template){\r\n\t\t\ttemplate = chatWrapperTemplate;\r\n\t\t}\r\n\t\tsuper(params, template);\r\n\t}\r\n}","//Блок чата (пользователь)\r\n\r\nimport Block from '../elements/block';\r\n\r\nconst chatBlockTemplate = `\r\n\t<div class=\"chat-block\" id=\"{{id}}\" data-user-name=\"{{title}}\">\r\n\t\t<div class=\"chat-photo-wrapper\">\r\n\t\t\t<img class=\"chat-photo\" src=\"{{avatar}}\" alt=\"\">\r\n\t\t</div>\r\n\t\t<div class=\"chat-name\">{{title}}</div>\r\n\t\t<div class=\"chat-preview-text\">\r\n\t\t\t<strong class=\"{{fromMeHideClass}}\">Вы: </strong>\r\n\t\t\t<span>{{text}}</span>\r\n\t\t</div>\r\n\t\t<div class=\"chat-time\">{{time}}</div>\r\n\t\t<div class=\"new-messages-info {{newMessageHideClass}}\">{{newMessageCount}}</div>\r\n\t\t<a class=\"delete-chat-button\" href=\"#\">X</a>\r\n\t</div>`;\r\n\r\nexport type ChatBlockParams = {\r\n\telement: string,\r\n\tid: string,\r\n\tavatar: string,\r\n\tphotoAlt: string,\r\n\ttitle: string,\r\n\tfromMeHideClass: string,\r\n\ttext: string,\r\n\ttime: string,\r\n\tnewMessageHideClass: string,\r\n\tnewMessageCount: number,\r\n\tonClick: (this, event: Event) => void\r\n};\r\n\r\nexport default class ChatBlock extends Block {\r\n\r\n\tconstructor(params: ChatBlockParams, template: string) {\r\n\t\tif (!template){\r\n\t\t\ttemplate = chatBlockTemplate;\r\n\t\t}\r\n\t\tsuper(params, template);\r\n\t}\r\n\r\n\tinsertBlock(element: string, clean: boolean): Record<string, HTMLElement> {\r\n\t\tconst insertedBlock = super.insertBlock(element, clean);\r\n\t\tif (insertedBlock.inner){\r\n\t\t\tinsertedBlock.inner.addEventListener('click', this.props.onClick);\r\n\t\t}\r\n\t\treturn insertedBlock;\r\n\t}\r\n}","//Имя чата\r\n\r\nimport Block from '../elements/block';\r\n\r\nconst chatNameTemplate = `{{name}}`;\r\n\r\nexport type ChatNameData = {\r\n\telement: string,\r\n\tname: string,\r\n\tid: number,\r\n};\r\n\r\nexport default class ChatName extends Block {\r\n\r\n\tconstructor(params: ChatNameData, template: string) {\r\n\t\tif (!template){\r\n\t\t\ttemplate = chatNameTemplate;\r\n\t\t}\r\n\t\tsuper(params, template);\r\n\t}\r\n}","//Названия файлов\r\n\r\nimport Block from '../elements/block';\r\n\r\nconst filesNameTemplate = `<div class=\"files-names\">{{name}}</div>`;\r\n\r\nexport type FilesNameData = {\r\n\telement: string,\r\n\tname: string,\r\n};\r\n\r\nexport default class FilesName extends Block {\r\n\r\n\tconstructor(params: FilesNameData, template: string) {\r\n\t\tif (!template){\r\n\t\t\ttemplate = filesNameTemplate;\r\n\t\t}\r\n\t\tsuper(params, template);\r\n\t}\r\n}","//Блок сообщения\r\n\r\nimport Block from '../elements/block';\r\n\r\nconst messageBlockTemplate = `\r\n\t<div class=\"chat-message-wrapper {{toMeClass}}\">\r\n\t\t<div class=\"chat-message-block\">\r\n\t\t\t<div class=\"chat-message-time\">{{time}}</div>\r\n\t\t\t<div>\r\n\t\t\t\t{{text}}\r\n\t\t\t</div>\r\n\t\t</div>\r\n\t</div>`;\r\n\r\nexport type MessageBlockParams = {\r\n\telement: string,\r\n\ttoMeClass: string, //message-to-me\r\n\ttext: string,\r\n\ttime: string,\r\n};\r\n\r\nexport default class MessageBlock extends Block {\r\n\r\n\tconstructor(params: MessageBlockParams, template: string) {\r\n\t\tif (!template){\r\n\t\t\ttemplate = messageBlockTemplate;\r\n\t\t}\r\n\t\tsuper(params, template);\r\n\t}\r\n\r\n}","//Блок модального окна\r\n\r\nimport Block from '../elements/block';\r\n//import Input, { InputParams } from '../elements/input-block'; - может пригодиться позже при использовании форм в окне\r\n\r\nconst modalTemplate = `\r\n\t<div class=\"warning-message-wrapper warning-on\" id=\"{{id}}\">\r\n\t\t<div class=\"warning-message-table\">\r\n\t\t\t<div class=\"warning-message-block\">\r\n\t\t\t\t<div class=\"warning-message\" data-chatId=\"{{chatId}}\">\r\n\t\t\t\t\t\t<span>{{MessageText}}</span>\r\n\t\t\t\t\t\t<!--<div class=\"form-block\">\r\n\t\t\t\t\t\t\t<label>Логин</label>\r\n\t\t\t\t\t\t\t<div class=\"input-wrapper\">\r\n\t\t\t\t\t\t\t\t<input class=\"form-control input-styles\" type=\"text\">\r\n\t\t\t\t\t\t\t\t<div class=\"error-text-block none-block\"></div>\r\n\t\t\t\t\t\t\t</div>\r\n\t\t\t\t\t\t</div>-->\r\n\t\t\t\t\t<div class=\"warning-buttons-wrapper\"></div>\r\n\t\t\t\t</div>\r\n\t\t\t</div>\r\n\t\t</div>\r\n\t</div>`;\r\n\r\nexport type ModalParams = {\r\n\telement: string,\r\n\tid: string,\r\n\tchatId: number,\r\n\tMessageText: string,\r\n};\r\n\r\nexport default class Modal extends Block {\r\n\r\n\tconstructor(params: ModalParams, template: string) {\r\n\t\tif (!template){\r\n\t\t\ttemplate = modalTemplate;\r\n\t\t}\r\n\t\tsuper(params, template);\r\n\t}\r\n}","import APIBase from './apiBase';\r\nimport { ChatCreateInterface, ChatAddUserInterface } from '../interfaces/interfaces';\r\n\r\nclass APIChats extends APIBase {\r\n\tconstructor() {\r\n\t\tsuper('','/chats');\r\n\t}\r\n\r\n\tcreateChat(data: ChatCreateInterface) {\r\n\t\treturn this.post('/', {\r\n\t\t\twithCredentials: true,\r\n\t\t\tdata: JSON.stringify(data),\r\n\t\t});\r\n\t}\r\n\r\n\tgetChats() {\r\n\t\treturn this.get('/', {\r\n\t\t\twithCredentials: true,\r\n\t\t});\r\n\t}\r\n\r\n\tdeleteChat(chatId: number) {\r\n\t\treturn this.delete('/', {\r\n\t\t\twithCredentials: true,\r\n\t\t\tdata: JSON.stringify({ chatId }),\r\n\t\t});\r\n\t}\r\n\r\n\taddUsersToChat(data: ChatAddUserInterface) {\r\n\t\treturn this.put('/users', {\r\n\t\t\twithCredentials: true,\r\n\t\t\tdata: JSON.stringify(data),\r\n\t\t});\r\n\t}\r\n\r\n\tdeleteUsersFromChat(data: ChatAddUserInterface) {\r\n\t\treturn this.delete('/users', {\r\n\t\t\twithCredentials: true,\r\n\t\t\tdata: JSON.stringify(data),\r\n\t\t});\r\n\t}\r\n\r\n\tgetChatToken(chatId: number) {\r\n\t\treturn this.post(`/token/${chatId}`, {\r\n\t\t\twithCredentials: true,\r\n\t\t});\r\n\t}\r\n\r\n\tgetChatUsers(chatId: number) {\r\n\t\treturn this.get(`/${chatId}/users`, {\r\n\t\t\twithCredentials: true,\r\n\t\t});\r\n\t}\r\n}\r\n\r\nexport default new APIChats();","import apiChats from '../api/apiChats';\r\nimport { router } from '../utilities/createRouter';\r\nimport { ChatCreateInterface, ChatAddUserInterface } from '../interfaces/interfaces';\r\nimport { showBodyMask, hideBodyMask } from '../utilities/effects';\r\n\r\nfunction afterChatAnswer(answer, callback, redirect: string){\r\n\tif (answer.error && callback){\r\n\t\tif (answer.reason){\r\n\t\t\tcallback(answer.reason);\r\n\t\t} else {\r\n\t\t\tcallback(answer.error);\r\n\t\t}\t\t\t\t\r\n\t} else {\r\n\t\tif (redirect){\r\n\t\t\trouter.go(redirect);\r\n\t\t}\t\t\r\n\t}\t\r\n}\r\n\r\nfunction afterChatError(error, callback, redirect: string){\r\n\tconsole.error(error);\r\n\tif (error.response && callback){\r\n\t\tcallback(error.response);\r\n\t} else {\r\n\t\trouter.go(redirect);\r\n\t}\r\n\thideBodyMask();\r\n}\r\n\r\nclass ChatController {\r\n\r\n\tgetChats(callback) {\r\n\t\tshowBodyMask();\r\n\t\treturn apiChats.getChats()\r\n\t\t.then((answer) => {\r\n\t\t\tcallback(answer);\r\n\t\t\thideBodyMask();\r\n\t\t})\r\n\t\t.catch((error) => {\r\n\t\t\tafterChatError(error);\r\n\t\t});\r\n\t}\r\n\r\n\tcreateChat(data: ChatCreateInterface, callback) {\r\n\t\tshowBodyMask();\r\n\t\treturn apiChats.createChat(data)\r\n\t\t.then((answer) => {\r\n\t\t\tcallback(answer.id);\r\n\t\t\thideBodyMask();\r\n\t\t})\r\n\t\t.catch((error) => {\r\n\t\t\tafterChatError(error);\r\n\t\t})\r\n\t}\r\n\r\n\tdeleteChat(chatId: number, callback) {\r\n\t\treturn apiChats.deleteChat(chatId)\r\n\t\t.then((answer) => {\r\n\t\t\tcallback(answer, callback);\r\n\t\t})\r\n\t\t.catch((error) => {\r\n\t\t\tafterChatError(error, callback);\r\n\t\t});\r\n\t}\r\n\r\n\tgetChatToken(chatId: number, callback) {\r\n\t\treturn apiChats.getChatToken(chatId)\r\n\t\t.then((answer) => {\r\n\t\t\tcallback(answer);\r\n\t\t})\r\n\t\t.catch((error) => {\r\n\t\t\tafterChatError(error, callback);\r\n\t\t});\r\n\t}\r\n\r\n\tgetChatUsers(chatId: number, callback) {\r\n\t\treturn apiChats.getChatUsers(chatId)\r\n\t\t.then((answer) => {\r\n\t\t\tcallback(answer);\r\n\t\t})\r\n\t\t.catch((error) => {\r\n\t\t\tafterChatError(error, callback);\r\n\t\t});\r\n\t}\r\n\r\n\taddUsersToChat(data: ChatAddUserInterface, callback) {\r\n\t\tapiChats.addUsersToChat(data)\r\n\t\t.then((answer) => {\r\n\t\t\tcallback(answer);\r\n\t\t})\r\n\t\t.catch((error) => {\r\n\t\t\tafterChatError(error, callback);\r\n\t\t});\r\n\t}\r\n\r\n\tdeleteUserChat(data: ChatAddUserInterface, callback) {\r\n\t\tapiChats.deleteUsersFromChat(data)\r\n\t\t.then((answer) => {\r\n\t\t\tcallback(answer);\r\n\t\t})\r\n\t\t.catch((error) => {\r\n\t\t\tafterChatError(error, callback);\r\n\t\t});\r\n\t}\r\n}\r\n\r\nexport default new ChatController();","import APIBase from './apiBase';\r\nimport { UserSearchInterface, UserUpdateInterface, UserUpdatePasswordInterface } from '../interfaces/interfaces';\r\n\r\nclass APIUser extends APIBase {\r\n\tconstructor() {\r\n\t\tsuper('','/user');\r\n\t}\r\n\r\n\tgetUserData(userId: number) {\r\n\t\treturn this.get(`/${userId}/`, {\r\n\t\t\twithCredentials: true,\r\n\t\t});\r\n\t}\r\n\r\n\tsearchUsers (data: UserSearchInterface) {\r\n\t\treturn this.post('/search', {\r\n\t\t\twithCredentials: true,\r\n\t\t\tdata: JSON.stringify(data),\r\n\t\t});\r\n\t}\r\n\r\n\tupdateUserProfile(data: UserUpdateInterface) {\r\n\t\treturn this.put('/profile', {\r\n\t\t\twithCredentials: true,\r\n\t\t\tdata: JSON.stringify(data),\r\n\t\t});\r\n\t}\r\n\r\n\tupdateUserPassword(data: UserUpdatePasswordInterface) {\r\n\t\treturn this.put('/password', {\r\n\t\t\twithCredentials: true,\r\n\t\t\tdata: JSON.stringify(data),\r\n\t\t});\r\n\t}\r\n\r\n\tupdateUserPhoto(data: FormData) {\r\n\t\tconsole.log(data)\r\n\t\treturn this.put('/profile/avatar', {\r\n\t\t\theaders: {},\r\n\t\t\twithCredentials: true,\r\n\t\t\tdata,\r\n\t\t});\r\n\t}\r\n\r\n}\r\n\r\nexport default new APIUser();","import apiUser from '../api/apiUser';\r\nimport { router } from '../utilities/createRouter';\r\nimport { UserSearchInterface, UserUpdateInterface , UserUpdatePasswordInterface } from '../interfaces/interfaces';\r\nimport { showBodyMask, hideBodyMask } from '../utilities/effects';\r\n\r\nfunction afterUserAnswer(answer, callback, redirect: string){\r\n\tconsole.log(answer)\r\n\tcallback(answer);\r\n\thideBodyMask();\r\n}\r\n\r\nfunction afterUserError(error, callback, redirect: string){\r\n\tconsole.error(error);\r\n\tif (error.response && callback){\r\n\t\tcallback(error.response);\r\n\t} else {\r\n\t\trouter.go(redirect);\r\n\t}\r\n\thideBodyMask();\r\n}\r\n\r\nclass UsersController {\r\n\r\n\tsearchUsers (data: UserSearchInterface, callback) {\r\n\t\treturn apiUser.searchUsers(data)\r\n\t\t.then((users) => {\r\n\t\t\tcallback(users);\r\n\t\t})\r\n\t\t.catch((error) => {\r\n\t\t\tafterChatError(error);\r\n\t\t});\r\n\t}\r\n\r\n\tgetUserData(userId: number, callback) {\r\n\t\treturn apiUser.getUserData(userId)\r\n\t\t.then((answer) => {\r\n\t\t\tcallback(answer);\r\n\t\t})\r\n\t\t.catch((error) => {\r\n\t\t\tafterUserError(error, callback);\r\n\t\t});\r\n\t}\r\n\r\n\tupdateUserProfile(data: UserUpdateInterface, callback) {\r\n\t\tshowBodyMask();\r\n\t\treturn apiUser.updateUserProfile(data)\r\n\t\t.then((user) => {\r\n\t\t\tafterUserAnswer(user, callback);\r\n\t\t})\r\n\t\t.catch((error) => {\r\n\t\t\tafterUserError(error);\r\n\t\t});\r\n\t}\r\n\r\n\tupdateUserPassword(data: UserUpdatePasswordInterface, callback) {\r\n\t\tshowBodyMask();\r\n\t\treturn apiUser.updateUserPassword(data)\r\n\t\t.then((user) => {\r\n\t\t\tafterUserAnswer(user, callback);\r\n\t\t})\r\n\t\t.catch((error) => {\r\n\t\t\tafterUserError(error);\r\n\t\t});\r\n\t}\r\n\r\n\tupdateUserPhoto(data: FormData, callback) {\r\n\t\tshowBodyMask();\r\n\t\treturn apiUser.updateUserPhoto(data)\r\n\t\t.then((res) => {\r\n\t\t\tafterUserAnswer(res, callback);\r\n\t\t})\r\n\t\t.catch((error) => {\r\n\t\t\tafterUserError(error);\r\n\t\t});\r\n\t}\r\n}\r\n\r\nexport default new UsersController();","import { MessengerConnectInterface, MessengerGetInterface } from '../interfaces/interfaces';\r\n//import { store } from '../store';\r\n//import { convertKeysToCamelCase } from '../utils/keysConverter';\r\n\r\nimport { updateChatMessage } from '../pages/chat';\r\n\r\n/*const messengerData = new Store({\r\n\tcurrentUser: null,\r\n\tchatId: null,\r\n\ttoken: null,\r\n\tchats: [],\r\n\tmessages: [],\r\n});*/\r\n\r\nconst hostWS = 'wss://ya-praktikum.tech/ws';\r\n\r\nclass MessengerController {\r\n\tws: WebSocket;\r\n\tuserId: number;\r\n\tchatId: number;\r\n\ttoken: string;\r\n\tping: any;\r\n\r\n\tconstructor() {\r\n\t\tthis.onOpen = this.onOpen.bind(this);\r\n\t\tthis.onMessage = this.onMessage.bind(this);\r\n\t\tthis.onError = this.onError.bind(this);\r\n\t\tthis.onClose = this.onClose.bind(this);\r\n\t}\r\n\r\n\taddEvents() {\r\n\t\tthis.ws.addEventListener('open', this.onOpen);\r\n\t\tthis.ws.addEventListener('message', this.onMessage);\r\n\t\tthis.ws.addEventListener('error', this.onError);\r\n\t\tthis.ws.addEventListener('close', this.onClose);\r\n\t}\r\n\r\n\tremoveEvents() {\r\n\t\tthis.ws.removeEventListener('open', this.onOpen);\r\n\t\tthis.ws.removeEventListener('message', this.onMessage);\r\n\t\tthis.ws.removeEventListener('error', this.onError);\r\n\t\tthis.ws.removeEventListener('close', this.onClose);\r\n\t}\r\n\r\n\tonOpen() {\r\n\t\tconsole.log(\"onOpen\")\r\n\t\tthis.getMessages({ offset: 0 });\r\n\t\t//this.ping = setInterval(() => {\r\n\t\t//\tthis.ws.send('');\r\n\t\t//}, 10000);\r\n\t}\r\n\r\n\tonMessage(event: MessageEvent) {\r\n\t\tconst data = JSON.parse(event.data);\r\n\t\tconsole.log(data);\r\n\t\tupdateChatMessage(data);\r\n\t\t/*if (Array.isArray(data)) {\r\n\t\t\tif (!data.length) {\r\n\t\t\t\tstore.setState({ messages: [] });\r\n\t\t\t} else if (data[0].id === 0) {\r\n\t\t\t\tstore.setState({ messages: data.map((item) => convertKeysToCamelCase(item)) });\r\n\t\t\t} else {\r\n\t\t\t\tconst messages = [\r\n\t\t\t\t\t...store.state.messages,\r\n\t\t\t\t\t...data.map((item) => convertKeysToCamelCase(item)),\r\n\t\t\t\t];\r\n\t\t\t\tstore.setState({ messages });\r\n\t\t\t}\r\n\t\t} else if (typeof data === 'object' && data.type === 'message') {\r\n\t\t\tconst messages = [convertKeysToCamelCase(data), ...store.state.messages];\r\n\t\t\tstore.setState({ messages });\r\n\t\t}*/\r\n\t}\r\n\r\n\tonError(event: ErrorEvent) {\r\n\t\tconsole.error(event.message);\r\n\t}\r\n\r\n\tonClose(event: CloseEventInit) {\r\n\t\tthis.removeEvents();\r\n\t\tif (event.wasClean) {\r\n\t\t\tconsole.log('Соединение закрыто чисто');\r\n\t\t} else {\r\n\t\t\tconsole.log('Проблемы с подключением');\r\n\t\t}\r\n\t\tif (event.code === 1006) {\r\n\t\t\tthis.reconnection();\r\n\t\t}\r\n\t}\r\n\r\n\treconnection() {\r\n\t\tthis.connect({\r\n\t\t\tuserId: this.userId,\r\n\t\t\tchatId: this.chatId,\r\n\t\t\ttoken: this.token,\r\n\t\t});\r\n\t}\r\n\r\n\tconnect(options: MessengerConnectInterface) {\r\n\t\tthis.userId = options.userId;\r\n\t\tthis.chatId = options.chatId;\r\n\t\tthis.token = options.token;\r\n\t\tthis.ws = new WebSocket(hostWS + '/chats/' + options.userId + '/' + options.chatId + '/' + options.token);\r\n\t\tthis.addEvents();\r\n\t}\r\n\r\n\tgetMessages(options: MessengerGetInterface) {\r\n\t\tthis.ws.send(JSON.stringify({\r\n\t\t\tcontent: options.offset.toString(),\r\n\t\t\ttype: 'get old',\r\n\t\t}));\r\n\t}\r\n\r\n\tcloseChat() {\r\n\t\tclearInterval(this.ping);\r\n\t\tthis.ws.close();\r\n\t\tthis.removeEvents();\r\n\t}\r\n\r\n\tsendMessage(message: string) {\r\n\t\tthis.ws.send(JSON.stringify({\r\n\t\t\tcontent: message,\r\n\t\t\ttype: 'message',\r\n\t\t}));\r\n\t}\r\n}\r\n\r\nexport default new MessengerController();","//Страница чата\r\n\r\nimport Form, { FormParams, onSubmitForm } from '../elements/form-block';\r\nimport Textarea, { TextareaParams } from '../elements/textarea-block';\r\nimport Button, { ButtonParams } from '../elements/button-block';\r\nimport Select, { SelectParams } from '../elements/select-block';\r\nimport Option from '../elements/option-block';\r\nimport AddFileButton, { AddFileButtonParams } from '../elements/add-file-block';\r\nimport Link, { LinkParams } from '../elements/link-block';\r\nimport MenuLink, { MenuLinkParams } from '../elements/menu-link-block';\r\nimport Chat, { ChatParams } from '../elements/chat-wrapper';\r\nimport ChatBlock, { ChatBlockParams } from '../elements/chat-block';\r\nimport ChatName, { ChatNameData } from '../elements/chat-name';\r\nimport FilesName, { FilesNameData } from '../elements/files-name';\r\nimport MessageBlock, { MessageBlockParams } from '../elements/message-block';\r\nimport Modal, { ModalParams } from '../elements/modal-block';\r\nimport Input, { InputParams } from '../elements/input-block';\r\n\r\nimport AuthentificationController2 from '../controllers/AuthentificationController2';\r\nimport ChatController from '../controllers/ChatController';\r\nimport UsersController from '../controllers/UsersController';\r\nimport MessengerController from '../controllers/MessengerController';\r\n\r\nimport { router } from '../utilities/createRouter';\r\n\r\n\r\nconst documentTitle: string = \"Чат\";\r\n\r\nlet chatUserId: number = 0;\r\n//let chatMessages = [];\r\nlet chatMessageLastId: number = 0;\r\n\r\nconst chatParams: ChatParams = {};\r\nlet chatName: ChatName;\r\nlet chatNameParams: ChatNameData = {\r\n\telement: '.chat-full-name',\r\n\tname: '',\r\n\tid: 0\r\n};\r\n\r\nconst sendForm: FormParams = {\r\n\ttitle: ''\r\n};\r\n\r\nlet textArea: Textarea;\r\nlet filesName: FilesName;\r\nconst filesNameParams: FilesNameData = {\r\n\telement: '.chat-send-box',\r\n\tname: '',\r\n};\r\nconst sendButton: ButtonParams = {\r\n\telement: '.chat-send-box',\r\n\tid: '',\r\n\tname: ' >',\r\n\tclasses: 'chat-send-button',\r\n\tonClick: (event) => {\r\n\t\tevent.preventDefault();\r\n\t\tonSubmitForm('.chat-send-box', function(answer){\r\n\t\t\tconsole.log(answer)\r\n\t\t\tMessengerController.sendMessage(answer.message);\r\n\t\t\treloadChatSender();\r\n\t\t});\r\n\t},\r\n};\r\n\r\nlet addFile: AddFileButton;\r\nconst addFileButton: AddFileButtonParams = {\r\n\telement: '.chat-send-box',\r\n\tid: 'addFileToMessage',\r\n\tname: '📎',\r\n\tclasses: 'add-file-button',\r\n\tvalue: '',\r\n\tonClick: (event) => {\r\n\t\treturn event;\r\n\t},\r\n\tonChange: (event) => {\r\n\t\tif (event.target && event.target.value){\r\n\t\t\tconst valueArray: [] = event.target.value.split(\"\\\\\");\r\n\t\t\tfilesName.setProps({ name: valueArray[valueArray.length - 1] });\r\n\t\t}\r\n\t},\r\n};\r\n\r\nconst menuLinks: MenuLinkParams[] = [\r\n\t{\r\n\t\telement: '.menu-list',\r\n\t\tid: '',\r\n\t\tclasses: 'create-chat-link',\r\n\t\twrapClasses: '',\r\n\t\tname: 'Создать чат',\r\n\t\thref: '#',\r\n\t\tonClick: (event) => {\r\n\t\t\tevent.preventDefault();\r\n\t\t\tcreateChatClick(event);\r\n\t\t},\r\n\t},\r\n\t{\r\n\t\telement: '.menu-list',\r\n\t\tid: '',\r\n\t\tclasses: 'create-chat-link',\r\n\t\twrapClasses: '',\r\n\t\tname: 'Мой профиль',\r\n\t\thref: '/settings',\r\n\t\tonClick: (event) => {\r\n\t\t\tevent.preventDefault();\r\n\t\t\trouter.go('/settings');\t\r\n\t\t},\r\n\t},\r\n\t{\r\n\t\telement: '.menu-list',\r\n\t\tid: 'addUserToChat',\r\n\t\tclasses: 'create-chat-link',\r\n\t\twrapClasses: 'none-block',\r\n\t\tname: 'Добавить пользователя',\r\n\t\thref: '#',\r\n\t\tonClick: (event) => {\r\n\t\t\tevent.preventDefault();\r\n\t\t\taddUserToChatClick(event);\r\n\t\t},\r\n\t},\r\n\t{\r\n\t\telement: '.menu-list',\r\n\t\tid: 'deleteUserFromChat',\r\n\t\tclasses: 'create-chat-link',\r\n\t\twrapClasses: 'none-block',\r\n\t\tname: 'Удалить пользователя',\r\n\t\thref: '#',\r\n\t\tonClick: (event) => {\r\n\t\t\tevent.preventDefault();\r\n\t\t\tdeleteUserFromChatClick(event);\r\n\t\t},\r\n\t},\r\n\t{\r\n\t\telement: '.menu-list',\r\n\t\tid: '',\r\n\t\tclasses: 'create-chat-link',\r\n\t\twrapClasses: '',\r\n\t\tname: 'Выход',\r\n\t\thref: '/',\r\n\t\tonClick: (event) => {\r\n\t\t\tevent.preventDefault();\r\n\t\t\tAuthentificationController2.signOut();\t\t\r\n\t\t},\r\n\t},\r\n];\r\n\r\nconst chatProfileLinks: LinkParams[] = [\r\n\t{\r\n\t\telement: '.profile-block',\r\n\t\tid: '',\r\n\t\tclasses: 'create-chat-link',\r\n\t\tname: 'Меню',\r\n\t\thref: '#',\r\n\t\tonClick: (event) => {\r\n\t\t\tevent.preventDefault();\r\n\t\t\tdocument.getElementById('menuBlock').classList.toggle('none-block');\r\n\t\t},\r\n\t},\r\n\t{\r\n\t\telement: '.chat-full-name',\r\n\t\tid: '',\r\n\t\tclasses: 'chat-back-button',\r\n\t\tname: 'Закрыть',\r\n\t\thref: '#',\r\n\t\tonClick: (event) => {\r\n\t\t\tevent.preventDefault();\r\n\t\t\tcloseChat();\r\n\t\t},\r\n\t},\r\n];\r\n\r\nconst chatList: ChatBlockParams[] = [\r\n\t{\r\n\t\telement: '.chat-list',\r\n\t\tid: '1',\r\n\t\tphotoLink: '',\r\n\t\tname: 'Андрей Андрейченков',\r\n\t\tphotoAlt: '',\r\n\t\tfromMeHideClass: 'none-block',\r\n\t\ttext: 'Круто!',\r\n\t\ttime: '15.04.2022 15:31',\r\n\t\tnewMessageHideClass: '',\r\n\t\tnewMessageCount: 10,\r\n\t\tonClick: (event) => {\r\n\t\t\tevent.preventDefault();\r\n\t\t\tonChatClick(event);\r\n\t\t},\r\n\t},\r\n\t{\r\n\t\telement: '.chat-list',\r\n\t\tid: '2',\r\n\t\tphotoLink: '',\r\n\t\tname: 'Михалыч',\r\n\t\tphotoAlt: '',\r\n\t\tfromMeHideClass: '',\r\n\t\ttext: 'Отлично!',\r\n\t\ttime: '15.04.2022 15:31',\r\n\t\tnewMessageHideClass: 'none-block',\r\n\t\tnewMessageCount: 0,\r\n\t\tonClick: (event) => {\r\n\t\t\tevent.preventDefault();\r\n\t\t\tonChatClick(event);\r\n\t\t},\r\n\t},\r\n];\r\n\r\nlet messageList: MessageBlockParams[] = [];\r\n\r\nconst textareaParams: TextareaParams = {\r\n\telement: '.chat-send-box',\r\n\tid: 'chatSendBox',\r\n\tname: 'message',\r\n\tvalue: '',\r\n\trequired: true,\r\n};\r\n\r\n//Форма удаления чата\r\n\r\nlet deleteWarningMessage: ModalParams = {\r\n\telement: '#app',\r\n\tid: 'deleteWarningMessage',\r\n\tchatId: 0,\r\n\tMessageText: 'Вы действительно хотите удалить этот чат?',\r\n};\r\n\r\nconst deleteButtons: ButtonParams[] = [\r\n\t{\r\n\t\telement: '.warning-buttons-wrapper',\r\n\t\tid: '',\r\n\t\tname: 'Да',\r\n\t\tclasses: 'warning-add warning-button',\r\n\t\tonClick: (event) => {\r\n\t\t\tevent.preventDefault();\r\n\t\t\t//Вызывать удаление\t\t\r\n\t\t\tChatController.deleteChat(deleteWarningMessage.chatId, function(answer){\r\n\t\t\t\treloadChatList();\r\n\t\t\t\tcloseModal(\"deleteWarningMessage\");\r\n\t\t\t});\r\n\t\t\t\r\n\t\t},\r\n\t},\r\n\t{\r\n\t\telement: '.warning-buttons-wrapper',\r\n\t\tid: '',\r\n\t\tname: 'Нет',\r\n\t\tclasses: 'warning-back warning-button',\r\n\t\tonClick: (event) => {\r\n\t\t\tevent.preventDefault();\r\n\t\t\tcloseModal(\"deleteWarningMessage\");\r\n\t\t},\r\n\t},\r\n];\r\n\r\n//Форма создания чата\r\n\r\nconst createChatModal: ModalParams = {\r\n\telement: '#app',\r\n\tchatId: 0,\r\n\tid: 'createChatModal',\r\n\tMessageText: '',\r\n};\r\n\r\nconst createChatForm: FormParams = {\r\n\ttitle: 'Создать чат',\r\n};\r\n\r\nconst createChatInputs: InputParams[] = [\r\n\t{\r\n\t\telement: '#createChatModal .reg-form-fieldset',\r\n\t\tid: 'chatName',\r\n\t\tname: 'title',\r\n\t\tlabel: 'Название',\r\n\t\tvalue: '',\r\n\t\ttype: 'text',\r\n\t\trequired: true,\r\n\t\terrorText: 'Обязательное поле',\r\n\t\tvalidationType: '',\r\n\t\tclassList: '',\r\n\t\tonBlur: (event) => {}\r\n\t},\r\n];\r\n\r\nconst createChatButtons: ButtonParams[] = [\r\n\t{\r\n\t\telement: '#createChatModal .buttons-wrapper',\r\n\t\tid: '',\r\n\t\tname: 'Создать',\r\n\t\tclasses: 'add-link',\r\n\t\tonClick: (event) => {\r\n\t\t\tevent.preventDefault();\r\n\t\t\tonSubmitForm('#createChatModal .reg-form', function(formData){\r\n\t\t\t\tChatController.createChat(formData, function(answer){\r\n\t\t\t\t\treloadChatList();\r\n\t\t\t\t\tcloseModal(\"createChatModal\");\r\n\t\t\t\t});\r\n\t\t\t});\t\t\t\r\n\t\t},\r\n\t},\r\n\t{\r\n\t\telement: '#createChatModal .buttons-wrapper',\r\n\t\tid: '',\r\n\t\tname: 'Отмена',\r\n\t\tclasses: 'reg-link',\r\n\t\tonClick: (event) => {\r\n\t\t\tevent.preventDefault();\r\n\t\t\tcloseModal(\"createChatModal\");\r\n\t\t},\r\n\t},\r\n];\r\n\r\n\r\n//Форма добавления пользователя в чат\r\n\r\nconst addUserToChatModal: ModalParams = {\r\n\telement: '#app',\r\n\tid: 'addUserToChatModal',\r\n\tchatId: 0,\r\n\tMessageText: '',\r\n};\r\n\r\nconst addUserToChatForm: FormParams = {\r\n\ttitle: 'Добавить пользователя',\r\n};\r\n\r\nconst addUserToChatInputs: InputParams[] = [\r\n\t{\r\n\t\telement: '#addUserToChatModal .reg-form-fieldset',\r\n\t\tid: 'chatName',\r\n\t\tname: 'title',\r\n\t\tlabel: 'Поиск',\r\n\t\tvalue: '',\r\n\t\ttype: 'text',\r\n\t\trequired: false,\r\n\t\terrorText: '',\r\n\t\tvalidationType: '',\r\n\t\tclassList: '',\r\n\t\tonBlur: (event) => {\r\n\t\t\tif (event.target && event.target.value){\r\n\t\t\t\tUsersController.searchUsers({login: event.target.value}, function(answer){\r\n\t\t\t\t\tdocument.getElementById(\"selectUser\").textContent = \"\";\r\n\t\t\t\t\tanswer.forEach(function(user, i) {\r\n\t\t\t\t\t\tanswer[i].name = answer[i].first_name + \" \" + answer[i].second_name;\r\n\t\t\t\t\t\tanswer[i].value = answer[i].id;\r\n\t\t\t\t\t\tnew Option(answer[i], '').insertBlock(\"#selectUser\");\r\n\t\t\t\t\t});\t\t\t\t\t\t\r\n\t\t\t\t});\r\n\t\t\t}\r\n\t\t}\r\n\t},\r\n];\r\n\r\nconst addUserToChatSelect: SelectParams[] = [\r\n\t{\r\n\t\telement: '#addUserToChatModal .reg-form-fieldset',\r\n\t\tid: 'selectUser',\r\n\t\tname: 'user',\r\n\t\tlabel: 'Пользователь',\r\n\t\trequired: true,\r\n\t\terrorText: 'Пользователь не выбран',\r\n\t\tclassList: '',\r\n\t},\r\n];\r\n\r\nconst addUserToChatButtons: ButtonParams[] = [\r\n\t{\r\n\t\telement: '#addUserToChatModal .buttons-wrapper',\r\n\t\tid: '',\r\n\t\tname: 'Добавить',\r\n\t\tclasses: 'add-link',\r\n\t\tonClick: (event) => {\r\n\t\t\tevent.preventDefault();\r\n\t\t\tonSubmitForm('#addUserToChatModal .reg-form', function(formData){\r\n\t\t\t\tconst deleteUserData = {\r\n\t\t\t\t\tusers: [formData.user],\r\n\t\t\t\t\tchatId: parseInt(chatName.props.id)\r\n\t\t\t\t}\r\n\t\t\t\tChatController.addUsersToChat(deleteUserData, function(answer){\r\n\t\t\t\t\treloadChatList();\r\n\t\t\t\t\tcloseModal(\"addUserToChatModal\");\r\n\t\t\t\t});\r\n\t\t\t});\t\t\t\r\n\t\t},\r\n\t},\r\n\t{\r\n\t\telement: '#addUserToChatModal .buttons-wrapper',\r\n\t\tid: '',\r\n\t\tname: 'Отмена',\r\n\t\tclasses: 'reg-link',\r\n\t\tonClick: (event) => {\r\n\t\t\tevent.preventDefault();\r\n\t\t\tcloseModal(\"addUserToChatModal\");\r\n\t\t},\r\n\t},\r\n];\r\n\r\n\r\n//Форма удаления пользователя из чата\r\n\r\nconst deleteUserFromChatModal: ModalParams = {\r\n\telement: '#app',\r\n\tid: 'deleteUserFromChatModal',\r\n\tchatId: 0,\r\n\tMessageText: '',\r\n};\r\n\r\nconst deleteUserFromChatForm: FormParams = {\r\n\ttitle: 'Удалить пользователя',\r\n};\r\n\r\nconst deleteUserFromChatSelect: SelectParams[] = [\r\n\t{\r\n\t\telement: '#deleteUserFromChatModal .reg-form-fieldset',\r\n\t\tid: 'selectUser',\r\n\t\tname: 'user',\r\n\t\tlabel: 'Пользователь',\r\n\t\trequired: true,\r\n\t\terrorText: 'Пользователь не выбран',\r\n\t\tclassList: '',\r\n\t},\r\n];\r\n\r\nconst deleteUserFromChatButtons: ButtonParams[] = [\r\n\t{\r\n\t\telement: '#deleteUserFromChatModal .buttons-wrapper',\r\n\t\tid: '',\r\n\t\tname: 'Удалить',\r\n\t\tclasses: 'add-link',\r\n\t\tonClick: (event) => {\r\n\t\t\tevent.preventDefault();\r\n\t\t\tonSubmitForm('#deleteUserFromChatModal .reg-form', function(formData){\r\n\t\t\t\tconst deleteUserData = {\r\n\t\t\t\t\tusers: [formData.user],\r\n\t\t\t\t\tchatId: parseInt(chatName.props.id)\r\n\t\t\t\t}\r\n\t\t\t\tChatController.deleteUserChat(deleteUserData, function(answer){\r\n\t\t\t\t\treloadChatList();\r\n\t\t\t\t\tcloseModal(\"deleteUserFromChatModal\");\r\n\t\t\t\t});\r\n\t\t\t});\t\t\t\r\n\t\t},\r\n\t},\r\n\t{\r\n\t\telement: '#deleteUserFromChatModal .buttons-wrapper',\r\n\t\tid: '',\r\n\t\tname: 'Отмена',\r\n\t\tclasses: 'reg-link',\r\n\t\tonClick: (event) => {\r\n\t\t\tevent.preventDefault();\r\n\t\t\tcloseModal(\"deleteUserFromChatModal\");\r\n\t\t},\r\n\t},\r\n];\r\n\r\n\r\n//Открываем форму создания чата\r\nfunction createChatClick(event){\r\n\tnew Modal(createChatModal).insertBlock(\"#app\");\r\n\tnew Form(createChatForm).insertBlock(\"#createChatModal\", true);\r\n\r\n\tcreateChatInputs.forEach(function(input) {\r\n\t\tnew Input(input, '').insertBlock(input.element);\r\n\t});\r\n\r\n\tcreateChatButtons.forEach(function(button) {\r\n\t\tnew Button(button).insertBlock(button.element);\r\n\t});\r\n}\r\n\r\n//Открываем форму добавления пользователя в чат\r\nfunction addUserToChatClick(){\r\n\tnew Modal(addUserToChatModal).insertBlock(\"#app\");\r\n\tnew Form(addUserToChatForm).insertBlock(\"#addUserToChatModal\", true);\r\n\r\n\tif (chatName && chatName.props){\r\n\t\tlet chatNameId: number = parseInt(chatName.props.id);\r\n\r\n\t\taddUserToChatInputs.forEach(function(input) {\r\n\t\t\tnew Input(input, '').insertBlock(input.element);\r\n\t\t});\r\n\r\n\t\taddUserToChatSelect.forEach(function(select) {\r\n\t\t\tnew Select(select, '').insertBlock(select.element);\r\n\t\t});\r\n\t}\r\n\t\r\n\r\n\taddUserToChatButtons.forEach(function(button) {\r\n\t\tnew Button(button).insertBlock(button.element);\r\n\t});\r\n}\r\n\r\n//Открываем форму удаления пользователя из чата\r\nfunction deleteUserFromChatClick(event){\r\n\tnew Modal(deleteUserFromChatModal).insertBlock(\"#app\");\r\n\tnew Form(deleteUserFromChatForm).insertBlock(\"#deleteUserFromChatModal\", true);\r\n\r\n\tif (chatName && chatName.props){\r\n\t\tlet chatNameId: number = parseInt(chatName.props.id);\r\n\r\n\t\tdeleteUserFromChatSelect.forEach(function(select) {\r\n\t\t\tnew Select(select, '').insertBlock(select.element);\r\n\t\t});\r\n\r\n\t\t//Получаем список пользователей чата\r\n\t\tChatController.getChatUsers(chatNameId, function(answer){\r\n\t\t\tanswer.forEach(function(user, i) {\r\n\t\t\t\tanswer[i].name = answer[i].first_name + \" \" + answer[i].second_name;\r\n\t\t\t\tanswer[i].value = answer[i].id;\r\n\t\t\t\tnew Option(answer[i], '').insertBlock(\"#selectUser\");\r\n\t\t\t});\r\n\t\t});\r\n\t}\r\n\t\r\n\r\n\tdeleteUserFromChatButtons.forEach(function(button) {\r\n\t\tnew Button(button).insertBlock(button.element);\r\n\t});\r\n}\r\n\r\n//Кликаем по чату - открытие чата, либо удаление\r\nfunction onChatClick(event){\r\n\tconst chatBlock: HTMLElement = event.target.closest(\".chat-block\");\r\n\tconst chatWrapper : HTMLElement = document.getElementById(\"chatWrapper\");\r\n\tif (!chatBlock || !chatWrapper) return;\r\n\r\n\tif (event.target.classList.contains(\"delete-chat-button\") && chatBlock.id){\r\n\t\tdeleteWarningMessage.chatId = chatBlock.id;\r\n\t\tnew Modal(deleteWarningMessage).insertBlock(\"#app\");\r\n\t\tdeleteButtons.forEach(function(button) {\r\n\t\t\tnew Button(button, '').insertBlock(button.element);\r\n\t\t});\r\n\t} else {\r\n\t\tdocument.getElementById(\"chatList\").classList.toggle('chat-full-show');\r\n\t\tdocument.getElementById('menuBlock').classList.add('none-block');\r\n\t\tdocument.getElementById(\"selectChat\").classList.add(\"none-block\");\r\n\t\tdocument.getElementById(\"chatFullBlock\").classList.toggle('chat-full-show');\r\n\t\tdocument.getElementById(\"deleteUserFromChat\").classList.remove(\"none-block\");\r\n\t\tdocument.getElementById(\"addUserToChat\").classList.remove(\"none-block\");\r\n\r\n\t\tdocument.getElementById(\"chat\").textContent = \"\";\r\n\t\tchatMessageLastId = 0;\r\n\r\n\t\t//Получим токен чата\r\n\t\tChatController.getChatToken(chatBlock.id, function(answer){\r\n\t\t\tconsole.log(answer)\r\n\t\t\tif (answer && answer.token && chatUserId){\r\n\t\t\t\tMessengerController.connect({\r\n\t\t\t\t\tuserId: chatUserId,\r\n\t\t\t\t\tchatId: parseInt(chatBlock.id),\r\n\t\t\t\t\ttoken: answer.token,\r\n\t\t\t\t});\r\n\t\t\t}\r\n\t\t});\r\n\t\treloadChatSender();\r\n\t\tscrollChatToBottom();\r\n\t\tif (chatName){\r\n\t\t\tchatName.setProps({ name: chatBlock.getAttribute(\"data-user-name\"), id: chatBlock.id });\r\n\t\t}\r\n\t}\r\n}\r\n\r\n//Очистка сообщения после отправки\r\nfunction reloadChatSender(){\r\n\ttextArea.setProps({ value: \"\" });\r\n\tfilesName.setProps({ name: \"\" });\r\n}\r\n\r\n//Закрытие модального окна\r\nfunction closeModal(modalId){\r\n\tdocument.getElementById(modalId).remove();\r\n}\r\n\r\n//Обновляем список чатов\r\nfunction reloadChatList(){\r\n\tdocument.getElementById(\"chatListBlock\").textContent = \"\";\r\n\r\n\tChatController.getChats(function(answer){\r\n\t\tanswer.forEach(function(chat, i){\r\n\t\t\tanswer[i].element = '.chat-list';\r\n\t\t\tanswer[i].photoAlt = '';\r\n\t\t\tanswer[i].newMessageCount = 0;\r\n\t\t\tanswer[i].fromMeHideClass = 'none-block';\r\n\t\t\tanswer[i].newMessageHideClass = 'none-block';\r\n\t\t\tanswer[i].onClick = function(event){\r\n\t\t\t\tevent.preventDefault();\r\n\t\t\t\tonChatClick(event);\r\n\t\t\t}\r\n\r\n\t\t\tnew ChatBlock(answer[i], '').insertBlock(answer[i].element);\r\n\t\t});\r\n\t});\r\n}\r\n\r\n//Закрываем чат\r\nfunction closeChat(){\r\n\tif (chatName){\r\n\t\tchatName.setProps({ name: '', id: 0 });\r\n\t}\r\n\tdocument.getElementById(\"selectChat\").classList.remove(\"none-block\");\r\n\tdocument.getElementById(\"chatList\").classList.remove('chat-full-show');\r\n\tdocument.getElementById(\"chatFullBlock\").classList.remove('chat-full-show');\r\n\tdocument.getElementById(\"deleteUserFromChat\").classList.add(\"none-block\");\r\n\tdocument.getElementById(\"addUserToChat\").classList.add(\"none-block\");\r\n}\r\n\r\nfunction updateMessageToChat(message, prepend){\r\n\tif (message.id > chatMessageLastId){\r\n\t\tlet toMeClass = '';\r\n\t\tif (message.user_id == chatUserId){\r\n\t\t\ttoMeClass = 'message-to-me';\r\n\t\t}\r\n\t\tchatMessageLastId = message.id;\r\n\t\tnew MessageBlock({\r\n\t\t\telement: '#chat',\r\n\t\t\ttext: message.content,\r\n\t\t\ttime: message.time,\r\n\t\t\ttoMeClass: toMeClass\r\n\t\t}, '').insertBlock('#chat', false, prepend);\r\n\t\tscrollChatToBottom();\r\n\t}\t\r\n}\r\n\r\nfunction scrollChatToBottom(){\r\n\tconst chatWrapper : HTMLElement = document.getElementById(\"chatWrapper\");\r\n\tif (chatWrapper){\r\n\t\tchatWrapper.scrollTop = chatWrapper.scrollHeight;\r\n\t}\r\n}\r\n\r\n//Добавляем сообщения в чат\r\nexport function updateChatMessage(messages){\r\n\tconsole.log(messages);\r\n\tif (Array.isArray(messages)) {\r\n\t\tif (messages.length) {\r\n\t\t\tmessages.forEach(function(message){\r\n\t\t\t\tupdateMessageToChat(message, true);\r\n\t\t\t});\r\n\t\t}\r\n\t}\r\n\tif ((typeof messages === 'object') && (messages.type === 'message')) {\r\n\t\tupdateMessageToChat(messages, false)\r\n\t}\r\n}\r\n\r\nexport function chat(): void {\r\n\r\n\tdocument.title = documentTitle;\r\n\r\n\tnew Chat(chatParams).insertBlock(\"#app\", true);\r\n\t\r\n\tchatName = new ChatName(chatNameParams);\r\n\tchatName.insertBlock('.chat-full-name');\r\n\r\n\tchatProfileLinks.forEach(function(link) {\r\n\t\tnew Link(link, '').insertBlock(link.element);\r\n\t});\r\n\r\n\tmenuLinks.forEach(function(link) {\r\n\t\tnew MenuLink(link, '').insertBlock(link.element);\r\n\t});\r\n\r\n\tAuthentificationController2.checkAuth(function(answer){\r\n\t\tif (answer.id){\r\n\t\t\tchatUserId = answer.id;\r\n\t\t}\r\n\t})\r\n\r\n\treloadChatList()\r\n\t\r\n\tnew Form(sendForm, '<form class=\"chat-send-box\"></form>').insertBlock(\".chat-full-block\");\r\n\tnew Button(sendButton).insertBlock(\".chat-send-box\");\r\n\r\n\t//addFile = new AddFileButton(addFileButton, '');\r\n\t//addFile.insertBlock(\".chat-send-box\");\r\n\r\n\ttextArea = new Textarea(textareaParams);\r\n\ttextArea.insertBlock(\".chat-send-box\");\r\n\r\n\tfilesName = new FilesName(filesNameParams);\r\n\tfilesName.insertBlock(\".chat-send-box\");\r\n}","//Страница регистрации\r\n\r\nimport Form, { FormParams, onSubmitForm } from '../elements/form-block';\r\nimport Input, { InputParams } from '../elements/input-block';\r\nimport Button, { ButtonParams } from '../elements/button-block';\r\n\r\nimport AuthentificationController2 from '../controllers/AuthentificationController2';\r\n\r\nconst documentTitle = \"Регистрация\";\r\n\r\nconst registrationForm: FormParams = {\r\n\ttitle: 'Регистрация'\r\n};\r\n\r\nconst registrationInputs: InputParams[] = [\r\n\t{\r\n\t\telement: '.reg-form-fieldset',\r\n\t\tid: 'email',\r\n\t\tname: 'email',\r\n\t\tlabel: 'E-mail',\r\n\t\tvalue: '',\r\n\t\ttype: 'text',\r\n\t\trequired: true,\r\n\t\terrorText: 'Неверный формат email',\r\n\t\tvalidationType: 'email',\r\n\t\tclassList: '',\r\n\t\tonBlur: (event) => {}\r\n\t},\r\n\t{\r\n\t\telement: '.reg-form-fieldset',\r\n\t\tid: 'login',\r\n\t\tname: 'login',\r\n\t\tlabel: 'Логин',\r\n\t\tvalue: '',\r\n\t\ttype: 'text',\r\n\t\trequired: true,\r\n\t\terrorText: 'Логин должен содержать от 3 до 20 латинских символов, может содержать цифры, но не состоять из них, без пробелов, без спецсимволов',\r\n\t\tvalidationType: 'login',\r\n\t\tclassList: '',\r\n\t\tonBlur: (event) => {}\r\n\t},\r\n\t{\r\n\t\telement: '.reg-form-fieldset',\r\n\t\tid: 'secondName',\r\n\t\tname: 'second_name',\r\n\t\tlabel: 'Фамилия',\r\n\t\tvalue: '',\r\n\t\ttype: 'text',\r\n\t\trequired: true,\r\n\t\terrorText: 'Первая буква должна быть заглавной, без пробелов, цифр и спецсимволов, кроме дефиса',\r\n\t\tvalidationType: 'name',\r\n\t\tclassList: '',\r\n\t\tonBlur: (event) => {}\r\n\t},\r\n\t{\r\n\t\telement: '.reg-form-fieldset',\r\n\t\tid: 'firstName',\r\n\t\tname: 'first_name',\r\n\t\tlabel: 'Имя',\r\n\t\tvalue: '',\r\n\t\ttype: 'text',\r\n\t\trequired: true,\r\n\t\terrorText: 'Первая буква должна быть заглавной, без пробелов, цифр и спецсимволов, кроме дефиса',\r\n\t\tvalidationType: 'name',\r\n\t\tclassList: '',\r\n\t\tonBlur: (event) => {}\r\n\t},\r\n\t{\r\n\t\telement: '.reg-form-fieldset',\r\n\t\tid: 'phone',\r\n\t\tname: 'phone',\r\n\t\tlabel: 'Телефон',\r\n\t\tvalue: '',\r\n\t\ttype: 'text',\r\n\t\trequired: true,\r\n\t\terrorText: 'Телефон должен содержать от 10 до 15 символов, состоит из цифр, может начинаться с плюса',\r\n\t\tvalidationType: 'phone',\r\n\t\tclassList: '',\r\n\t\tonBlur: (event) => {}\r\n\t},\r\n\t{\r\n\t\telement: '.reg-form-fieldset',\r\n\t\tid: 'password',\r\n\t\tname: 'password',\r\n\t\tlabel: 'Пароль',\r\n\t\tvalue: '',\r\n\t\ttype: 'password',\r\n\t\trequired: true,\r\n\t\terrorText: 'Пароль должен содержать от 8 до 40 символов, обязательно хотя бы одну заглавную букву и цифру',\r\n\t\tvalidationType: 'password',\r\n\t\tclassList: '',\r\n\t\tonBlur: (event) => {}\r\n\t},\r\n\t{\r\n\t\telement: '.reg-form-fieldset',\r\n\t\tid: 'repeatPassword',\r\n\t\tname: 'repeat_password',\r\n\t\tlabel: 'Повторите пароль',\r\n\t\tvalue: '',\r\n\t\ttype: 'password',\r\n\t\trequired: true,\r\n\t\terrorText: 'Пароль должен содержать от 8 до 40 символов, обязательно хотя бы одну заглавную букву и цифру',\r\n\t\tvalidationType: 'password',\r\n\t\tclassList: '',\r\n\t\tonBlur: (event) => {}\r\n\t},\r\n];\r\n\r\nconst registrationButtons: ButtonParams[] = [\r\n\t{\r\n\t\telement: '.buttons-wrapper',\r\n\t\tid: '',\r\n\t\tname: 'Зарегистрироваться',\r\n\t\tclasses: 'add-link',\r\n\t\tonClick: (event) => {\r\n\t\t\tevent.preventDefault();\r\n\t\t\tonSubmitForm('.reg-form', function(formData){\r\n\t\t\t\tAuthentificationController2.signUp(formData, function(error){\r\n\t\t\t\t\tdocument.getElementById(\"formInfoBlock\").textContent = error;\r\n\t\t\t\t});\r\n\t\t\t});\r\n\t\t},\r\n\t},\r\n\t{\r\n\t\telement: '.buttons-wrapper',\r\n\t\tid: '',\r\n\t\tname: 'Назад',\r\n\t\tclasses: 'reg-link',\r\n\t\tonClick: (event) => {\r\n\t\t\tevent.preventDefault();\r\n\t\t\twindow.history.back();\r\n\t\t},\r\n\t},\r\n];\r\n\r\nexport default function(): void {\r\n\r\n\tdocument.title = documentTitle;\r\n\t//window.history.pushState('', '', 'registration');\r\n\r\n\tnew Form(registrationForm).insertBlock(\"#app\", true);\r\n\r\n\tregistrationInputs.forEach(function(input) {\r\n\t\tnew Input(input).insertBlock(input.element);\r\n\t});\r\n\r\n\tregistrationButtons.forEach(function(button) {\r\n\t\tnew Button(button).insertBlock(button.element);\r\n\t});\r\n}","//Блок загрузки изображения\r\n\r\nimport Block from '../elements/block';\r\n\r\nconst inputImageTemplate = `\r\n\t<label class=\"image-form-block\" for=\"{{id}}\">\r\n\t\t<input class=\"load-image\" name=\"{{name}}\" hidden accept=\"image/*\" type=\"file\" id=\"{{id}}\">\r\n\t\t<img id=\"{{imageId}}\" src=\"{{imageLink}}\" alt=\"{{imageAlt}}\" title=\"{{imageTitle}}\">\r\n\t</label>`;\r\n\r\nexport type InputImageParams = {\r\n\telement: string,\r\n\tid: string,\r\n\timageId: string,\r\n\tname: string,\r\n\timageLink: string,\r\n\timageAlt: string,\r\n\timageTitle: string,\r\n\tonChanged: (event: Event) => void\r\n}\r\n\r\nexport default class ImageInput extends Block {\r\n\r\n\tconstructor(params: InputImageParams, template: string) {\r\n\t\tif (!template){\r\n\t\t\ttemplate = inputImageTemplate;\r\n\t\t}\r\n\t\tsuper(params, template);\r\n\t}\r\n\r\n\tinsertBlock(element: string, clean: boolean): Record<string, HTMLElement> {\r\n\r\n\t\tconst insertedBlock = super.insertBlock(element, clean);\r\n\t\tconst $this = this;\r\n\t\tif (insertedBlock.inner){\r\n\t\t\tconst input = insertedBlock.inner.querySelector('input');\r\n\t\t\tif (input){\r\n\t\t\t\tinput.addEventListener('change', function(event){\r\n\t\t\t\t\t$this.props.onChanged(event);\r\n\t\t\t\t});\r\n\t\t\t}\t\t\t\r\n\t\t}\r\n\t\treturn insertedBlock;\r\n\t}\r\n\r\n}","//Страница профиля\r\n\r\nimport Form, { FormParams, onSubmitForm } from '../elements/form-block';\r\nimport Input, { InputParams } from '../elements/input-block';\r\nimport Button, { ButtonParams } from '../elements/button-block';\r\nimport ImageInput, { InputImageParams } from '../elements/image-input-block';\r\n\r\nimport { router } from '../utilities/createRouter';\r\n\r\nimport AuthentificationController2 from '../controllers/AuthentificationController2';\r\nimport UsersController from '../controllers/UsersController';\r\n\r\n\r\nconst resourcesLink = \"https://ya-praktikum.tech/api/v2/resources/\";\r\n\r\nconst documentTitle = \"Мой профиль\";\r\n\r\nconst profileForm: FormParams = {\r\n\ttitle: ''\r\n};\r\n\r\nconst profileImageInputs: InputImageParams[] = [\r\n\t{\r\n\t\telement: '.reg-form-fieldset',\r\n\t\tid: 'photoImageUpload',\r\n\t\timageId: 'userAvatar',\r\n\t\tname: 'avatar',\r\n\t\timageLink: '#',\r\n\t\timageAlt: '',\r\n\t\timageTitle: '',\r\n\t\tonChanged: (event) => {\r\n\t\t\tevent.preventDefault();\r\n\t\t\tconst form: HTMLFormElement = document.querySelector(\".reg-form\");\r\n\t\t\tif (!form) return;\r\n\r\n\t\t\tconst data: FormData = new FormData(form);\r\n\t\t\tconsole.log(data)\r\n\t\t\tchangeAvatar(data, function(){\r\n\r\n\t\t\t});\r\n\t\t}\r\n\t}\r\n];\r\n\r\nconst profileInputs: InputParams[] = [\r\n\t{\r\n\t\telement: '.reg-form-fieldset',\r\n\t\tid: 'email',\r\n\t\tname: 'email',\r\n\t\tlabel: 'E-mail',\r\n\t\tvalue: '',\r\n\t\ttype: 'text',\r\n\t\trequired: true,\r\n\t\terrorText: 'Неверный формат email',\r\n\t\tvalidationType: 'email',\r\n\t\tclassList: '',\r\n\t\tonBlur: (event) => {}\r\n\t},\r\n\t{\r\n\t\telement: '.reg-form-fieldset',\r\n\t\tid: 'login',\r\n\t\tname: 'login',\r\n\t\tlabel: 'Логин',\r\n\t\tvalue: '',\r\n\t\ttype: 'text',\r\n\t\trequired: true,\r\n\t\terrorText: 'Логин должен содержать от 3 до 20 латинских символов, может содержать цифры, но не состоять из них, без пробелов, без спецсимволов',\r\n\t\tvalidationType: 'login',\r\n\t\tclassList: '',\r\n\t\tonBlur: (event) => {}\r\n\t},\r\n\t{\r\n\t\telement: '.reg-form-fieldset',\r\n\t\tid: 'secondName',\r\n\t\tname: 'second_name',\r\n\t\tlabel: 'Фамилия',\r\n\t\tvalue: '',\r\n\t\ttype: 'text',\r\n\t\trequired: true,\r\n\t\terrorText: 'Первая буква должна быть заглавной, без пробелов, цифр и спецсимволов, кроме дефиса',\r\n\t\tvalidationType: 'name',\r\n\t\tclassList: '',\r\n\t\tonBlur: (event) => {}\r\n\t},\r\n\t{\r\n\t\telement: '.reg-form-fieldset',\r\n\t\tid: 'firstName',\r\n\t\tname: 'first_name',\r\n\t\tlabel: 'Имя',\r\n\t\tvalue: '',\r\n\t\ttype: 'text',\r\n\t\trequired: true,\r\n\t\terrorText: 'Первая буква должна быть заглавной, без пробелов, цифр и спецсимволов, кроме дефиса',\r\n\t\tvalidationType: 'name',\r\n\t\tclassList: '',\r\n\t\tonBlur: (event) => {}\r\n\t},\r\n\t{\r\n\t\telement: '.reg-form-fieldset',\r\n\t\tid: 'phone',\r\n\t\tname: 'phone',\r\n\t\tlabel: 'Телефон',\r\n\t\tvalue: '',\r\n\t\ttype: 'text',\r\n\t\trequired: true,\r\n\t\terrorText: 'Телефон должен содержать от 10 до 15 символов, состоит из цифр, может начинаться с плюса',\r\n\t\tvalidationType: 'phone',\r\n\t\tclassList: '',\r\n\t\tonBlur: (event) => {}\r\n\t},\r\n];\r\n\r\nconst changePasswordButtons: ButtonParams[] = [\r\n\t{\r\n\t\telement: '.reg-form-fieldset',\r\n\t\tid: 'changePasswordButton',\r\n\t\tname: 'Изменить пароль',\r\n\t\tclasses: 'reg-link',\r\n\t\tonClick: (event) => {\r\n\t\t\tevent.preventDefault();\r\n\t\t\tconst changePasswordButton = document.getElementById(event.target.getAttribute('id'));\r\n\t\t\tlet showElement = changePasswordButton.parentElement.nextElementSibling;\r\n\t\t\twhile (showElement){\r\n\t\t\t\tshowElement.children[0].classList.remove(\"none-block\");\r\n\t\t\t\tshowElement = showElement.nextElementSibling;\r\n\t\t\t}\r\n\t\t},\r\n\t},\r\n];\r\n\r\nconst changePasswordInputs: InputParams[] = [\r\n\t{\r\n\t\telement: '.reg-form-fieldset',\r\n\t\tid: 'oldPassword',\r\n\t\tname: 'old_password',\r\n\t\tlabel: 'Старый пароль',\r\n\t\tvalue: '',\r\n\t\ttype: 'password',\r\n\t\trequired: true,\r\n\t\terrorText: 'Пароль должен содержать от 8 до 40 символов, обязательно хотя бы одну заглавную букву и цифру',\r\n\t\tvalidationType: 'password',\r\n\t\tclassList: 'none-block',\r\n\t\tonBlur: (event) => {}\r\n\t},\r\n\t{\r\n\t\telement: '.reg-form-fieldset',\r\n\t\tid: 'password',\r\n\t\tname: 'password',\r\n\t\tlabel: 'Пароль',\r\n\t\tvalue: '',\r\n\t\ttype: 'password',\r\n\t\trequired: true,\r\n\t\terrorText: 'Пароль должен содержать от 8 до 40 символов, обязательно хотя бы одну заглавную букву и цифру',\r\n\t\tvalidationType: 'password',\r\n\t\tclassList: 'none-block',\r\n\t\tonBlur: (event) => {}\r\n\t},\r\n\t{\r\n\t\telement: '.reg-form-fieldset',\r\n\t\tid: 'repeatPassword',\r\n\t\tname: 'repeat_password',\r\n\t\tlabel: 'Повторите пароль',\r\n\t\tvalue: '',\r\n\t\ttype: 'password',\r\n\t\trequired: true,\r\n\t\terrorText: 'Пароль должен содержать от 8 до 40 символов, обязательно хотя бы одну заглавную букву и цифру',\r\n\t\tvalidationType: 'password',\r\n\t\tclassList: 'none-block',\r\n\t\tonBlur: (event) => {}\r\n\t},\r\n];\r\n\r\nconst profileButtons: ButtonParams[] = [\r\n\t{\r\n\t\telement: '.buttons-wrapper',\r\n\t\tid: '',\r\n\t\tname: 'Изменить данные',\r\n\t\tclasses: 'add-link',\r\n\t\tonClick: (event) => {\r\n\t\t\tevent.preventDefault();\r\n\t\t\tonSubmitForm('.reg-form', function(formData){\r\n\t\t\t\tformData.display_name = formData.first_name;\r\n\t\t\t\t//Изменение данных\r\n\t\t\t\tUsersController.updateUserProfile(formData, function(answer){\r\n\t\t\t\t\tif (answer){\r\n\t\t\t\t\t\tsetChangeUserDataError(answer);\r\n\t\t\t\t\t} else {\r\n\t\t\t\t\t\t//Если менялся пароль - также отправляем изменение пароля\r\n\t\t\t\t\t\tif (formData.password && formData.old_password){\r\n\t\t\t\t\t\t\tchangePassword(formData, redirectToChat);\r\n\t\t\t\t\t\t} else {\r\n\t\t\t\t\t\t\tredirectToChat();\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t}\r\n\t\t\t\t});\r\n\t\t\t});\r\n\t\t},\r\n\t},\r\n\t{\r\n\t\telement: '.buttons-wrapper',\r\n\t\tid: '',\r\n\t\tname: 'Назад',\r\n\t\tclasses: 'reg-link',\r\n\t\tonClick: (event) => {\r\n\t\t\tevent.preventDefault();\r\n\t\t\twindow.history.back();\r\n\t\t},\r\n\t},\r\n];\r\n\r\nfunction redirectToChat(){\r\n\trouter.go('/messenger');\r\n}\r\n\r\nfunction changeAvatar(formData, callback){\r\n\tUsersController.updateUserPhoto(formData, function(answer){\r\n\t\tif (answer && answer.avatar){\r\n\t\t\tsetUserAvatar(answer.avatar)\r\n\t\t}\t\t\t\t\t\t\t\r\n\t});\r\n}\r\n\r\nfunction changePassword(formData, callback){\r\n\tUsersController.updateUserPassword({\r\n\t\toldPassword: formData.old_password,\r\n\t\tnewPassword: formData.password\r\n\t}, function(answer){\r\n\t\tif (answer){\r\n\t\t\tsetChangeUserDataError(answer);\r\n\t\t} else {\r\n\t\t\tcallback(answer);\r\n\t\t}\t\t\t\t\t\t\t\t\r\n\t});\r\n}\r\n\r\nfunction setChangeUserDataError(error){\r\n\tdocument.getElementById(\"formInfoBlock\").textContent = error;\r\n\tgetUserData();\r\n}\r\n\r\nfunction setUserAvatar(url){\r\n\tdocument.getElementById(\"userAvatar\").setAttribute(\"src\", resourcesLink + url);\r\n}\r\n\r\nfunction getUserData(){\r\n\tAuthentificationController2.checkAuth(function(answer){\r\n\t\tfor (let key in answer){\r\n\t\t\tlet element = document.querySelector(\".reg-form [name=\" + key + \"]\");\r\n\t\t\tif (element){\r\n\t\t\t\telement.setAttribute(\"value\", answer[key]);\r\n\t\t\t}\r\n\t\t\tif ((key === \"avatar\") && (answer[key]) ){\r\n\t\t\t\tsetUserAvatar(answer[key]);\r\n\t\t\t}\r\n\t\t}\r\n\t})\r\n}\r\n\r\nexport default function(): void {\r\n\r\n\tdocument.title = documentTitle;\r\n\r\n\tnew Form(profileForm).insertBlock(\"#app\", true);\r\n\r\n\tprofileImageInputs.forEach(function(imageInput) {\r\n\t\tnew ImageInput(imageInput).insertBlock(imageInput.element);\r\n\t});\r\n\r\n\tprofileInputs.forEach(function(input) {\r\n\t\tnew Input(input).insertBlock(input.element);\r\n\t});\r\n\r\n\tchangePasswordButtons.forEach(function(button) {\r\n\t\tnew Button(button).insertBlock(button.element);\r\n\t});\r\n\r\n\tchangePasswordInputs.forEach(function(input) {\r\n\t\tnew Input(input).insertBlock(input.element);\r\n\t});\r\n\r\n\tprofileButtons.forEach(function(button) {\r\n\t\tnew Button(button).insertBlock(button.element);\r\n\t});\r\n\r\n\tgetUserData();\r\n}","//Блок ошибки\r\n\r\nimport Block from '../elements/block';\r\n\r\n//<a class=\"warning-add warning-button\" href=\"chat.html\">Назад</a>-\r\n\r\nconst errorBlockTemplate = `\r\n\t<div class=\"warning-message-wrapper warning-on\">\r\n\t\t<div class=\"warning-message-table\">\r\n\t\t\t<div class=\"warning-message-block\">\r\n\t\t\t\t<div class=\"loader none-block\">//убрать none-block для показа</div>\r\n\t\t\t\t<div class=\"error-message warning-message\">\r\n\t\t\t\t\t<div class=\"error-message-header\">{{title}}</div>\r\n\t\t\t\t\t<span>{{errorText}}</span>\r\n\t\t\t\t\t<div class=\"warning-buttons-wrapper\">\r\n\t\t\t\t\t</div>\r\n\t\t\t\t</div>\r\n\t\t\t</div>\r\n\t\t</div>\r\n\t</div>`;\r\n\r\nexport type ErrorParams = {\r\n\ttitle: string,\r\n\terrorText: string\r\n};\r\n\r\nexport default class Error extends Block {\r\n\r\n\tconstructor(params: ErrorParams, template: string) {\r\n\t\tif (!template){\r\n\t\t\ttemplate = errorBlockTemplate;\r\n\t\t}\r\n\t\tsuper(params, template);\r\n\t}\r\n\r\n}","//Страница ошибки\r\n\r\nimport Button, { ButtonParams } from '../elements/button-block';\r\nimport Error, { ErrorParams } from '../elements/error-block';\r\nimport authorization from './authorization';\r\n\r\nconst documentTitle = \"Ошибка\";\r\n\r\nconst errorBlock: ErrorParams = {\r\n\ttitle: 'Ошибка 404',\r\n\terrorText: 'Страница не найдена'\r\n};\r\n\r\nconst errorButtons: ButtonParams[] = [\r\n\t{\r\n\t\telement: '.warning-buttons-wrapper',\r\n\t\tid: '',\r\n\t\tname: 'Назад',\r\n\t\tclasses: 'warning-add warning-button',\r\n\t\tonClick: (event) => {\r\n\t\t\tevent.preventDefault();\r\n\t\t\terrorBackFunction();\r\n\t\t},\r\n\t},\r\n];\r\n\r\nlet errorBackFunction = function(): void{\r\n\twindow.history.back();\r\n}\r\n\r\nexport function showError(InnerErrorParams: ErrorParams, innerBackFunction, innerErrorButtons: ButtonParams): void {\r\n\tif (!InnerErrorParams){\r\n\t\tInnerErrorParams = errorBlock;\r\n\t}\r\n\r\n\tif (window.location.pathname == \"/500\"){\r\n\t\tInnerErrorParams.title = \"Ошибка 500\";\r\n\t\tInnerErrorParams.errorText = 'Внутренняя ошибка сервера';\r\n\t}\r\n\r\n\tif (!innerErrorButtons){\r\n\t\tinnerErrorButtons = errorButtons;\r\n\t}\r\n\t\r\n\tif (innerBackFunction){\r\n\t\terrorBackFunction = innerBackFunction;\r\n\t}\r\n\r\n\tdocument.title = documentTitle + ': ' + InnerErrorParams.title;\r\n\r\n\tnew Error(InnerErrorParams).insertBlock(\"#app\", true);\r\n\r\n\terrorButtons.forEach(function(button) {\r\n\t\tnew Button(button).insertBlock(button.element);\r\n\t});\r\n}\r\n\r\nexport default function(): void {\r\n\tshowError(errorBlock, errorBackFunction, errorButtons);\t\r\n}","import './scss/init.scss';\r\nimport authorization from './pages/authorization';\r\nimport { chat } from './pages/chat';\r\nimport registration from './pages/registration';\r\nimport profile from './pages/profile';\r\nimport error from './pages/error';\r\n\r\nimport AuthentificationController2 from './controllers/AuthentificationController2';\r\n\r\nimport { router } from './utilities/createRouter';\r\n\r\nrouter\r\n\t.use('/', authorization)\r\n\t.use('/authorization', authorization)\r\n\t.use('/messenger', chat)\r\n\t.use('/settings', profile)\r\n\t.use('/sign-up', registration)\r\n\t.use('*', error)\r\n\t.start();\r\n\r\nAuthentificationController2.checkAuth(function(answer){\r\n\tconst pathArray = window.location.pathname.split(\"/\");\r\n\tif (answer.id && (pathArray[1] == \"\")){\r\n\t\trouter.go('/messenger');\r\n\t}\r\n})"],"names":["$973bede13e903614$export$2e2bcd8739ae039","TEMPLATE_REGULAR","templateBlock","constructor","this","generateTemplate","template","changeTemplateKeys","tmp","templateRegular","templateKeys","exec","templateKey","templateValue","toString","replace","$6449c5e08ba54517$export$5087227eb54526","listeners","on","event","callback","push","off","Error","filter","listener","emit","args","Event","forEach","$f7247865aae568d1$export$2e2bcd8739ae039","static","INIT","FLOW_CDM","FLOW_CDU","FLOW_RENDER","_element","params","noTagName","tagName","eventBus","_meta","props","_makePropsProxy","_registerEvents","EVENTS","init","bind","_componentDidMount","_componentDidUpdate","_render","_createResources","_createDocumentElement","componentDidMount","dispatchComponentDidMoun","oldProps","newProps","componentDidUpdate","setProps","nextProps","Object","assign","element","block","render","innerHTML","getContent","self","Proxy","get","target","property","set","value","deleteProperty","document","createElement","show","style","display","hide","destroy","remove","onDestroy","insertBlock","clean","prepend","inner","wrapper","querySelector","children","el","querySelectorAll","removeAttribute","appendChild","$ee188ca8cb13b1d3$var$validationRegex","email","RegExp","login","name","phone","password","$ee188ca8cb13b1d3$export$5ca26c99531348ec","input","validationType","getAttribute","errorText","regex","inputWrapper","parentElement","errorBlock","test","classList","add","textContent","$ae202c0a4cbfb8e0$export$163d82ae5407ed7c","selector","form","formBlocks","infoBlock","isFormValid","repeatPassword","formBlock","contains","errorWrapper","closest","super","insertedBlock","addEventListener","$7754adb433268645$export$2e2bcd8739ae039","onClick","$6c6ac7e4536728db$export$2e2bcd8739ae039","pathname","view","blockClass","getPathname","leave","keys","length","match","lhs","rhs","query","root","$6c6ac7e4536728db$var$renderBlock","rootQuery","$644cf53cc41e5521$var$Router","__instance","routes","_pathnames","_unprotectedPaths","history","window","_currentRoute","_rootQuery","_onRouteCallback","currentRoute","use","route","_hasRoute","includes","start","onpopstate","location","_onRoute","pathname1","getRoute","paths","pushState","back","forward","find","getLocationPathname","$6462c5e113f2819e$export$5375cda95f0b0eb4","$e1a270160271d0d7$var$METHODS","$e1a270160271d0d7$export$2e2bcd8739ae039","url","options","request","method","timeout","post","put","delete","Promise","resolve","reject","xhr","XMLHttpRequest","data","open","result","key","$e1a270160271d0d7$var$queryStringify","headers","setRequestHeader","withCredentials","onload","onabort","onerror","ontimeout","send","$10441ec2a9bceef6$var$defaultHeaders","$10441ec2a9bceef6$export$2e2bcd8739ae039","baseHref","path","http","getPath","handleOptions","newOptions","handleResponse","res","response","ok","JSON","parse","getHeaders","endpoint","then","$483fb41e9515e095$export$2e2bcd8739ae039","signIn","stringify","signUp","checkAuth","signOut","$cbf9e27276a9d727$export$7fdd5d21bf342ca5","getElementById","$cbf9e27276a9d727$export$ed216e442c6c98fa","$a51c3f2f260ae20f$var$afterAuthorizationAnswer","answer","redirect","error","reason","go","$a51c3f2f260ae20f$var$afterAuthorizationError","$a51c3f2f260ae20f$export$2e2bcd8739ae039","user","catch","console","$91695f1c427861cf$var$authorizationForm","title","$91695f1c427861cf$var$authorizationInputs","id","label","type","required","onBlur","$91695f1c427861cf$var$authorizationButtons","classes","preventDefault","formData","$91695f1c427861cf$export$2e2bcd8739ae039","$ae202c0a4cbfb8e0$export$2e2bcd8739ae039","$002a4a3e1848043a$export$2e2bcd8739ae039","button","textarea","$3b0bc2af79fd68c5$export$2e2bcd8739ae039","$7d05fecee680a978$export$2e2bcd8739ae039","$9ace76d802fc35d7$export$2e2bcd8739ae039","$e910020956be5df2$export$2e2bcd8739ae039","$2f5d5593a8bd83ec$export$2e2bcd8739ae039","$605ae7667409f6ed$export$2e2bcd8739ae039","createChat","getChats","deleteChat","chatId","addUsersToChat","deleteUsersFromChat","getChatToken","getChatUsers","$a1dbf0bbbb19d800$var$afterChatError","$a1dbf0bbbb19d800$export$2e2bcd8739ae039","deleteUserChat","$010e6a9d30d89379$export$2e2bcd8739ae039","getUserData","userId","searchUsers","updateUserProfile","updateUserPassword","updateUserPhoto","log","$7f5e8cb7ae7756f2$var$afterUserAnswer","$7f5e8cb7ae7756f2$var$afterUserError","$7f5e8cb7ae7756f2$export$2e2bcd8739ae039","users","afterChatError","onOpen","onMessage","onError","onClose","addEvents","ws","removeEvents","removeEventListener","getMessages","offset","messages","Array","isArray","message","$a5326e997c37e9f7$var$updateMessageToChat","$a5326e997c37e9f7$export$e046c1f8d63b8e86","wasClean","code","reconnection","connect","token","WebSocket","$f9a5f028c467db4f$var$hostWS","$a5326e997c37e9f7$var$chatUserId","$a5326e997c37e9f7$var$chatMessageLastId","$a5326e997c37e9f7$var$chatParams","$a5326e997c37e9f7$var$chatName","$a5326e997c37e9f7$var$chatNameParams","$a5326e997c37e9f7$var$sendForm","$a5326e997c37e9f7$var$textArea","$a5326e997c37e9f7$var$filesName","$a5326e997c37e9f7$var$filesNameParams","$a5326e997c37e9f7$var$sendButton","$f9a5f028c467db4f$export$2e2bcd8739ae039","sendMessage","$a5326e997c37e9f7$var$reloadChatSender","$a5326e997c37e9f7$var$menuLinks","wrapClasses","href","$9577306b98fa142a$export$2e2bcd8739ae039","$a5326e997c37e9f7$var$createChatModal","$a5326e997c37e9f7$var$createChatForm","$a5326e997c37e9f7$var$createChatInputs","$a5326e997c37e9f7$var$createChatButtons","$a5326e997c37e9f7$var$addUserToChatModal","$a5326e997c37e9f7$var$addUserToChatForm","parseInt","$a5326e997c37e9f7$var$addUserToChatInputs","$a5326e997c37e9f7$var$addUserToChatSelect","select","$5f1f743c70af58d9$export$2e2bcd8739ae039","$a5326e997c37e9f7$var$addUserToChatButtons","$a5326e997c37e9f7$var$addUserToChatClick","$a5326e997c37e9f7$var$deleteUserFromChatModal","$a5326e997c37e9f7$var$deleteUserFromChatForm","chatNameId","$a5326e997c37e9f7$var$deleteUserFromChatSelect","i","first_name","second_name","$a5326e997c37e9f7$var$deleteUserFromChatButtons","$a5326e997c37e9f7$var$deleteUserFromChatClick","$a5326e997c37e9f7$var$chatProfileLinks","toggle","$a5326e997c37e9f7$var$closeChat","$a5326e997c37e9f7$var$textareaParams","$a5326e997c37e9f7$var$deleteWarningMessage","MessageText","$a5326e997c37e9f7$var$deleteButtons","$a5326e997c37e9f7$var$reloadChatList","$a5326e997c37e9f7$var$closeModal","deleteUserData","$a5326e997c37e9f7$var$onChatClick","chatBlock","chatWrapper","$a5326e997c37e9f7$var$scrollChatToBottom","modalId","$a5326e997c37e9f7$export$530dccc8e24f4e99","photoAlt","newMessageCount","fromMeHideClass","newMessageHideClass","$367df50f684bc0f4$export$2e2bcd8739ae039","toMeClass","user_id","$52e53354ad87dc80$export$2e2bcd8739ae039","text","content","time","scrollTop","scrollHeight","$e7d9c4fff4870b96$var$registrationForm","$e7d9c4fff4870b96$var$registrationInputs","$e7d9c4fff4870b96$var$registrationButtons","$87a085c262289cfb$export$2e2bcd8739ae039","$this","onChanged","$7e7fecefb4a4129d$var$profileForm","$7e7fecefb4a4129d$var$profileImageInputs","imageId","imageLink","imageAlt","imageTitle","FormData","avatar","$7e7fecefb4a4129d$var$setUserAvatar","$7e7fecefb4a4129d$var$profileInputs","$7e7fecefb4a4129d$var$changePasswordButtons","showElement","nextElementSibling","$7e7fecefb4a4129d$var$changePasswordInputs","$7e7fecefb4a4129d$var$profileButtons","display_name","$7e7fecefb4a4129d$var$setChangeUserDataError","old_password","oldPassword","newPassword","$7e7fecefb4a4129d$var$changePassword","$7e7fecefb4a4129d$var$redirectToChat","$7e7fecefb4a4129d$var$getUserData","setAttribute","$c2020b7a41de0eca$var$errorBlock","$c2020b7a41de0eca$var$errorButtons","$c2020b7a41de0eca$var$errorBackFunction","$2bc99bc52c546f23$export$2e2bcd8739ae039","link","$831830e1f4309f7f$export$2e2bcd8739ae039","imageInput","InnerErrorParams","innerBackFunction","innerErrorButtons","$c2020b7a41de0eca$var$documentTitle","$294a01c843a7bfcc$export$2e2bcd8739ae039","pathArray","split"],"version":3,"file":"index.a6b43121.js.map","sourceRoot":"../"}