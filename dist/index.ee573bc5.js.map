{"mappings":"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","sources":["src/pages/authorization.ts","src/elements/form-block.ts","src/elements/block.ts","src/utilities/TemplateGen.ts","src/utilities/eventbus.ts","src/utilities/validation.ts","src/elements/input-block.ts","src/elements/button-block.ts","src/utilities/createRouter.ts","src/utilities/Router.ts","src/utilities/route.ts","src/controllers/AuthentificationController2.ts","src/api/apiAuthorization.ts","src/api/apiBase.ts","src/utilities/HTTPTransport.ts","src/utilities/effects.ts","src/elements/textarea-block.ts","src/elements/select-block.ts","src/elements/option-block.ts","src/elements/link-block.ts","src/elements/menu-link-block.ts","src/elements/chat-wrapper.ts","src/elements/chat-block.ts","src/elements/chat-name.ts","src/elements/files-name.ts","src/elements/message-block.ts","src/elements/modal-block.ts","src/controllers/ChatController.ts","src/api/apiChats.ts","src/controllers/UsersController.ts","src/api/apiUser.ts","src/controllers/MessengerController.ts","src/pages/chat.ts","src/pages/registration.ts","src/pages/profile.ts","src/elements/image-input-block.ts","src/pages/error.ts","src/elements/error-block.ts","src/main.ts"],"sourcesContent":["//Страница авторизации\r\n\r\nimport Form, { FormParams, onSubmitForm } from '../elements/form-block';\r\nimport Input, { InputParams } from '../elements/input-block';\r\nimport Button, { ButtonParams } from '../elements/button-block';\r\n\r\nimport { router } from '../utilities/createRouter';\r\n\r\nimport AuthentificationController2 from '../controllers/AuthentificationController2';\r\n\r\nconst documentTitle = \"Вход\";\r\n\r\nconst authorizationForm: FormParams = {\r\n\ttitle: 'Вход',\r\n};\r\n\r\nconst authorizationInputs: InputParams[] = [\r\n\t{\r\n\t\telement: '.reg-form-fieldset',\r\n\t\tid: 'login',\r\n\t\tname: 'login',\r\n\t\tlabel: 'Логин',\r\n\t\tvalue: '',\r\n\t\ttype: 'text',\r\n\t\trequired: true,\r\n\t\terrorText: 'Обязательное поле',\r\n\t\tvalidationType: '',\r\n\t\tclassList: '',\r\n\t\tonBlur: (event) => {}\r\n\t},\r\n\t{\r\n\t\telement: '.reg-form-fieldset',\r\n\t\tid: 'password',\r\n\t\tname: 'password',\r\n\t\tlabel: 'Пароль',\r\n\t\tvalue: '',\r\n\t\ttype: 'password',\r\n\t\trequired: true,\r\n\t\terrorText: 'Обязательное поле',\r\n\t\tvalidationType: '',\r\n\t\tclassList: '',\r\n\t\tonBlur: (event) => {}\r\n\t},\r\n];\r\n\r\nconst authorizationButtons: ButtonParams[] = [\r\n\t{\r\n\t\telement: '.buttons-wrapper',\r\n\t\tid: '',\r\n\t\tname: 'Авторизоваться',\r\n\t\tclasses: 'add-link',\r\n\t\tonClick: (event) => {\r\n\t\t\tevent.preventDefault();\r\n\t\t\tonSubmitForm('.reg-form', function(formData){\r\n\t\t\t\tAuthentificationController2.signIn(formData, function(error){\r\n\t\t\t\t\tdocument.getElementById(\"formInfoBlock\").textContent = error;\r\n\t\t\t\t});\r\n\t\t\t});\t\t\t\r\n\t\t},\r\n\t},\r\n\t{\r\n\t\telement: '.buttons-wrapper',\r\n\t\tid: '',\r\n\t\tname: 'Зарегистрироваться',\r\n\t\tclasses: 'reg-link',\r\n\t\tonClick: (event) => {\r\n\t\t\tevent.preventDefault();\r\n\t\t\trouter.go('/sign-up');\r\n\t\t},\r\n\t},\r\n];\r\n\r\nexport default function(): void {\r\n\r\n\tdocument.title = documentTitle;\r\n\r\n\tnew Form(authorizationForm).insertBlock(\"#app\", true);\r\n\r\n\tauthorizationInputs.forEach(function(input) {\r\n\t\tnew Input(input, '').insertBlock(input.element);\r\n\t});\r\n\r\n\tauthorizationButtons.forEach(function(button) {\r\n\t\tnew Button(button).insertBlock(button.element);\r\n\t});\r\n\r\n\t\r\n}","//Блок input\r\n\r\nimport Block from '../elements/block';\r\nimport {validForm} from \"../utilities/validation\";\r\n\r\nconst formBlockTemplate = `\r\n\t<div class=\"reg-form-page\">\r\n\t\t<div class=\"reg-form-wrapper\">\r\n\t\t\t<h2>{{title}}</h2>\r\n\t\t\t<form class=\"reg-form\">\r\n\t\t\t\t<fieldset>\r\n\t\t\t\t\t<div class=\"reg-form-fieldset\"></div>\r\n\t\t\t\t\t<div class=\"form-block info-block\" id=\"formInfoBlock\"></div>\r\n\t\t\t\t\t<div class=\"form-block buttons-wrapper\"></div>\r\n\t\t\t\t</fieldset>\r\n\t\t\t</form>\r\n\t\t</div>\r\n\t</div>`;\r\n\r\nexport type FormParams = {\r\n\ttitle: string\r\n};\r\n\r\nexport default class Form extends Block {\r\n\r\n\tconstructor(params: FormParams, template: string) {\r\n\t\tif (!template){\r\n\t\t\ttemplate = formBlockTemplate;\r\n\t\t}\r\n\t\tsuper(params, template);\r\n\t}\r\n}\r\n\r\nexport function onSubmitForm(selector: string, callback): void {\r\n\tconst form: HTMLFormElement = document.querySelector(selector);\r\n\tif (!form) return;\r\n\r\n\tif (validForm(form)){\r\n\t\tconst data: FormData = new FormData(form);\r\n\t\tconsole.log(...data);\r\n\t\tif (callback){\r\n\t\t\tlet obj : Record<any, any> = {};\r\n\t\t\tfor (let key of data.keys()) {\r\n\t\t\t\tobj[key] = data.get(key);\r\n\t\t\t}\r\n\t\t\tcallback(obj);\r\n\t\t}\r\n\t}\r\n\treturn;\r\n}","//Блоки - общее\r\nimport TemplateGen from '../utilities/TemplateGen';\r\nimport {EventBus} from '../utilities/eventbus';\r\n\r\nexport type PropsType = Record<string, any>;\r\n\r\ntype BlockMetaData = {\r\n\ttagName: string,\r\n\tprops: Record<string, unknown>\r\n}\r\n\r\nexport default class Block {\r\n\tstatic EVENTS = {\r\n\t\tINIT: \"init\",\r\n\t\tFLOW_CDM: \"flow:component-did-mount\",\r\n\t\tFLOW_CDU: \"flow:component-did-update\",\r\n\t\tFLOW_RENDER: \"flow:render\"\r\n\t};\r\n\r\n\tnoTagName: false;\r\n\ttemplate: string;\r\n\tprops: PropsType;\r\n\teventBus: () => EventBus;\r\n\r\n\t_element: HTMLElement = null;\r\n\t_meta: BlockMetaData;\r\n\r\n\tconstructor(params: Record<string, unknown>, template: string, noTagName: boolean, tagName = 'div') {\r\n\t\tthis.template = template;\r\n\t\tthis.noTagName = noTagName;\r\n\t\tconst eventBus = new EventBus();\r\n\t\tthis._meta = {\r\n\t\t\ttagName,\r\n\t\t\tparams\r\n\t\t};\r\n\r\n\t\tthis.props = this._makePropsProxy(params);\r\n\r\n\t\tthis.eventBus = () => eventBus;\r\n\r\n\t\tthis._registerEvents(eventBus);\r\n\t\teventBus.emit(Block.EVENTS.INIT);\r\n\t}\r\n\r\n\t_registerEvents(eventBus) {\r\n\t\teventBus.on(Block.EVENTS.INIT, this.init.bind(this));\r\n\t\teventBus.on(Block.EVENTS.FLOW_CDM, this._componentDidMount.bind(this));\r\n\t\teventBus.on(Block.EVENTS.FLOW_CDU, this._componentDidUpdate.bind(this));\r\n\t\teventBus.on(Block.EVENTS.FLOW_RENDER, this._render.bind(this));\r\n\t}\r\n\r\n\t_createResources(): void {\r\n\t\tconst { tagName } = this._meta;\r\n\t\tthis._element = this._createDocumentElement(tagName);\r\n\t\tthis._element;\r\n\t}\r\n\r\n\tinit(): void {\r\n\t\tthis._createResources();\r\n\t\tthis.eventBus().emit(Block.EVENTS.FLOW_CDM);\r\n\t}\r\n\r\n\t_componentDidMount(): void {\r\n\t\tthis.componentDidMount();\r\n\t\tthis.eventBus().emit(Block.EVENTS.FLOW_RENDER);\r\n\t}\r\n\r\n\tcomponentDidMount(): void {\r\n\t\treturn;\r\n\t}\r\n\r\n\tdispatchComponentDidMoun() {return;}\r\n\r\n\t_componentDidUpdate(oldProps: Record<string, unknown>, newProps: Record<string, unknown>): void {\r\n\t\tconst response = this.componentDidUpdate(oldProps, newProps);\r\n\t\tif (!response) {\r\n\t\t\treturn;\r\n\t\t}\r\n\t\tthis._render();\r\n\t}\r\n\r\n\tcomponentDidUpdate(oldProps: Record<string, unknown>, newProps: Record<string, unknown>,): boolean {\r\n\t\treturn true;\r\n\t}\r\n\r\n\tsetProps = nextProps => {\r\n\t\tif (!nextProps) {\r\n\t\t\treturn;\r\n\t\t}\r\n\t\tObject.assign(this.props, nextProps);\r\n\t};\r\n\r\n\tget element(): HTMLElement {\r\n\t\treturn this._element;\r\n\t}\r\n\r\n\t_render() {\r\n\t\tconst block = this.render();\r\n\t\tif (this._element){\r\n\t\t\tthis._element.innerHTML = block;\r\n\t\t}\r\n\t}\r\n\r\n\trender(): string {\r\n\t\treturn new TemplateGen(this.template).generateTemplate(this.props);\r\n\t}\r\n\r\n\tgetContent(): HTMLElement {\r\n\t\treturn this.element;\r\n\t}\r\n\r\n\t_makePropsProxy(props: Record<string, unknown>): Record<string, unknown> {\r\n\t\tconst self = this;\r\n\r\n\t\treturn new Proxy(props, {\r\n\t\t\tget(target, property) {\r\n\t\t\t\tif (typeof target[property] == 'function'){\r\n\t\t\t\t\treturn target[property].bind(target);\r\n\t\t\t\t} else {\r\n\t\t\t\t\treturn target[property];\r\n\t\t\t\t}\r\n\t\t\t},\r\n\t\t\tset(target, property, value) {\r\n\t\t\t\ttarget[property] = value;\r\n\t\t\t\tself.eventBus().emit(Block.EVENTS.FLOW_CDU, {...target}, target);\r\n\t\t\t\treturn true;\r\n\t\t\t},\r\n\t\t\tdeleteProperty() {\r\n\t\t\t\tthrow new Error(\"Нет доступа\");\r\n\t\t\t}\r\n\t\t});\r\n\t}\r\n\r\n\t_createDocumentElement(tagName): HTMLElement {\r\n\t\treturn document.createElement(tagName);\r\n\t}\r\n\r\n\tshow(): void {\r\n\t\tconst element = this.getContent();\r\n\t\tif (element){\r\n\t\t\telement.style.display = \"block\";\r\n\t\t}\t\t\r\n\t}\r\n\r\n\thide(): void {\r\n\t\tconst element = this.getContent();\r\n\t\tif (element){\r\n\t\t\telement.style.display = \"none\";\r\n\t\t}\r\n\t}\r\n\r\n\tdestroy() {\r\n\t\tthis._element.remove();\r\n\t\tthis.onDestroy();\r\n\t}\r\n\r\n\tonDestroy() {}\r\n\r\n\tinsertBlock(element: string, clean: boolean, prepend: boolean): Record<string, HTMLElement> {\r\n\t\tlet inner = this.getContent(); //new DOMParser().parseFromString(new TemplateGen(this.template).generateTemplate(this.props), \"text/html\").getElementsByTagName(\"body\")[0].childNodes[0];\r\n\t\tconst wrapper = document.querySelector(element);\r\n\t\tif (!inner || !wrapper) return {};\r\n\t\tif (this.noTagName){\r\n\t\t\tinner = inner.children[0];\r\n\t\t}\r\n\t\tfor (let el of wrapper.querySelectorAll('[id=\"\"]')) {\r\n\t\t\tel.removeAttribute('id');\r\n\t\t}\r\n\t\tif (clean){\r\n\t\t\twrapper.innerHTML = \"\";\r\n\t\t}\r\n\t\tif (prepend){\r\n\t\t\twrapper.prepend(inner);\r\n\t\t} else {\r\n\t\t\twrapper.appendChild(inner);\r\n\t\t}\r\n\t\treturn {\r\n\t\t\tinner: inner,\r\n\t\t\twrapper: wrapper\r\n\t\t};\r\n\t}\r\n}","//Генератор шаблонов\r\n//На вход подаётся строка с макросами в скобках {{}} и объект со значениями макросов\r\n//Пример:\r\n/*\r\n\tСтрока: '<div class=\"{{className}}\"></div>'\r\n\tОбъект: {className: 'test-class'}\r\n*/\r\n\r\nexport default class TemplateGen {\r\n\r\n\treadonly TEMPLATE_REGULAR = /\\{\\{(.*?)\\}\\}/;\r\n\r\n\treadonly templateBlock: string = \"\";\r\n\r\n\tconstructor(templateBlock: string) {\r\n\t\tthis.templateBlock = templateBlock;\r\n\t}\r\n\r\n\tgenerateTemplate(template: Record<string, unknown>): string {\r\n\t\tif (template && this.templateBlock){\r\n\t\t\treturn this.changeTemplateKeys(template, this.templateBlock, this.TEMPLATE_REGULAR);\r\n\t\t}\r\n\t\treturn \"\";\r\n\t}\r\n\r\n\tchangeTemplateKeys(template, tmp, templateRegular): string {\r\n\t\tconst templateKeys = templateRegular.exec(tmp);\r\n\t\tif (templateKeys && templateKeys[1]){\r\n\t\t\tconst templateKey = templateKeys[1];\r\n\t\t\tif (templateKey in template){\r\n\t\t\t\tlet templateValue = template[templateKey];\r\n\t\t\t\tif ((typeof templateValue != \"object\") && (typeof templateValue != \"function\")){\r\n\t\t\t\t\ttemplateValue = templateValue.toString();\r\n\t\t\t\t} else {\r\n\t\t\t\t\ttemplateValue = \"\";\r\n\t\t\t\t}\r\n\t\t\t\ttmp = tmp.replace(templateKeys[0], templateValue);\r\n\t\t\t} else {\r\n\t\t\t\ttmp = tmp.replace(templateKeys[0], \"\");\r\n\t\t\t}\t\r\n\t\t}\r\n\t\tif (templateRegular.exec(tmp)){\r\n\t\t\treturn this.changeTemplateKeys(template, tmp, templateRegular);\r\n\t\t} else {\r\n\t\t\treturn tmp;\r\n\t\t}\r\n\t}\r\n}","//Шина событий\r\n\r\nexport class EventBus {\r\n\tlisteners: Record<string, Array<() => void>>;\r\n\r\n\tconstructor() {\r\n\t\tthis.listeners = {};\r\n\t}\r\n\r\n\ton(event: string, callback: () => void): void {\r\n\t\tif (!this.listeners[event]) {\r\n\t\t\tthis.listeners[event] = [];\r\n\t\t}\r\n\t\tthis.listeners[event].push(callback);\r\n\t}\r\n\r\n\toff(event: string, callback: () => void): void {\r\n\t\tif (!this.listeners[event]) {\r\n\t\t\tthrow new Error(`Нет события: ${event}`);\r\n\t\t}\r\n\r\n\t\tthis.listeners[event] = this.listeners[event].filter(\r\n\t\t\tlistener => listener !== callback\r\n\t\t);\r\n\t}\r\n\r\n\temit(event: string, ...args: unknown[]) {\r\n\t\tif (!this.listeners[event]) {\r\n\t\t\tthrow new Event(`Нет события: ${event}`);\r\n\t\t}\r\n\r\n\t\tthis.listeners[event].forEach(function (listener: (...args: unknown[]) => void) {\r\n\t\t\tlistener(...args);\r\n\t\t});\r\n\t}\r\n}","//Валидация\r\n\r\nconst defaultValidationErrorMessage = \"Возникла ошибка при заполнении формы. Пожалуйста, проверьте введённые данные.\";\r\nconst repeatPasswordErrorMessage = \"Пароли не совпадают.\";\r\nconst requiredFieldsErrorMessage = \"Не все обязательные поля заполнены.\";\r\nconst requiredFieldMessage = \"Обязательное поле.\";\r\n\r\nconst validationRegex: Record<string, RegExp> = {\r\n\temail: new RegExp(/^([A-Za-z0-9_\\.-]+)@([A-Za-z0-9_\\.-]+)\\.([a-z\\.]{2,6})$/),\r\n\tlogin: new RegExp(/^[A-Za-z0-9_\\.-]{3,20}$/),\r\n\tname: new RegExp(/^[A-ZА-Я][a-zA-Zа-яА-Я-]+$/),\r\n\tphone: new RegExp(/^\\+?\\d{10,15}$/),\r\n\tpassword: new RegExp(/^((?=.*?[A-Z])(?=.*?[0-9])\\S{8,40})\\S$/),\r\n};\r\n\r\nexport const validValue = function(input: HTMLInputElement): boolean {\r\n\tconst validationType = input.getAttribute(\"data-validation-type\");\r\n\tconst errorText = input.getAttribute(\"data-error-text\");\r\n\r\n\tconst value = input.value;\r\n\tconst regex = validationRegex[validationType];\r\n\r\n\tconst inputWrapper = input.parentElement;\r\n\tconst errorBlock = inputWrapper.querySelector(\".error-text-block\");\r\n\r\n\tif (regex && !regex.test(value)) {\r\n\t\tinputWrapper.classList.add('error-input');\r\n\t\tif (errorBlock){\r\n\t\t\tif (errorText){\r\n\t\t\t\terrorBlock.textContent = errorText;\r\n\t\t\t} else {\r\n\t\t\t\terrorBlock.textContent = defaultValidationErrorMessage;\r\n\t\t\t}\r\n\t\t}\t\t\r\n\t\treturn false;\r\n\t}\r\n\tinputWrapper.classList.remove('error-input');\r\n\tif (errorBlock){\r\n\t\terrorBlock.textContent = \"\";\r\n\t}\r\n\treturn true;\r\n};\r\n\r\nexport const validForm = function(form: HTMLFormElement): boolean {\r\n\tconst formBlocks = form.querySelectorAll('.form-block');\r\n\tconst infoBlock = form.querySelector(\".info-block\");\r\n\r\n\tlet isFormValid = true;\r\n\tlet password = \"\", repeatPassword = \"\";\r\n\r\n\tif (infoBlock){\r\n\t\tinfoBlock.textContent = \"\";\r\n\t}\r\n\r\n\tformBlocks.forEach(function(formBlock) {\r\n\t\tconst input = formBlock.querySelector(\"input\") || formBlock.querySelector(\"textarea\") || formBlock.querySelector(\"select\");\r\n\t\tif (input){\r\n\t\t\tconst errorText = input.getAttribute(\"data-error-text\");\r\n\r\n\t\t\tif (!formBlock.classList.contains(\"none-block\") && !validValue(input)) {\r\n\t\t\t\tisFormValid = false;\r\n\t\t\t}\r\n\t\t\tif (!input.value && input.getAttribute(\"data-required\") && !formBlock.classList.contains(\"none-block\")){\r\n\t\t\t\tisFormValid = false;\r\n\r\n\t\t\t\tconst errorWrapper = input.closest(\".wrapper-element\");\r\n\t\t\t\tif (errorWrapper) {\r\n\t\t\t\t\terrorWrapper.classList.add(\"error-input\");\r\n\r\n\t\t\t\t\tif (errorText){\r\n\t\t\t\t\t\terrorWrapper.querySelector(\".error-text-block\").textContent = errorText;\r\n\t\t\t\t\t} else {\r\n\t\t\t\t\t\terrorWrapper.querySelector(\".error-text-block\").textContent = requiredFieldMessage;\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\r\n\t\t\t\tif (infoBlock){\r\n\t\t\t\t\tinfoBlock.textContent = requiredFieldsErrorMessage;\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t\tif (input.name == \"password\"){\r\n\t\t\t\tpassword = input.value;\r\n\t\t\t}\r\n\t\t\tif (input.name == \"repeat_password\"){\r\n\t\t\t\trepeatPassword = input.value;\r\n\t\t\t}\r\n\t\t}\r\n\t});\r\n\t\r\n\tif (password && repeatPassword && (password != repeatPassword)){\r\n\t\tisFormValid = false;\r\n\t\tinfoBlock.textContent = repeatPasswordErrorMessage;\r\n\t}\t\r\n\treturn isFormValid;\r\n};","//Блок input\r\n\r\nimport Block from '../elements/block';\r\nimport {validValue} from \"../utilities/validation\";\r\n\r\nconst inputBlockTemplate = `\r\n\t<div class=\"form-block {{classList}}\">\r\n\t\t<label class=\"form-label\" for=\"{{id}}\">{{label}}</label>\r\n\t\t<div class=\"input-wrapper wrapper-element\">\r\n\t\t\t<input class=\"form-control input-styles\" data-required=\"{{required}}\" data-error-text=\"{{errorText}}\" \r\n\t\t\tdata-validation-type=\"{{validationType}}\" id=\"{{id}}\" type=\"{{type}}\" value=\"{{value}}\" name=\"{{name}}\">\r\n\t\t\t<div class=\"error-text-block\"></div>\r\n\t\t</div>\r\n\t</div>`;\r\n\r\nexport type InputParams = {\r\n\telement: string,\r\n\tid: string,\r\n\tlabel: string,\r\n\tvalue: string,\r\n\ttype: string,\r\n\tname: string,\r\n\trequired: boolean,\r\n\terrorText: string,\r\n\tvalidationType: string,\r\n\tclassList: string,\r\n\tonBlur: (event: Event) => void\r\n}\r\n\r\nexport default class Input extends Block {\r\n\t//params: InputParams\r\n\r\n\tconstructor(params: InputParams, template: string) {\r\n\t\tif (!template){\r\n\t\t\ttemplate = inputBlockTemplate;\r\n\t\t}\r\n\t\tsuper(params, template);\r\n\t}\r\n\r\n\tinsertBlock(element: string, clean: boolean): Record<string, HTMLElement> {\r\n\r\n\t\tconst insertedBlock = super.insertBlock(element, clean);\r\n\t\tconst $this = this;\r\n\t\tif (insertedBlock.inner){\r\n\t\t\tconst input = insertedBlock.inner.querySelector('input');\r\n\t\t\tif (input){\r\n\t\t\t\tinput.addEventListener('focus', function(){\r\n\t\t\t\t\tthis.classList.add('focus-input');\r\n\t\t\t\t});\r\n\t\t\t\tinput.addEventListener('blur', function(event){\r\n\t\t\t\t\tthis.classList.remove('focus-input');\r\n\t\t\t\t\t$this.props.onBlur(event);\r\n\t\t\t\t\tvalidValue(this);\r\n\t\t\t\t});\r\n\t\t\t}\t\t\t\r\n\t\t}\r\n\t\treturn insertedBlock;\r\n\t}\r\n}","//Блок кнопки\r\n\r\nimport Block from '../elements/block';\r\n\r\nconst buttonBlockTemplate = `<button id=\"{{id}}\" class=\"button-link {{classes}}\">{{name}}</button>`;\r\n\r\nexport type ButtonParams = {\r\n\telement: string,\r\n\tid: string,\r\n\tclasses: string,\r\n\tname: string,\r\n\tonClick: (event: Event) => void\r\n}\r\n\r\nexport default class Button extends Block {\r\n\r\n\tconstructor(params: ButtonParams, template: string) {\r\n\t\tif (!template){\r\n\t\t\ttemplate = buttonBlockTemplate;\r\n\t\t}\r\n\t\tsuper(params, template);\r\n\t}\r\n\r\n\tinsertBlock(element: string, clean: boolean): Record<string, HTMLElement> {\r\n\t\tconst insertedBlock = super.insertBlock(element, clean);\r\n\t\tif (insertedBlock.inner){\r\n\t\t\tinsertedBlock.inner.addEventListener('click', this.props.onClick);\r\n\t\t\tinsertedBlock.inner.addEventListener('touchstart', this.props.onClick);\t\t\t\r\n\t\t}\r\n\t\treturn insertedBlock;\r\n\t}\r\n}","import Router from './Router';\r\n\r\nexport const router = new Router('#app');","import Route from './route';\r\nimport Block from '../elements/block';\r\n\r\nclass Router {\r\n\troutes: Route[];\r\n\thistory: History;\r\n\tcurrentRoute: Route | null;\r\n\trootQuery: string;\r\n\tpathnames: string[];\r\n\tonRouteCallback: () => void;\r\n\tunprotectedPaths: `/${string}`[];\r\n\tinstance: Router;\r\n\r\n\tconstructor(rootQuery: string) {\r\n\t\tif (Router.instance) {\r\n\t\t\treturn Router.instance;\r\n\t\t}\r\n\t\tthis.routes = [];\r\n\t\tthis.pathnames = [];\r\n\t\tthis.unprotectedPaths = [];\r\n\t\t\r\n\t\tthis.currentRoute = null;\r\n\t\tthis.rootQuery = rootQuery;\r\n\t\tthis.onRouteCallback = () => {};\r\n\t\t//Router.instance = this;\r\n\t\tif (window){\r\n\t\t\tthis.history = window.history;\r\n\t\t}\r\n\t}\r\n\r\n\tgetCurrentRoute() {\r\n\t\treturn this.currentRoute;\r\n\t}\r\n\r\n\tuse(pathname: string, block: typeof Block) {\r\n\t\tconst route = new Route(pathname, block, { rootQuery: this._rootQuery });\r\n\t\tthis.routes.push(route);\r\n\t\tthis.pathnames.push(pathname);\r\n\t\treturn this;\r\n\t}\r\n\r\n\thasRoute(pathname: string) {\r\n\t\tif (!this.pathnames.includes(pathname)) {\r\n\t\t\treturn '*';\r\n\t\t}\r\n\t\treturn pathname;\r\n\t}\r\n\r\n\tstart() {\r\n\t\twindow.onpopstate = () => {\r\n\t\tconst pathname = this.hasRoute(window.location.pathname);\r\n\t\t\tthis.onRoute(pathname);\r\n\t\t};\r\n\t\tconst pathname = this.hasRoute(window.location.pathname);\r\n\t\tthis.onRoute(pathname);\r\n\t}\r\n\r\n\tonRoute(pathname: string) {\r\n\t\tconst route = this.getRoute(pathname);\r\n\t\tif (!route) {\r\n\t\t\treturn;\r\n\t\t}\r\n\t\tif (this.currentRoute) {\r\n\t\t\tthis.currentRoute.leave();\r\n\t\t}\r\n\t\tthis.currentRoute = route;\r\n\t\troute.render();\r\n\t\tif (!this.unprotectedPaths.includes(pathname as `/${string}`)) {\r\n\t\t\tthis.onRouteCallback();\r\n\t\t}\r\n\t}\r\n\r\n\tsetUnprotectedPaths(paths: `/${string}`[]) {\r\n\t\tthis.unprotectedPaths = paths;\r\n\t\treturn this;\r\n\t}\r\n\r\n\tgo(pathname: string) {\r\n\t\tthis.history.pushState({}, '', pathname);\r\n\t\tthis.onRoute(pathname);\r\n\t}\r\n\r\n\tback() {\r\n\t\tthis.history.back();\r\n\t}\r\n\r\n\tforward() {\r\n\t\tthis.history.forward();\r\n\t}\r\n\r\n\tgetRoute(pathname: string) {\r\n\t\treturn this.routes.find((route) => route.match(pathname));\r\n\t}\r\n\r\n\tgetLocationPathname() {\r\n\t\treturn window.location.pathname;\r\n\t}\r\n}\r\n\r\nexport default Router;","import Block, { PropsType } from '../elements/block';\r\n\r\nfunction isEqual(lhs: string, rhs: string) {\r\n\treturn lhs === rhs;\r\n}\r\n\r\nfunction renderBlock(query: string, block: Block) {\r\n\tconst root = document.querySelector(query);\r\n\tif (root && block) {\r\n\t\t//root.append(block.getContent());\r\n\t\treturn root;\r\n\t}\r\n\treturn false;\r\n}\r\n\r\nclass Route {\r\n\tpathname: string;\r\n\tblockClass: typeof Block;\r\n\tblock: Block | null;\r\n\tprops: PropsType;\r\n\r\n\tconstructor(pathname: string, view: typeof Block, props: PropsType) {\r\n\t\tthis.pathname = pathname;\r\n\t\tthis.blockClass = view;\r\n\t\tthis.block = null;\r\n\t\tthis.props = props;\r\n\t}\r\n\r\n\tgetPathname() {\r\n\t\treturn this.pathname;\r\n\t}\r\n\r\n\tleave() {\r\n\t\tif (this.block && (Object.keys(this.block).length)) {\r\n\t\t\tthis.block.destroy();\r\n\t\t}\r\n\t}\r\n\r\n\tmatch(pathname: string) {\r\n\t\treturn isEqual(pathname, this.pathname);\r\n\t}\r\n\r\n\trender() {\r\n\t\t//if (!this.block) {\r\n\t\t\tthis.block = new this.blockClass();\r\n\t\t\trenderBlock(this.props.rootQuery, this.block);\r\n\t\t\treturn;\r\n\t\t//}\r\n\t\t//if (this.block && (Object.keys(this.block).length)) {\r\n\t\t//\tthis.block.show();\r\n\t\t//}\r\n\t}\r\n}\r\n\r\nexport default Route;","import apiAuthorization from '../api/apiAuthorization';\r\nimport { router } from '../utilities/createRouter';\r\nimport { AuthorizationSignInInterface, AuthorizationSignUpInterface } from '../interfaces/interfaces';\r\nimport { showBodyMask, hideBodyMask } from '../utilities/effects';\r\n\r\nfunction afterAuthorizationAnswer(answer, callback, redirect: string){\r\n\tif (answer.error && callback){\r\n\t\tif (answer.reason){\r\n\t\t\tcallback(answer.reason);\r\n\t\t} else {\r\n\t\t\tcallback(answer.error);\r\n\t\t}\t\t\t\t\r\n\t} else {\r\n\t\tif (redirect){\r\n\t\t\trouter.go(redirect);\r\n\t\t}\t\t\r\n\t}\r\n\thideBodyMask();\r\n}\r\n\r\nfunction afterAuthorizationError(error, callback, redirect: string){\r\n\tif (error.response && callback){\r\n\t\tcallback(error.response);\r\n\t} else {\r\n\t\trouter.go(redirect);\r\n\t}\r\n\thideBodyMask();\r\n}\r\n\r\nclass AuthentificationController2 {\r\n\tsignIn(user: AuthorizationSignInInterface, callback) {\r\n\t\tshowBodyMask();\r\n\t\treturn apiAuthorization.signIn(user)\r\n\t\t.then((answer) => {\r\n\t\t\tafterAuthorizationAnswer(answer, callback, '/messenger');\r\n\t\t})\r\n\t\t.catch((error) => {\r\n\t\t\tconsole.error(error);\r\n\t\t\tafterAuthorizationError(error, callback, '/500');\r\n\t\t});\r\n\t}\r\n\r\n\tsignUp(user: AuthorizationSignUpInterface, callback) {\r\n\t\tshowBodyMask();\r\n\t\treturn apiAuthorization.signUp(user)\r\n\t\t.then((answer) => {\r\n\t\t\tafterAuthorizationAnswer(answer, callback, '/messenger');\r\n\t\t})\r\n\t\t.catch((error) => {\r\n\t\t\tconsole.error(error);\r\n\t\t\tafterAuthorizationError(error, callback, '/500');\r\n\t\t});\r\n\t}\r\n\r\n\tsignOut() {\r\n\t\tshowBodyMask();\r\n\t\treturn apiAuthorization.signOut()\r\n\t\t.then((answer) => {\r\n\t\t\thideBodyMask();\r\n\t\t\trouter.go('/');\r\n\t\t});\r\n\t}\r\n\r\n\tcheckAuth(callback) {\r\n\t\treturn apiAuthorization.checkAuth()\r\n\t\t.then((answer) => {\r\n\t\t\tcallback(answer);\r\n\t\t\t//afterAuthorizationAnswer(answer, callback, '/messenger');\t\t\r\n\t\t})\r\n\t\t.catch((error) => {\r\n\t\t\tconsole.error(error);\r\n\t\t\thideBodyMask();\r\n\t\t\trouter.go('/');\r\n\t\t});\r\n\t}\r\n}\r\n\r\nexport default new AuthentificationController2();","import APIBase from './apiBase';\r\nimport { AuthorizationSignInInterface, AuthorizationSignUpInterface } from '../interfaces/interfaces';\r\n\r\nclass APIAuthorization extends APIBase {\r\n\tconstructor() {\r\n\t\tsuper('','/auth');\r\n\t}\r\n\r\n\tsignIn(data: AuthorizationSignInInterface) {\r\n\t\treturn this.post('/signin', {\r\n\t\t\twithCredentials: true,\r\n\t\t\tdata: JSON.stringify(data),\r\n\t\t});\r\n\t}\r\n\r\n\tsignUp(data: AuthorizationSignUpInterface) {\r\n\t\treturn this.post('/signup', {\r\n\t\t\tdata: JSON.stringify(data),\r\n\t\t});\r\n\t}\r\n\r\n\tcheckAuth() {\r\n\t\treturn this.get('/user', {\r\n\t\t\twithCredentials: true,\r\n\t\t});\r\n\t}\r\n\r\n\tsignOut() {\r\n\t\treturn this.post('/logout', {\r\n\t\t\twithCredentials: true,\r\n\t\t});\r\n\t}\r\n}\r\n\r\nexport default new APIAuthorization();","import HTTPTransport from '../utilities/HTTPTransport';\r\n\r\nconst defaultHeaders = {\r\n\t'Content-type': 'application/json',\r\n};\r\n\r\nclass APIBase {\r\n\thttp: typeof HTTPTransport;\r\n\tbaseHref: string;\r\n\tpath: string;\r\n\theaders: Record<string, string>;\r\n\r\n\tconstructor(baseHref: string, path: string, headers: Record<string, string>) {\r\n\t\tthis.http = HTTPTransport;\r\n\t\tthis.baseHref = baseHref || \"https://ya-praktikum.tech/api/v2\";\r\n\t\tthis.path = path || '';\r\n\t\tthis.headers = defaultHeaders;\r\n\t}\r\n\r\n\tgetPath() {\r\n\t\treturn this.baseHref + this.path;\r\n\t}\r\n\r\n\thandleOptions(newOptions: Record<any, any>) {\r\n\t\tconst options = newOptions || {};\r\n\t\tif (newOptions.headers){\r\n\t\t\toptions.headers = newOptions.headers\r\n\t\t} else {\r\n\t\t\toptions.headers = this.headers\r\n\t\t}\r\n\t\treturn options;\r\n\t}\r\n\r\n\thandleResponse(res: XMLHttpRequest) {\r\n\t\tif (res.response == 'OK') {\r\n\t\t\treturn {ok: true};\r\n\t\t}\r\n\t\tlet response = JSON.parse(res.response);\r\n\t\treturn response;\r\n\t}\r\n\r\n\tgetHeaders() {\r\n\t\treturn this.headers;\r\n\t}\r\n\r\n\tget(endpoint: `/${string}`, options?: {}) {\r\n\t\treturn this.http.get(this.getPath() + endpoint, this.handleOptions(options))\r\n\t\t.then(this.handleResponse);\r\n\t}\r\n\r\n\tpost(endpoint: `/${string}`, options?: {}) {\r\n\t\treturn this.http.post(this.getPath() + endpoint, this.handleOptions(options))\r\n\t\t.then(this.handleResponse);\r\n\t}\r\n\r\n\tput(endpoint: `/${string}`, options?: {}) {\r\n\t\treturn this.http.put(this.getPath() + endpoint, this.handleOptions(options))\r\n\t\t.then(this.handleResponse);\r\n\t}\r\n\r\n\tdelete(endpoint: `/${string}`, options?: {}) {\r\n\t\treturn this.http.delete(this.getPath() + endpoint, this.handleOptions(options))\r\n\t\t.then(this.handleResponse);\r\n\t}\r\n}\r\n\r\nexport default APIBase;","//HTTPTransport\r\nconst METHODS = {\r\n\tGET: 'GET',\r\n\tPOST: 'POST',\r\n\tPUT: 'PUT',\r\n\tDELETE: 'DELETE',\r\n};\r\n\r\nfunction queryStringify(data) {\r\n\tlet result: string = \"\";\r\n\tif (typeof data == 'object') {\r\n\t\tresult = \"\"\r\n\t\tfor (let key in data){\r\n\t\t\tif (result == \"\"){\r\n\t\t\t\tresult = result + \"?\"\r\n\t\t\t} else {\r\n\t\t\t\tresult = result + \"&\"\r\n\t\t\t}\r\n\t\t\tresult = result + key + \"=\" + data[key];\r\n\t\t}\r\n\t}\r\n\treturn result;\r\n}\r\n \r\nclass HTTPTransport {\r\n\tget = (url: string, options = {}) => {\r\n\t\treturn this.request(url, {...options, method: METHODS.GET}, options.timeout);\r\n\t};\r\n\r\n\tpost = (url: string, options = {}) => {\r\n\t\treturn this.request(url, {...options, method: METHODS.POST}, options.timeout);\r\n\t};\r\n\r\n\tput = (url: string, options = {}) => {\r\n\t\treturn this.request(url, {...options, method: METHODS.PUT}, options.timeout);\r\n\t};\r\n\r\n\tdelete = (url: string, options = {}) => { \r\n\t\treturn this.request(url, {...options, method: METHODS.DELETE}, options.timeout);\r\n\t};\r\n\r\n\trequest = (url: string, options = {}, timeout = 5000) => {\r\n\t\treturn new Promise(function(resolve, reject) {\r\n\t\t\tconst xhr = new XMLHttpRequest();\r\n\r\n\t\t\tif ((options.method == METHODS.GET) && options.data && (typeof options.data == 'object')){\r\n\t\t\t\txhr.open(options.method, queryStringify(options.data));\r\n\t\t\t} else {\r\n\t\t\t\txhr.open(options.method, url);\r\n\t\t\t}\r\n\r\n\t\t\tfor (let key in options.headers){\r\n\t\t\t\txhr.setRequestHeader(key, options.headers[key]);\r\n\t\t\t}\r\n\r\n\t\t\tif (options.withCredentials) {\r\n\t\t\t\txhr.withCredentials = true;\r\n\t\t\t}\r\n\r\n\t\t\txhr.onload = function() {\r\n\t\t\t\tresolve(xhr);\r\n\t\t\t};\r\n\r\n\t\t\txhr.onabort = reject;\r\n\t\t\txhr.onerror = reject;\r\n\r\n\t\t\txhr.timeout = timeout;\r\n\t\t\txhr.ontimeout = reject;\r\n\r\n\t\t\tif (options.method === METHODS.GET || !options.data) {\r\n\t\t\t\txhr.send();\r\n\t\t\t} else {\r\n\t\t\t\txhr.send(options.data);\r\n\t\t\t}\r\n\t\t});\r\n\t};\r\n}\r\n\r\nexport default new HTTPTransport();","export function showBodyMask(){\r\n\tdocument.getElementById(\"app\").classList.add('loading');\r\n}\r\n\r\nexport function hideBodyMask(){\r\n\tdocument.getElementById(\"app\").classList.remove('loading');\r\n}","//Блок textarea\r\n\r\nimport Block from '../elements/block';\r\n\r\nconst textareaBlockTemplate = `\r\n\t<div class=\"form-block\">\r\n\t\t<textarea id=\"{{id}}\"  data-required=\"{{required}}\" name=\"{{name}}\" value=\"{{value}}\"></textarea>\r\n\t</div>\r\n\t`;\r\n\r\nexport type TextareaParams = {\r\n\telement: string,\r\n\tid: string,\r\n\tname: string,\r\n\tvalue: string,\r\n\trequired: boolean,\r\n}\r\n\r\nexport default class Textarea extends Block {\r\n\t//params: InputParams\r\n\r\n\tconstructor(params: TextareaParams, template: string) {\r\n\t\tif (!template){\r\n\t\t\ttemplate = textareaBlockTemplate;\r\n\t\t}\r\n\t\tsuper(params, template);\r\n\t}\r\n\r\n\tinsertBlock(element: string, clean: boolean): Record<string, HTMLElement> {\r\n\r\n\t\tconst insertedBlock = super.insertBlock(element, clean);\r\n\t\tif (insertedBlock.inner){\r\n\t\t\tconst textarea = insertedBlock.inner.querySelector('textarea');\r\n\t\t\tif (textarea){\r\n\t\t\t\ttextarea.addEventListener('focus', function(){\r\n\t\t\t\t\tthis.classList.add('focus-input');\r\n\t\t\t\t});\r\n\t\t\t\ttextarea.addEventListener('blur', function(){\r\n\t\t\t\t\tthis.classList.remove('focus-input');\r\n\t\t\t\t});\r\n\t\t\t}\r\n\t\t}\r\n\t\treturn insertedBlock;\r\n\t}\r\n}","//Блок select\r\n\r\nimport Block from '../elements/block';\r\n\r\nconst selectBlockTemplate = `\r\n\t<div class=\"form-block {{classList}}\">\r\n\t\t<label class=\"form-label\" for=\"{{id}}\">{{label}}</label>\r\n\t\t<div class=\"select-wrapper  wrapper-element clear\">\r\n\t\t\t<div class=\"select-block\">\r\n\t\t\t\t<select id=\"{{id}}\" name=\"{{name}}\" data-required=\"{{required}}\" data-error-text=\"{{errorText}}\">\r\n\t\t\t\t\t<option value=\"\" selected disabled></option>\r\n\t\t\t\t</select>\r\n\t\t\t</div>\r\n\t\t\t<div class=\"error-text-block\"></div>\r\n\t\t</div>\r\n\t</div>`;\r\n\r\nexport type SelectParams = {\r\n\telement: string,\r\n\tid: string,\r\n\tname: string,\r\n\tclassList: string,\r\n\tlabel: string,\r\n\terrorText: string,\r\n\trequired: boolean\r\n}\r\n\r\nexport default class Select extends Block {\r\n\r\n\tconstructor(params: SelectParams, template: string, noTagName: boolean = true) {\r\n\t\tif (!template){\r\n\t\t\ttemplate = selectBlockTemplate;\r\n\t\t}\r\n\t\tsuper(params, template, noTagName);\r\n\t}\r\n}","//Блок option\r\n\r\nimport Block from '../elements/block';\r\n\r\nconst optionBlockTemplate = `<option value=\"{{value}}\">{{name}}</option>`;\r\n\r\nexport type OptionParams = {\r\n\telement: string,\r\n\tvalue: string,\r\n\tname: string,\r\n}\r\n\r\nexport default class Option extends Block {\r\n\r\n\tconstructor(params: OptionParams, template: string) {\r\n\t\tif (!template){\r\n\t\t\ttemplate = optionBlockTemplate;\r\n\t\t}\r\n\t\tsuper(params, template, true);\r\n\t}\r\n}","//Блок ссылки\r\n\r\nimport Block from '../elements/block';\r\n\r\nconst linkBlockTemplate = `<a id=\"{{id}}\" class=\"{{classes}}\" href=\"{{href}}\">{{name}}</a>`;\r\n\r\nexport type LinkParams = {\r\n\telement: string,\r\n\tid: string,\r\n\tclasses: string,\r\n\tname: string,\r\n\thref: string,\r\n\tonClick: (event: Event) => void\r\n}\r\n\r\nexport default class Link extends Block {\r\n\r\n\tconstructor(params: LinkParams, template: string, noTagName: boolean = false) {\r\n\t\tif (!template){\r\n\t\t\ttemplate = linkBlockTemplate;\r\n\t\t}\r\n\t\tsuper(params, template, noTagName);\r\n\t}\r\n\r\n\tinsertBlock(element: string, clean: boolean): Record<string, HTMLElement> {\r\n\t\tconst insertedBlock = super.insertBlock(element, clean);\r\n\t\tif (insertedBlock.inner){\r\n\t\t\tinsertedBlock.inner.addEventListener('click', this.props.onClick);\r\n\t\t\tinsertedBlock.inner.addEventListener('touchstart', this.props.onClick);\r\n\t\t}\r\n\t\treturn insertedBlock;\r\n\t}\r\n}","//Блок ссылки в меню\r\n\r\nimport Link from '../elements/link-block';\r\n\r\nconst menuLinkBlockTemplate = `<li id=\"{{id}}\" class=\"{{wrapClasses}}\"><a class=\"{{classes}}\" href=\"{{href}}\">{{name}}</a></li>`;\r\n\r\nexport type MenuLinkParams = {\r\n\telement: string,\r\n\tid: string,\r\n\tclasses: string,\r\n\twrapClasses: string,\r\n\tname: string,\r\n\thref: string,\r\n\tonClick: (event: Event) => void\r\n}\r\n\r\nexport default class MenuLink extends Link {\r\n\r\n\tconstructor(params: MenuLinkParams, template: string, noTagName: boolean = true) {\r\n\t\tif (!template){\r\n\t\t\ttemplate = menuLinkBlockTemplate;\r\n\t\t}\r\n\t\tsuper(params, template, noTagName);\r\n\t}\r\n}","//Блок чата (общий)\r\n\r\nimport Block from '../elements/block';\r\n\r\nconst chatWrapperTemplate = `\r\n\t<div class=\"chat-form-page clear\">\r\n\t\t<div class=\"chat-list-column\" id=\"chatList\">\r\n\t\t\t<div class=\"profile-block clear\"></div>\r\n\t\t\t<ul class=\"menu-list none-block\" id=\"menuBlock\"></ul>\r\n\t\t\t<!--<form class=\"search-wrapper\">\r\n\t\t\t\t<input class=\"input-styles search-input\" type=\"text\" placeholder=\"Поиск\" name=\"search\">\r\n\t\t\t</form> -->\r\n\t\t\t<div class=\"chat-list\" id=\"chatListBlock\"></div>\r\n\t\t</div>\r\n\t\t<div class=\"chat-full-block\" id=\"chatFullBlock\">\r\n\t\t\t<div class=\"chat-full-name\"></div>\r\n\t\t\t<div class=\"select-chat-wrapper\" id=\"selectChat\">\r\n\t\t\t\t<div class=\"select-chat-cell\">\r\n\t\t\t\t\t<span>Выберите чат</span>\r\n\t\t\t\t</div>\r\n\t\t\t</div>\r\n\t\t\t<div class=\"chat-wrapper\" id=\"chatWrapper\"><div class=\"chat\" id=\"chat\"></div></div>\r\n\t\t</div>\r\n\t</div>\r\n\t`;\r\n\r\nexport type ChatParams = Record<string, unknown>;\r\n\r\nexport default class Chat extends Block {\r\n\r\n\tconstructor(params: ChatParams, template: string) {\r\n\t\tif (!template){\r\n\t\t\ttemplate = chatWrapperTemplate;\r\n\t\t}\r\n\t\tsuper(params, template);\r\n\t}\r\n}","//Блок чата (пользователь)\r\n\r\nimport Block from '../elements/block';\r\n\r\nconst chatBlockTemplate = `\r\n\t<div class=\"chat-block\" id=\"{{id}}\" data-user-name=\"{{title}}\">\r\n\t\t<div class=\"chat-photo-wrapper\">\r\n\t\t\t<img class=\"chat-photo\" src=\"{{avatar}}\" alt=\"\">\r\n\t\t</div>\r\n\t\t<div class=\"chat-name\">{{title}}</div>\r\n\t\t<div class=\"chat-preview-text\">\r\n\t\t\t<strong class=\"{{fromMeHideClass}}\">Вы: </strong>\r\n\t\t\t<span>{{text}}</span>\r\n\t\t</div>\r\n\t\t<div class=\"chat-time\">{{time}}</div>\r\n\t\t<div class=\"new-messages-info {{newMessageHideClass}}\">{{newMessageCount}}</div>\r\n\t\t<a class=\"delete-chat-button\" href=\"#\">X</a>\r\n\t</div>`;\r\n\r\nexport type ChatBlockParams = {\r\n\telement: string,\r\n\tid: string,\r\n\tavatar: string,\r\n\tphotoAlt: string,\r\n\ttitle: string,\r\n\tfromMeHideClass: string,\r\n\ttext: string,\r\n\ttime: string,\r\n\tnewMessageHideClass: string,\r\n\tnewMessageCount: number,\r\n\tonClick: (this, event: Event) => void\r\n};\r\n\r\nexport default class ChatBlock extends Block {\r\n\r\n\tconstructor(params: ChatBlockParams, template: string) {\r\n\t\tif (!template){\r\n\t\t\ttemplate = chatBlockTemplate;\r\n\t\t}\r\n\t\tsuper(params, template);\r\n\t}\r\n\r\n\tinsertBlock(element: string, clean: boolean): Record<string, HTMLElement> {\r\n\t\tconst insertedBlock = super.insertBlock(element, clean);\r\n\t\tif (insertedBlock.inner){\r\n\t\t\tinsertedBlock.inner.addEventListener('click', this.props.onClick);\r\n\t\t}\r\n\t\treturn insertedBlock;\r\n\t}\r\n}","//Имя чата\r\n\r\nimport Block from '../elements/block';\r\n\r\nconst chatNameTemplate = `{{name}}`;\r\n\r\nexport type ChatNameData = {\r\n\telement: string,\r\n\tname: string,\r\n\tid: number,\r\n};\r\n\r\nexport default class ChatName extends Block {\r\n\r\n\tconstructor(params: ChatNameData, template: string) {\r\n\t\tif (!template){\r\n\t\t\ttemplate = chatNameTemplate;\r\n\t\t}\r\n\t\tsuper(params, template);\r\n\t}\r\n}","//Названия файлов\r\n\r\nimport Block from '../elements/block';\r\n\r\nconst filesNameTemplate = `<div class=\"files-names\">{{name}}</div>`;\r\n\r\nexport type FilesNameData = {\r\n\telement: string,\r\n\tname: string,\r\n};\r\n\r\nexport default class FilesName extends Block {\r\n\r\n\tconstructor(params: FilesNameData, template: string) {\r\n\t\tif (!template){\r\n\t\t\ttemplate = filesNameTemplate;\r\n\t\t}\r\n\t\tsuper(params, template);\r\n\t}\r\n}","//Блок сообщения\r\n\r\nimport Block from '../elements/block';\r\n\r\nconst messageBlockTemplate = `\r\n\t<div class=\"chat-message-wrapper {{toMeClass}}\">\r\n\t\t<div class=\"chat-message-block\">\r\n\t\t\t<div class=\"chat-message-time\">{{time}}</div>\r\n\t\t\t<div>\r\n\t\t\t\t{{text}}\r\n\t\t\t</div>\r\n\t\t</div>\r\n\t</div>`;\r\n\r\nexport type MessageBlockParams = {\r\n\telement: string,\r\n\ttoMeClass: string, //message-to-me\r\n\ttext: string,\r\n\ttime: string,\r\n};\r\n\r\nexport default class MessageBlock extends Block {\r\n\r\n\tconstructor(params: MessageBlockParams, template: string) {\r\n\t\tif (!template){\r\n\t\t\ttemplate = messageBlockTemplate;\r\n\t\t}\r\n\t\tsuper(params, template);\r\n\t}\r\n\r\n}","//Блок модального окна\r\n\r\nimport Block from '../elements/block';\r\n//import Input, { InputParams } from '../elements/input-block'; - может пригодиться позже при использовании форм в окне\r\n\r\nconst modalTemplate = `\r\n\t<div class=\"warning-message-wrapper warning-on\" id=\"{{id}}\">\r\n\t\t<div class=\"warning-message-table\">\r\n\t\t\t<div class=\"warning-message-block\">\r\n\t\t\t\t<div class=\"warning-message\" data-chatId=\"{{chatId}}\">\r\n\t\t\t\t\t\t<span>{{MessageText}}</span>\r\n\t\t\t\t\t\t<!--<div class=\"form-block\">\r\n\t\t\t\t\t\t\t<label>Логин</label>\r\n\t\t\t\t\t\t\t<div class=\"input-wrapper\">\r\n\t\t\t\t\t\t\t\t<input class=\"form-control input-styles\" type=\"text\">\r\n\t\t\t\t\t\t\t\t<div class=\"error-text-block none-block\"></div>\r\n\t\t\t\t\t\t\t</div>\r\n\t\t\t\t\t\t</div>-->\r\n\t\t\t\t\t<div class=\"warning-buttons-wrapper\"></div>\r\n\t\t\t\t</div>\r\n\t\t\t</div>\r\n\t\t</div>\r\n\t</div>`;\r\n\r\nexport type ModalParams = {\r\n\telement: string,\r\n\tid: string,\r\n\tchatId: number,\r\n\tMessageText: string,\r\n};\r\n\r\nexport default class Modal extends Block {\r\n\r\n\tconstructor(params: ModalParams, template: string) {\r\n\t\tif (!template){\r\n\t\t\ttemplate = modalTemplate;\r\n\t\t}\r\n\t\tsuper(params, template);\r\n\t}\r\n}","import apiChats from '../api/apiChats';\r\nimport { router } from '../utilities/createRouter';\r\nimport { ChatCreateInterface, ChatAddUserInterface } from '../interfaces/interfaces';\r\nimport { showBodyMask, hideBodyMask } from '../utilities/effects';\r\n\r\nfunction afterChatAnswer(answer, callback, redirect: string){\r\n\tif (answer.error && callback){\r\n\t\tif (answer.reason){\r\n\t\t\tcallback(answer.reason);\r\n\t\t} else {\r\n\t\t\tcallback(answer.error);\r\n\t\t}\t\t\t\t\r\n\t} else {\r\n\t\tif (redirect){\r\n\t\t\trouter.go(redirect);\r\n\t\t}\t\t\r\n\t}\t\r\n}\r\n\r\nfunction afterChatError(error, callback, redirect: string){\r\n\tconsole.error(error);\r\n\tif (error.response && callback){\r\n\t\tcallback(error.response);\r\n\t} else {\r\n\t\trouter.go(redirect);\r\n\t}\r\n\thideBodyMask();\r\n}\r\n\r\nclass ChatController {\r\n\r\n\tgetChats(callback) {\r\n\t\tshowBodyMask();\r\n\t\treturn apiChats.getChats()\r\n\t\t.then((answer) => {\r\n\t\t\tcallback(answer);\r\n\t\t\thideBodyMask();\r\n\t\t})\r\n\t\t.catch((error) => {\r\n\t\t\tafterChatError(error);\r\n\t\t});\r\n\t}\r\n\r\n\tcreateChat(data: ChatCreateInterface, callback) {\r\n\t\tshowBodyMask();\r\n\t\treturn apiChats.createChat(data)\r\n\t\t.then((answer) => {\r\n\t\t\tcallback(answer.id);\r\n\t\t\thideBodyMask();\r\n\t\t})\r\n\t\t.catch((error) => {\r\n\t\t\tafterChatError(error);\r\n\t\t})\r\n\t}\r\n\r\n\tdeleteChat(chatId: number, callback) {\r\n\t\treturn apiChats.deleteChat(chatId)\r\n\t\t.then((answer) => {\r\n\t\t\tcallback(answer, callback);\r\n\t\t})\r\n\t\t.catch((error) => {\r\n\t\t\tafterChatError(error, callback);\r\n\t\t});\r\n\t}\r\n\r\n\tgetChatToken(chatId: number, callback) {\r\n\t\treturn apiChats.getChatToken(chatId)\r\n\t\t.then((answer) => {\r\n\t\t\tcallback(answer);\r\n\t\t})\r\n\t\t.catch((error) => {\r\n\t\t\tafterChatError(error, callback);\r\n\t\t});\r\n\t}\r\n\r\n\tgetChatUsers(chatId: number, callback) {\r\n\t\treturn apiChats.getChatUsers(chatId)\r\n\t\t.then((answer) => {\r\n\t\t\tcallback(answer);\r\n\t\t})\r\n\t\t.catch((error) => {\r\n\t\t\tafterChatError(error, callback);\r\n\t\t});\r\n\t}\r\n\r\n\taddUsersToChat(data: ChatAddUserInterface, callback) {\r\n\t\tapiChats.addUsersToChat(data)\r\n\t\t.then((answer) => {\r\n\t\t\tcallback(answer);\r\n\t\t})\r\n\t\t.catch((error) => {\r\n\t\t\tafterChatError(error, callback);\r\n\t\t});\r\n\t}\r\n\r\n\tdeleteUserChat(data: ChatAddUserInterface, callback) {\r\n\t\tapiChats.deleteUsersFromChat(data)\r\n\t\t.then((answer) => {\r\n\t\t\tcallback(answer);\r\n\t\t})\r\n\t\t.catch((error) => {\r\n\t\t\tafterChatError(error, callback);\r\n\t\t});\r\n\t}\r\n}\r\n\r\nexport default new ChatController();","import APIBase from './apiBase';\r\nimport { ChatCreateInterface, ChatAddUserInterface } from '../interfaces/interfaces';\r\n\r\nclass APIChats extends APIBase {\r\n\tconstructor() {\r\n\t\tsuper('','/chats');\r\n\t}\r\n\r\n\tcreateChat(data: ChatCreateInterface) {\r\n\t\treturn this.post('/', {\r\n\t\t\twithCredentials: true,\r\n\t\t\tdata: JSON.stringify(data),\r\n\t\t});\r\n\t}\r\n\r\n\tgetChats() {\r\n\t\treturn this.get('/', {\r\n\t\t\twithCredentials: true,\r\n\t\t});\r\n\t}\r\n\r\n\tdeleteChat(chatId: number) {\r\n\t\treturn this.delete('/', {\r\n\t\t\twithCredentials: true,\r\n\t\t\tdata: JSON.stringify({ chatId }),\r\n\t\t});\r\n\t}\r\n\r\n\taddUsersToChat(data: ChatAddUserInterface) {\r\n\t\treturn this.put('/users', {\r\n\t\t\twithCredentials: true,\r\n\t\t\tdata: JSON.stringify(data),\r\n\t\t});\r\n\t}\r\n\r\n\tdeleteUsersFromChat(data: ChatAddUserInterface) {\r\n\t\treturn this.delete('/users', {\r\n\t\t\twithCredentials: true,\r\n\t\t\tdata: JSON.stringify(data),\r\n\t\t});\r\n\t}\r\n\r\n\tgetChatToken(chatId: number) {\r\n\t\treturn this.post(`/token/${chatId}`, {\r\n\t\t\twithCredentials: true,\r\n\t\t});\r\n\t}\r\n\r\n\tgetChatUsers(chatId: number) {\r\n\t\treturn this.get(`/${chatId}/users`, {\r\n\t\t\twithCredentials: true,\r\n\t\t});\r\n\t}\r\n}\r\n\r\nexport default new APIChats();","import apiUser from '../api/apiUser';\r\nimport { router } from '../utilities/createRouter';\r\nimport { UserSearchInterface, UserUpdateInterface , UserUpdatePasswordInterface } from '../interfaces/interfaces';\r\nimport { showBodyMask, hideBodyMask } from '../utilities/effects';\r\n\r\nfunction afterUserAnswer(answer, callback, redirect: string){\r\n\tcallback(answer);\r\n\thideBodyMask();\r\n}\r\n\r\nfunction afterUserError(error, callback, redirect: string){\r\n\tconsole.error(error);\r\n\tif (error.response && callback){\r\n\t\tcallback(error.response);\r\n\t} else {\r\n\t\trouter.go(redirect);\r\n\t}\r\n\thideBodyMask();\r\n}\r\n\r\nclass UsersController {\r\n\r\n\tsearchUsers (data: UserSearchInterface, callback) {\r\n\t\treturn apiUser.searchUsers(data)\r\n\t\t.then((users) => {\r\n\t\t\tcallback(users);\r\n\t\t})\r\n\t\t.catch((error) => {\r\n\t\t\tafterChatError(error);\r\n\t\t});\r\n\t}\r\n\r\n\tgetUserData(userId: number, callback) {\r\n\t\treturn apiUser.getUserData(userId)\r\n\t\t.then((answer) => {\r\n\t\t\tcallback(answer);\r\n\t\t})\r\n\t\t.catch((error) => {\r\n\t\t\tafterUserError(error, callback);\r\n\t\t});\r\n\t}\r\n\r\n\tupdateUserProfile(data: UserUpdateInterface, callback) {\r\n\t\tshowBodyMask();\r\n\t\treturn apiUser.updateUserProfile(data)\r\n\t\t.then((user) => {\r\n\t\t\tafterUserAnswer(user, callback);\r\n\t\t})\r\n\t\t.catch((error) => {\r\n\t\t\tafterUserError(error);\r\n\t\t});\r\n\t}\r\n\r\n\tupdateUserPassword(data: UserUpdatePasswordInterface, callback) {\r\n\t\tshowBodyMask();\r\n\t\treturn apiUser.updateUserPassword(data)\r\n\t\t.then((user) => {\r\n\t\t\tafterUserAnswer(user, callback);\r\n\t\t})\r\n\t\t.catch((error) => {\r\n\t\t\tafterUserError(error);\r\n\t\t});\r\n\t}\r\n\r\n\tupdateUserPhoto(data: FormData, callback) {\r\n\t\tshowBodyMask();\r\n\t\treturn apiUser.updateUserPhoto(data)\r\n\t\t.then((res) => {\r\n\t\t\tafterUserAnswer(res, callback);\r\n\t\t})\r\n\t\t.catch((error) => {\r\n\t\t\tafterUserError(error);\r\n\t\t});\r\n\t}\r\n}\r\n\r\nexport default new UsersController();","import APIBase from './apiBase';\r\nimport { UserSearchInterface, UserUpdateInterface, UserUpdatePasswordInterface } from '../interfaces/interfaces';\r\n\r\nclass APIUser extends APIBase {\r\n\tconstructor() {\r\n\t\tsuper('','/user');\r\n\t}\r\n\r\n\tgetUserData(userId: number) {\r\n\t\treturn this.get(`/${userId}/`, {\r\n\t\t\twithCredentials: true,\r\n\t\t});\r\n\t}\r\n\r\n\tsearchUsers (data: UserSearchInterface) {\r\n\t\treturn this.post('/search', {\r\n\t\t\twithCredentials: true,\r\n\t\t\tdata: JSON.stringify(data),\r\n\t\t});\r\n\t}\r\n\r\n\tupdateUserProfile(data: UserUpdateInterface) {\r\n\t\treturn this.put('/profile', {\r\n\t\t\twithCredentials: true,\r\n\t\t\tdata: JSON.stringify(data),\r\n\t\t});\r\n\t}\r\n\r\n\tupdateUserPassword(data: UserUpdatePasswordInterface) {\r\n\t\treturn this.put('/password', {\r\n\t\t\twithCredentials: true,\r\n\t\t\tdata: JSON.stringify(data),\r\n\t\t});\r\n\t}\r\n\r\n\tupdateUserPhoto(data: FormData) {\r\n\t\tconsole.log(data)\r\n\t\treturn this.put('/profile/avatar', {\r\n\t\t\theaders: {},\r\n\t\t\twithCredentials: true,\r\n\t\t\tdata,\r\n\t\t});\r\n\t}\r\n\r\n}\r\n\r\nexport default new APIUser();","import { MessengerConnectInterface, MessengerGetInterface } from '../interfaces/interfaces';\r\nimport { updateChatMessage } from '../pages/chat';\r\n\r\nconst hostWS = 'wss://ya-praktikum.tech/ws';\r\n\r\nclass MessengerController {\r\n\tws: WebSocket;\r\n\tuserId: number;\r\n\tchatId: number;\r\n\ttoken: string;\r\n\tping: any;\r\n\r\n\tconstructor() {\r\n\t\tthis.onOpen = this.onOpen.bind(this);\r\n\t\tthis.onMessage = this.onMessage.bind(this);\r\n\t\tthis.onError = this.onError.bind(this);\r\n\t\tthis.onClose = this.onClose.bind(this);\r\n\t}\r\n\r\n\taddEvents() {\r\n\t\tthis.ws.addEventListener('open', this.onOpen);\r\n\t\tthis.ws.addEventListener('message', this.onMessage);\r\n\t\tthis.ws.addEventListener('error', this.onError);\r\n\t\tthis.ws.addEventListener('close', this.onClose);\r\n\t}\r\n\r\n\tremoveEvents() {\r\n\t\tthis.ws.removeEventListener('open', this.onOpen);\r\n\t\tthis.ws.removeEventListener('message', this.onMessage);\r\n\t\tthis.ws.removeEventListener('error', this.onError);\r\n\t\tthis.ws.removeEventListener('close', this.onClose);\r\n\t}\r\n\r\n\tonOpen() {\r\n\t\tthis.getMessages({ offset: 0 });\r\n\t}\r\n\r\n\tonMessage(event: MessageEvent) {\r\n\t\tconst data = JSON.parse(event.data);\r\n\t\tupdateChatMessage(data);\r\n\t}\r\n\r\n\tonError(event: ErrorEvent) {\r\n\t\tconsole.error(event.message);\r\n\t}\r\n\r\n\tonClose(event: CloseEventInit) {\r\n\t\tthis.removeEvents();\r\n\t\tif (event.wasClean) {\r\n\t\t\tconsole.log('Соединение закрыто чисто');\r\n\t\t} else {\r\n\t\t\tconsole.log('Проблемы с подключением');\r\n\t\t}\r\n\t\tif (event.code === 1006) {\r\n\t\t\tthis.reconnection();\r\n\t\t}\r\n\t}\r\n\r\n\treconnection() {\r\n\t\tthis.connect({\r\n\t\t\tuserId: this.userId,\r\n\t\t\tchatId: this.chatId,\r\n\t\t\ttoken: this.token,\r\n\t\t});\r\n\t}\r\n\r\n\tconnect(options: MessengerConnectInterface) {\r\n\t\tthis.userId = options.userId;\r\n\t\tthis.chatId = options.chatId;\r\n\t\tthis.token = options.token;\r\n\t\tthis.ws = new WebSocket(hostWS + '/chats/' + options.userId + '/' + options.chatId + '/' + options.token);\r\n\t\tthis.addEvents();\r\n\t}\r\n\r\n\tgetMessages(options: MessengerGetInterface) {\r\n\t\tthis.ws.send(JSON.stringify({\r\n\t\t\tcontent: options.offset.toString(),\r\n\t\t\ttype: 'get old',\r\n\t\t}));\r\n\t}\r\n\r\n\tcloseChat() {\r\n\t\tclearInterval(this.ping);\r\n\t\tthis.ws.close();\r\n\t\tthis.removeEvents();\r\n\t}\r\n\r\n\tsendMessage(message: string) {\r\n\t\tthis.ws.send(JSON.stringify({\r\n\t\t\tcontent: message,\r\n\t\t\ttype: 'message',\r\n\t\t}));\r\n\t}\r\n}\r\n\r\nexport default new MessengerController();","//Страница чата\r\n\r\nimport Form, { FormParams, onSubmitForm } from '../elements/form-block';\r\nimport Textarea, { TextareaParams } from '../elements/textarea-block';\r\nimport Button, { ButtonParams } from '../elements/button-block';\r\nimport Select, { SelectParams } from '../elements/select-block';\r\nimport Option from '../elements/option-block';\r\nimport AddFileButton, { AddFileButtonParams } from '../elements/add-file-block';\r\nimport Link, { LinkParams } from '../elements/link-block';\r\nimport MenuLink, { MenuLinkParams } from '../elements/menu-link-block';\r\nimport Chat, { ChatParams } from '../elements/chat-wrapper';\r\nimport ChatBlock, { ChatBlockParams } from '../elements/chat-block';\r\nimport ChatName, { ChatNameData } from '../elements/chat-name';\r\nimport FilesName, { FilesNameData } from '../elements/files-name';\r\nimport MessageBlock, { MessageBlockParams } from '../elements/message-block';\r\nimport Modal, { ModalParams } from '../elements/modal-block';\r\nimport Input, { InputParams } from '../elements/input-block';\r\n\r\nimport AuthentificationController2 from '../controllers/AuthentificationController2';\r\nimport ChatController from '../controllers/ChatController';\r\nimport UsersController from '../controllers/UsersController';\r\nimport MessengerController from '../controllers/MessengerController';\r\n\r\nimport { router } from '../utilities/createRouter';\r\n\r\n\r\nconst documentTitle: string = \"Чат\";\r\n\r\nlet chatUserId: number = 0;\r\n//let chatMessages = [];\r\nlet chatMessageLastId: number = 0;\r\n\r\nconst chatParams: ChatParams = {};\r\nlet chatName: ChatName;\r\nlet chatNameParams: ChatNameData = {\r\n\telement: '.chat-full-name',\r\n\tname: '',\r\n\tid: 0\r\n};\r\n\r\nconst sendForm: FormParams = {\r\n\ttitle: ''\r\n};\r\n\r\nlet textArea: Textarea;\r\nlet filesName: FilesName;\r\nconst filesNameParams: FilesNameData = {\r\n\telement: '.chat-send-box',\r\n\tname: '',\r\n};\r\nconst sendButton: ButtonParams = {\r\n\telement: '.chat-send-box',\r\n\tid: '',\r\n\tname: ' >',\r\n\tclasses: 'chat-send-button',\r\n\tonClick: (event) => {\r\n\t\tevent.preventDefault();\r\n\t\tonSubmitForm('.chat-send-box', function(answer){\r\n\t\t\tconsole.log(answer)\r\n\t\t\tMessengerController.sendMessage(answer.message);\r\n\t\t\treloadChatSender();\r\n\t\t});\r\n\t},\r\n};\r\n\r\nlet addFile: AddFileButton;\r\nconst addFileButton: AddFileButtonParams = {\r\n\telement: '.chat-send-box',\r\n\tid: 'addFileToMessage',\r\n\tname: '📎',\r\n\tclasses: 'add-file-button',\r\n\tvalue: '',\r\n\tonClick: (event) => {\r\n\t\treturn event;\r\n\t},\r\n\tonChange: (event) => {\r\n\t\tif (event.target && event.target.value){\r\n\t\t\tconst valueArray: [] = event.target.value.split(\"\\\\\");\r\n\t\t\tfilesName.setProps({ name: valueArray[valueArray.length - 1] });\r\n\t\t}\r\n\t},\r\n};\r\n\r\nconst menuLinks: MenuLinkParams[] = [\r\n\t{\r\n\t\telement: '.menu-list',\r\n\t\tid: '',\r\n\t\tclasses: 'create-chat-link',\r\n\t\twrapClasses: '',\r\n\t\tname: 'Создать чат',\r\n\t\thref: '#',\r\n\t\tonClick: (event) => {\r\n\t\t\tevent.preventDefault();\r\n\t\t\tcreateChatClick(event);\r\n\t\t},\r\n\t},\r\n\t{\r\n\t\telement: '.menu-list',\r\n\t\tid: '',\r\n\t\tclasses: 'create-chat-link',\r\n\t\twrapClasses: '',\r\n\t\tname: 'Мой профиль',\r\n\t\thref: '/settings',\r\n\t\tonClick: (event) => {\r\n\t\t\tevent.preventDefault();\r\n\t\t\trouter.go('/settings');\t\r\n\t\t},\r\n\t},\r\n\t{\r\n\t\telement: '.menu-list',\r\n\t\tid: 'addUserToChat',\r\n\t\tclasses: 'create-chat-link',\r\n\t\twrapClasses: 'none-block',\r\n\t\tname: 'Добавить пользователя',\r\n\t\thref: '#',\r\n\t\tonClick: (event) => {\r\n\t\t\tevent.preventDefault();\r\n\t\t\taddUserToChatClick(event);\r\n\t\t},\r\n\t},\r\n\t{\r\n\t\telement: '.menu-list',\r\n\t\tid: 'deleteUserFromChat',\r\n\t\tclasses: 'create-chat-link',\r\n\t\twrapClasses: 'none-block',\r\n\t\tname: 'Удалить пользователя',\r\n\t\thref: '#',\r\n\t\tonClick: (event) => {\r\n\t\t\tevent.preventDefault();\r\n\t\t\tdeleteUserFromChatClick(event);\r\n\t\t},\r\n\t},\r\n\t{\r\n\t\telement: '.menu-list',\r\n\t\tid: '',\r\n\t\tclasses: 'create-chat-link',\r\n\t\twrapClasses: '',\r\n\t\tname: 'Выход',\r\n\t\thref: '/',\r\n\t\tonClick: (event) => {\r\n\t\t\tevent.preventDefault();\r\n\t\t\tAuthentificationController2.signOut();\t\t\r\n\t\t},\r\n\t},\r\n];\r\n\r\nconst chatProfileLinks: LinkParams[] = [\r\n\t{\r\n\t\telement: '.profile-block',\r\n\t\tid: '',\r\n\t\tclasses: 'create-chat-link',\r\n\t\tname: 'Меню',\r\n\t\thref: '#',\r\n\t\tonClick: (event) => {\r\n\t\t\tevent.preventDefault();\r\n\t\t\tdocument.getElementById('menuBlock').classList.toggle('none-block');\r\n\t\t},\r\n\t},\r\n\t{\r\n\t\telement: '.chat-full-name',\r\n\t\tid: '',\r\n\t\tclasses: 'chat-back-button',\r\n\t\tname: 'Закрыть',\r\n\t\thref: '#',\r\n\t\tonClick: (event) => {\r\n\t\t\tevent.preventDefault();\r\n\t\t\tcloseChat();\r\n\t\t},\r\n\t},\r\n];\r\n\r\nconst chatList: ChatBlockParams[] = [\r\n\t{\r\n\t\telement: '.chat-list',\r\n\t\tid: '1',\r\n\t\tphotoLink: '',\r\n\t\tname: 'Андрей Андрейченков',\r\n\t\tphotoAlt: '',\r\n\t\tfromMeHideClass: 'none-block',\r\n\t\ttext: 'Круто!',\r\n\t\ttime: '15.04.2022 15:31',\r\n\t\tnewMessageHideClass: '',\r\n\t\tnewMessageCount: 10,\r\n\t\tonClick: (event) => {\r\n\t\t\tevent.preventDefault();\r\n\t\t\tonChatClick(event);\r\n\t\t},\r\n\t},\r\n\t{\r\n\t\telement: '.chat-list',\r\n\t\tid: '2',\r\n\t\tphotoLink: '',\r\n\t\tname: 'Михалыч',\r\n\t\tphotoAlt: '',\r\n\t\tfromMeHideClass: '',\r\n\t\ttext: 'Отлично!',\r\n\t\ttime: '15.04.2022 15:31',\r\n\t\tnewMessageHideClass: 'none-block',\r\n\t\tnewMessageCount: 0,\r\n\t\tonClick: (event) => {\r\n\t\t\tevent.preventDefault();\r\n\t\t\tonChatClick(event);\r\n\t\t},\r\n\t},\r\n];\r\n\r\nlet messageList: MessageBlockParams[] = [];\r\n\r\nconst textareaParams: TextareaParams = {\r\n\telement: '.chat-send-box',\r\n\tid: 'chatSendBox',\r\n\tname: 'message',\r\n\tvalue: '',\r\n\trequired: true,\r\n};\r\n\r\n//Форма удаления чата\r\n\r\nlet deleteWarningMessage: ModalParams = {\r\n\telement: '#app',\r\n\tid: 'deleteWarningMessage',\r\n\tchatId: 0,\r\n\tMessageText: 'Вы действительно хотите удалить этот чат?',\r\n};\r\n\r\nconst deleteButtons: ButtonParams[] = [\r\n\t{\r\n\t\telement: '.warning-buttons-wrapper',\r\n\t\tid: '',\r\n\t\tname: 'Да',\r\n\t\tclasses: 'warning-add warning-button',\r\n\t\tonClick: (event) => {\r\n\t\t\tevent.preventDefault();\r\n\t\t\t//Вызывать удаление\t\t\r\n\t\t\tChatController.deleteChat(deleteWarningMessage.chatId, function(answer){\r\n\t\t\t\treloadChatList();\r\n\t\t\t\tcloseModal(\"deleteWarningMessage\");\r\n\t\t\t});\r\n\t\t\t\r\n\t\t},\r\n\t},\r\n\t{\r\n\t\telement: '.warning-buttons-wrapper',\r\n\t\tid: '',\r\n\t\tname: 'Нет',\r\n\t\tclasses: 'warning-back warning-button',\r\n\t\tonClick: (event) => {\r\n\t\t\tevent.preventDefault();\r\n\t\t\tcloseModal(\"deleteWarningMessage\");\r\n\t\t},\r\n\t},\r\n];\r\n\r\n//Форма создания чата\r\n\r\nconst createChatModal: ModalParams = {\r\n\telement: '#app',\r\n\tchatId: 0,\r\n\tid: 'createChatModal',\r\n\tMessageText: '',\r\n};\r\n\r\nconst createChatForm: FormParams = {\r\n\ttitle: 'Создать чат',\r\n};\r\n\r\nconst createChatInputs: InputParams[] = [\r\n\t{\r\n\t\telement: '#createChatModal .reg-form-fieldset',\r\n\t\tid: 'chatName',\r\n\t\tname: 'title',\r\n\t\tlabel: 'Название',\r\n\t\tvalue: '',\r\n\t\ttype: 'text',\r\n\t\trequired: true,\r\n\t\terrorText: 'Обязательное поле',\r\n\t\tvalidationType: '',\r\n\t\tclassList: '',\r\n\t\tonBlur: (event) => {}\r\n\t},\r\n];\r\n\r\nconst createChatButtons: ButtonParams[] = [\r\n\t{\r\n\t\telement: '#createChatModal .buttons-wrapper',\r\n\t\tid: '',\r\n\t\tname: 'Создать',\r\n\t\tclasses: 'add-link',\r\n\t\tonClick: (event) => {\r\n\t\t\tevent.preventDefault();\r\n\t\t\tonSubmitForm('#createChatModal .reg-form', function(formData){\r\n\t\t\t\tChatController.createChat(formData, function(answer){\r\n\t\t\t\t\treloadChatList();\r\n\t\t\t\t\tcloseModal(\"createChatModal\");\r\n\t\t\t\t});\r\n\t\t\t});\t\t\t\r\n\t\t},\r\n\t},\r\n\t{\r\n\t\telement: '#createChatModal .buttons-wrapper',\r\n\t\tid: '',\r\n\t\tname: 'Отмена',\r\n\t\tclasses: 'reg-link',\r\n\t\tonClick: (event) => {\r\n\t\t\tevent.preventDefault();\r\n\t\t\tcloseModal(\"createChatModal\");\r\n\t\t},\r\n\t},\r\n];\r\n\r\n\r\n//Форма добавления пользователя в чат\r\n\r\nconst addUserToChatModal: ModalParams = {\r\n\telement: '#app',\r\n\tid: 'addUserToChatModal',\r\n\tchatId: 0,\r\n\tMessageText: '',\r\n};\r\n\r\nconst addUserToChatForm: FormParams = {\r\n\ttitle: 'Добавить пользователя',\r\n};\r\n\r\nconst addUserToChatInputs: InputParams[] = [\r\n\t{\r\n\t\telement: '#addUserToChatModal .reg-form-fieldset',\r\n\t\tid: 'chatName',\r\n\t\tname: 'title',\r\n\t\tlabel: 'Поиск',\r\n\t\tvalue: '',\r\n\t\ttype: 'text',\r\n\t\trequired: false,\r\n\t\terrorText: '',\r\n\t\tvalidationType: '',\r\n\t\tclassList: '',\r\n\t\tonBlur: (event) => {\r\n\t\t\tif (event.target && event.target.value){\r\n\t\t\t\tUsersController.searchUsers({login: event.target.value}, function(answer){\r\n\t\t\t\t\tdocument.getElementById(\"selectUser\").textContent = \"\";\r\n\t\t\t\t\tanswer.forEach(function(user, i) {\r\n\t\t\t\t\t\tanswer[i].name = answer[i].first_name + \" \" + answer[i].second_name;\r\n\t\t\t\t\t\tanswer[i].value = answer[i].id;\r\n\t\t\t\t\t\tnew Option(answer[i], '').insertBlock(\"#selectUser\");\r\n\t\t\t\t\t});\t\t\t\t\t\t\r\n\t\t\t\t});\r\n\t\t\t}\r\n\t\t}\r\n\t},\r\n];\r\n\r\nconst addUserToChatSelect: SelectParams[] = [\r\n\t{\r\n\t\telement: '#addUserToChatModal .reg-form-fieldset',\r\n\t\tid: 'selectUser',\r\n\t\tname: 'user',\r\n\t\tlabel: 'Пользователь',\r\n\t\trequired: true,\r\n\t\terrorText: 'Пользователь не выбран',\r\n\t\tclassList: '',\r\n\t},\r\n];\r\n\r\nconst addUserToChatButtons: ButtonParams[] = [\r\n\t{\r\n\t\telement: '#addUserToChatModal .buttons-wrapper',\r\n\t\tid: '',\r\n\t\tname: 'Добавить',\r\n\t\tclasses: 'add-link',\r\n\t\tonClick: (event) => {\r\n\t\t\tevent.preventDefault();\r\n\t\t\tonSubmitForm('#addUserToChatModal .reg-form', function(formData){\r\n\t\t\t\tconst deleteUserData = {\r\n\t\t\t\t\tusers: [formData.user],\r\n\t\t\t\t\tchatId: parseInt(chatName.props.id)\r\n\t\t\t\t}\r\n\t\t\t\tChatController.addUsersToChat(deleteUserData, function(answer){\r\n\t\t\t\t\treloadChatList();\r\n\t\t\t\t\tcloseModal(\"addUserToChatModal\");\r\n\t\t\t\t});\r\n\t\t\t});\t\t\t\r\n\t\t},\r\n\t},\r\n\t{\r\n\t\telement: '#addUserToChatModal .buttons-wrapper',\r\n\t\tid: '',\r\n\t\tname: 'Отмена',\r\n\t\tclasses: 'reg-link',\r\n\t\tonClick: (event) => {\r\n\t\t\tevent.preventDefault();\r\n\t\t\tcloseModal(\"addUserToChatModal\");\r\n\t\t},\r\n\t},\r\n];\r\n\r\n\r\n//Форма удаления пользователя из чата\r\n\r\nconst deleteUserFromChatModal: ModalParams = {\r\n\telement: '#app',\r\n\tid: 'deleteUserFromChatModal',\r\n\tchatId: 0,\r\n\tMessageText: '',\r\n};\r\n\r\nconst deleteUserFromChatForm: FormParams = {\r\n\ttitle: 'Удалить пользователя',\r\n};\r\n\r\nconst deleteUserFromChatSelect: SelectParams[] = [\r\n\t{\r\n\t\telement: '#deleteUserFromChatModal .reg-form-fieldset',\r\n\t\tid: 'selectUser',\r\n\t\tname: 'user',\r\n\t\tlabel: 'Пользователь',\r\n\t\trequired: true,\r\n\t\terrorText: 'Пользователь не выбран',\r\n\t\tclassList: '',\r\n\t},\r\n];\r\n\r\nconst deleteUserFromChatButtons: ButtonParams[] = [\r\n\t{\r\n\t\telement: '#deleteUserFromChatModal .buttons-wrapper',\r\n\t\tid: '',\r\n\t\tname: 'Удалить',\r\n\t\tclasses: 'add-link',\r\n\t\tonClick: (event) => {\r\n\t\t\tevent.preventDefault();\r\n\t\t\tonSubmitForm('#deleteUserFromChatModal .reg-form', function(formData){\r\n\t\t\t\tconst deleteUserData = {\r\n\t\t\t\t\tusers: [formData.user],\r\n\t\t\t\t\tchatId: parseInt(chatName.props.id)\r\n\t\t\t\t}\r\n\t\t\t\tChatController.deleteUserChat(deleteUserData, function(answer){\r\n\t\t\t\t\treloadChatList();\r\n\t\t\t\t\tcloseModal(\"deleteUserFromChatModal\");\r\n\t\t\t\t});\r\n\t\t\t});\t\t\t\r\n\t\t},\r\n\t},\r\n\t{\r\n\t\telement: '#deleteUserFromChatModal .buttons-wrapper',\r\n\t\tid: '',\r\n\t\tname: 'Отмена',\r\n\t\tclasses: 'reg-link',\r\n\t\tonClick: (event) => {\r\n\t\t\tevent.preventDefault();\r\n\t\t\tcloseModal(\"deleteUserFromChatModal\");\r\n\t\t},\r\n\t},\r\n];\r\n\r\n\r\n//Открываем форму создания чата\r\nfunction createChatClick(event){\r\n\tnew Modal(createChatModal).insertBlock(\"#app\");\r\n\tnew Form(createChatForm).insertBlock(\"#createChatModal\", true);\r\n\r\n\tcreateChatInputs.forEach(function(input) {\r\n\t\tnew Input(input, '').insertBlock(input.element);\r\n\t});\r\n\r\n\tcreateChatButtons.forEach(function(button) {\r\n\t\tnew Button(button).insertBlock(button.element);\r\n\t});\r\n}\r\n\r\n//Открываем форму добавления пользователя в чат\r\nfunction addUserToChatClick(){\r\n\tnew Modal(addUserToChatModal).insertBlock(\"#app\");\r\n\tnew Form(addUserToChatForm).insertBlock(\"#addUserToChatModal\", true);\r\n\r\n\tif (chatName && chatName.props){\r\n\t\tlet chatNameId: number = parseInt(chatName.props.id);\r\n\r\n\t\taddUserToChatInputs.forEach(function(input) {\r\n\t\t\tnew Input(input, '').insertBlock(input.element);\r\n\t\t});\r\n\r\n\t\taddUserToChatSelect.forEach(function(select) {\r\n\t\t\tnew Select(select, '').insertBlock(select.element);\r\n\t\t});\r\n\t}\r\n\t\r\n\r\n\taddUserToChatButtons.forEach(function(button) {\r\n\t\tnew Button(button).insertBlock(button.element);\r\n\t});\r\n}\r\n\r\n//Открываем форму удаления пользователя из чата\r\nfunction deleteUserFromChatClick(event){\r\n\tnew Modal(deleteUserFromChatModal).insertBlock(\"#app\");\r\n\tnew Form(deleteUserFromChatForm).insertBlock(\"#deleteUserFromChatModal\", true);\r\n\r\n\tif (chatName && chatName.props){\r\n\t\tlet chatNameId: number = parseInt(chatName.props.id);\r\n\r\n\t\tdeleteUserFromChatSelect.forEach(function(select) {\r\n\t\t\tnew Select(select, '').insertBlock(select.element);\r\n\t\t});\r\n\r\n\t\t//Получаем список пользователей чата\r\n\t\tChatController.getChatUsers(chatNameId, function(answer){\r\n\t\t\tanswer.forEach(function(user, i) {\r\n\t\t\t\tanswer[i].name = answer[i].first_name + \" \" + answer[i].second_name;\r\n\t\t\t\tanswer[i].value = answer[i].id;\r\n\t\t\t\tnew Option(answer[i], '').insertBlock(\"#selectUser\");\r\n\t\t\t});\r\n\t\t});\r\n\t}\r\n\t\r\n\r\n\tdeleteUserFromChatButtons.forEach(function(button) {\r\n\t\tnew Button(button).insertBlock(button.element);\r\n\t});\r\n}\r\n\r\n//Кликаем по чату - открытие чата, либо удаление\r\nfunction onChatClick(event){\r\n\tconst chatBlock: HTMLElement = event.target.closest(\".chat-block\");\r\n\tconst chatWrapper : HTMLElement = document.getElementById(\"chatWrapper\");\r\n\tif (!chatBlock || !chatWrapper) return;\r\n\r\n\tif (event.target.classList.contains(\"delete-chat-button\") && chatBlock.id){\r\n\t\tdeleteWarningMessage.chatId = chatBlock.id;\r\n\t\tnew Modal(deleteWarningMessage).insertBlock(\"#app\");\r\n\t\tdeleteButtons.forEach(function(button) {\r\n\t\t\tnew Button(button, '').insertBlock(button.element);\r\n\t\t});\r\n\t} else {\r\n\t\tdocument.getElementById(\"chatList\").classList.toggle('chat-full-show');\r\n\t\tdocument.getElementById('menuBlock').classList.add('none-block');\r\n\t\tdocument.getElementById(\"selectChat\").classList.add(\"none-block\");\r\n\t\tdocument.getElementById(\"chatFullBlock\").classList.toggle('chat-full-show');\r\n\t\tdocument.getElementById(\"deleteUserFromChat\").classList.remove(\"none-block\");\r\n\t\tdocument.getElementById(\"addUserToChat\").classList.remove(\"none-block\");\r\n\r\n\t\tdocument.getElementById(\"chat\").textContent = \"\";\r\n\t\tchatMessageLastId = 0;\r\n\r\n\t\t//Получим токен чата\r\n\t\tChatController.getChatToken(chatBlock.id, function(answer){\r\n\t\t\tif (answer && answer.token && chatUserId){\r\n\t\t\t\tMessengerController.connect({\r\n\t\t\t\t\tuserId: chatUserId,\r\n\t\t\t\t\tchatId: parseInt(chatBlock.id),\r\n\t\t\t\t\ttoken: answer.token,\r\n\t\t\t\t});\r\n\t\t\t}\r\n\t\t});\r\n\t\treloadChatSender();\r\n\t\tscrollChatToBottom();\r\n\t\tif (chatName){\r\n\t\t\tchatName.setProps({ name: chatBlock.getAttribute(\"data-user-name\"), id: chatBlock.id });\r\n\t\t}\r\n\t}\r\n}\r\n\r\n//Очистка сообщения после отправки\r\nfunction reloadChatSender(){\r\n\ttextArea.setProps({ value: \"\" });\r\n\tfilesName.setProps({ name: \"\" });\r\n}\r\n\r\n//Закрытие модального окна\r\nfunction closeModal(modalId){\r\n\tdocument.getElementById(modalId).remove();\r\n}\r\n\r\n//Обновляем список чатов\r\nfunction reloadChatList(){\r\n\tdocument.getElementById(\"chatListBlock\").textContent = \"\";\r\n\r\n\tChatController.getChats(function(answer){\r\n\t\tanswer.forEach(function(chat, i){\r\n\t\t\tanswer[i].element = '.chat-list';\r\n\t\t\tanswer[i].photoAlt = '';\r\n\t\t\tanswer[i].newMessageCount = 0;\r\n\t\t\tanswer[i].fromMeHideClass = 'none-block';\r\n\t\t\tanswer[i].newMessageHideClass = 'none-block';\r\n\t\t\tanswer[i].onClick = function(event){\r\n\t\t\t\tevent.preventDefault();\r\n\t\t\t\tonChatClick(event);\r\n\t\t\t}\r\n\r\n\t\t\tnew ChatBlock(answer[i], '').insertBlock(answer[i].element);\r\n\t\t});\r\n\t});\r\n}\r\n\r\n//Закрываем чат\r\nfunction closeChat(){\r\n\tif (chatName){\r\n\t\tchatName.setProps({ name: '', id: 0 });\r\n\t}\r\n\tdocument.getElementById(\"selectChat\").classList.remove(\"none-block\");\r\n\tdocument.getElementById(\"chatList\").classList.remove('chat-full-show');\r\n\tdocument.getElementById(\"chatFullBlock\").classList.remove('chat-full-show');\r\n\tdocument.getElementById(\"deleteUserFromChat\").classList.add(\"none-block\");\r\n\tdocument.getElementById(\"addUserToChat\").classList.add(\"none-block\");\r\n\tMessengerController.closeChat();\r\n}\r\n\r\nfunction updateMessageToChat(message, prepend){\r\n\tif (message.id > chatMessageLastId){\r\n\t\tlet toMeClass = '';\r\n\t\tif (message.user_id == chatUserId){\r\n\t\t\ttoMeClass = 'message-to-me';\r\n\t\t}\r\n\t\tchatMessageLastId = message.id;\r\n\t\tnew MessageBlock({\r\n\t\t\telement: '#chat',\r\n\t\t\ttext: message.content,\r\n\t\t\ttime: formatDate(new Date(message.time)),\r\n\t\t\ttoMeClass: toMeClass\r\n\t\t}, '').insertBlock('#chat', false, prepend);\r\n\t\tscrollChatToBottom();\r\n\t}\t\r\n}\r\n\r\nfunction scrollChatToBottom(){\r\n\tconst chatWrapper : HTMLElement = document.getElementById(\"chatWrapper\");\r\n\tif (chatWrapper){\r\n\t\tchatWrapper.scrollTop = chatWrapper.scrollHeight;\r\n\t}\r\n}\r\n\r\nfunction formatDate(date) {\r\n\tlet dd = date.getDate();\r\n\tif (dd < 10) {\r\n\t\tdd = '0' + dd;\r\n\t}\r\n\r\n\tlet mm = date.getMonth() + 1;\r\n\tif (mm < 10){\r\n\t\tmm = '0' + mm;\r\n\t} \r\n\treturn dd + '.' + mm + '.' + date.getFullYear() + ' ' + \r\n\tdate.getHours() + ':' + date.getMinutes() + ':' + date.getSeconds();\r\n}\r\n\r\n//Добавляем сообщения в чат\r\nexport function updateChatMessage(messages){\r\n\tif (Array.isArray(messages)) {\r\n\t\tif (messages.length) {\r\n\t\t\tmessages.forEach(function(message){\r\n\t\t\t\tupdateMessageToChat(message, true);\r\n\t\t\t});\r\n\t\t}\r\n\t}\r\n\tif ((typeof messages === 'object') && (messages.type === 'message')) {\r\n\t\tupdateMessageToChat(messages, false)\r\n\t}\r\n}\r\n\r\nexport function chat(): void {\r\n\r\n\tdocument.title = documentTitle;\r\n\r\n\tnew Chat(chatParams).insertBlock(\"#app\", true);\r\n\t\r\n\tchatName = new ChatName(chatNameParams);\r\n\tchatName.insertBlock('.chat-full-name');\r\n\r\n\tchatProfileLinks.forEach(function(link) {\r\n\t\tnew Link(link, '').insertBlock(link.element);\r\n\t});\r\n\r\n\tmenuLinks.forEach(function(link) {\r\n\t\tnew MenuLink(link, '').insertBlock(link.element);\r\n\t});\r\n\r\n\tAuthentificationController2.checkAuth(function(answer){\r\n\t\tif (answer.id){\r\n\t\t\tchatUserId = answer.id;\r\n\t\t}\r\n\t})\r\n\r\n\treloadChatList()\r\n\t\r\n\tnew Form(sendForm, '<form class=\"chat-send-box\"></form>').insertBlock(\".chat-full-block\");\r\n\tnew Button(sendButton).insertBlock(\".chat-send-box\");\r\n\r\n\t//addFile = new AddFileButton(addFileButton, '');\r\n\t//addFile.insertBlock(\".chat-send-box\");\r\n\r\n\ttextArea = new Textarea(textareaParams);\r\n\ttextArea.insertBlock(\".chat-send-box\");\r\n\r\n\tfilesName = new FilesName(filesNameParams);\r\n\tfilesName.insertBlock(\".chat-send-box\");\r\n}","//Страница регистрации\r\n\r\nimport Form, { FormParams, onSubmitForm } from '../elements/form-block';\r\nimport Input, { InputParams } from '../elements/input-block';\r\nimport Button, { ButtonParams } from '../elements/button-block';\r\n\r\nimport AuthentificationController2 from '../controllers/AuthentificationController2';\r\n\r\nconst documentTitle = \"Регистрация\";\r\n\r\nconst registrationForm: FormParams = {\r\n\ttitle: 'Регистрация'\r\n};\r\n\r\nconst registrationInputs: InputParams[] = [\r\n\t{\r\n\t\telement: '.reg-form-fieldset',\r\n\t\tid: 'email',\r\n\t\tname: 'email',\r\n\t\tlabel: 'E-mail',\r\n\t\tvalue: '',\r\n\t\ttype: 'text',\r\n\t\trequired: true,\r\n\t\terrorText: 'Неверный формат email',\r\n\t\tvalidationType: 'email',\r\n\t\tclassList: '',\r\n\t\tonBlur: (event) => {}\r\n\t},\r\n\t{\r\n\t\telement: '.reg-form-fieldset',\r\n\t\tid: 'login',\r\n\t\tname: 'login',\r\n\t\tlabel: 'Логин',\r\n\t\tvalue: '',\r\n\t\ttype: 'text',\r\n\t\trequired: true,\r\n\t\terrorText: 'Логин должен содержать от 3 до 20 латинских символов, может содержать цифры, но не состоять из них, без пробелов, без спецсимволов',\r\n\t\tvalidationType: 'login',\r\n\t\tclassList: '',\r\n\t\tonBlur: (event) => {}\r\n\t},\r\n\t{\r\n\t\telement: '.reg-form-fieldset',\r\n\t\tid: 'secondName',\r\n\t\tname: 'second_name',\r\n\t\tlabel: 'Фамилия',\r\n\t\tvalue: '',\r\n\t\ttype: 'text',\r\n\t\trequired: true,\r\n\t\terrorText: 'Первая буква должна быть заглавной, без пробелов, цифр и спецсимволов, кроме дефиса',\r\n\t\tvalidationType: 'name',\r\n\t\tclassList: '',\r\n\t\tonBlur: (event) => {}\r\n\t},\r\n\t{\r\n\t\telement: '.reg-form-fieldset',\r\n\t\tid: 'firstName',\r\n\t\tname: 'first_name',\r\n\t\tlabel: 'Имя',\r\n\t\tvalue: '',\r\n\t\ttype: 'text',\r\n\t\trequired: true,\r\n\t\terrorText: 'Первая буква должна быть заглавной, без пробелов, цифр и спецсимволов, кроме дефиса',\r\n\t\tvalidationType: 'name',\r\n\t\tclassList: '',\r\n\t\tonBlur: (event) => {}\r\n\t},\r\n\t{\r\n\t\telement: '.reg-form-fieldset',\r\n\t\tid: 'phone',\r\n\t\tname: 'phone',\r\n\t\tlabel: 'Телефон',\r\n\t\tvalue: '',\r\n\t\ttype: 'text',\r\n\t\trequired: true,\r\n\t\terrorText: 'Телефон должен содержать от 10 до 15 символов, состоит из цифр, может начинаться с плюса',\r\n\t\tvalidationType: 'phone',\r\n\t\tclassList: '',\r\n\t\tonBlur: (event) => {}\r\n\t},\r\n\t{\r\n\t\telement: '.reg-form-fieldset',\r\n\t\tid: 'password',\r\n\t\tname: 'password',\r\n\t\tlabel: 'Пароль',\r\n\t\tvalue: '',\r\n\t\ttype: 'password',\r\n\t\trequired: true,\r\n\t\terrorText: 'Пароль должен содержать от 8 до 40 символов, обязательно хотя бы одну заглавную букву и цифру',\r\n\t\tvalidationType: 'password',\r\n\t\tclassList: '',\r\n\t\tonBlur: (event) => {}\r\n\t},\r\n\t{\r\n\t\telement: '.reg-form-fieldset',\r\n\t\tid: 'repeatPassword',\r\n\t\tname: 'repeat_password',\r\n\t\tlabel: 'Повторите пароль',\r\n\t\tvalue: '',\r\n\t\ttype: 'password',\r\n\t\trequired: true,\r\n\t\terrorText: 'Пароль должен содержать от 8 до 40 символов, обязательно хотя бы одну заглавную букву и цифру',\r\n\t\tvalidationType: 'password',\r\n\t\tclassList: '',\r\n\t\tonBlur: (event) => {}\r\n\t},\r\n];\r\n\r\nconst registrationButtons: ButtonParams[] = [\r\n\t{\r\n\t\telement: '.buttons-wrapper',\r\n\t\tid: '',\r\n\t\tname: 'Зарегистрироваться',\r\n\t\tclasses: 'add-link',\r\n\t\tonClick: (event) => {\r\n\t\t\tevent.preventDefault();\r\n\t\t\tonSubmitForm('.reg-form', function(formData){\r\n\t\t\t\tAuthentificationController2.signUp(formData, function(error){\r\n\t\t\t\t\tdocument.getElementById(\"formInfoBlock\").textContent = error;\r\n\t\t\t\t});\r\n\t\t\t});\r\n\t\t},\r\n\t},\r\n\t{\r\n\t\telement: '.buttons-wrapper',\r\n\t\tid: '',\r\n\t\tname: 'Назад',\r\n\t\tclasses: 'reg-link',\r\n\t\tonClick: (event) => {\r\n\t\t\tevent.preventDefault();\r\n\t\t\twindow.history.back();\r\n\t\t},\r\n\t},\r\n];\r\n\r\nexport default function(): void {\r\n\r\n\tdocument.title = documentTitle;\r\n\t//window.history.pushState('', '', 'registration');\r\n\r\n\tnew Form(registrationForm).insertBlock(\"#app\", true);\r\n\r\n\tregistrationInputs.forEach(function(input) {\r\n\t\tnew Input(input).insertBlock(input.element);\r\n\t});\r\n\r\n\tregistrationButtons.forEach(function(button) {\r\n\t\tnew Button(button).insertBlock(button.element);\r\n\t});\r\n}","//Страница профиля\r\n\r\nimport Form, { FormParams, onSubmitForm } from '../elements/form-block';\r\nimport Input, { InputParams } from '../elements/input-block';\r\nimport Button, { ButtonParams } from '../elements/button-block';\r\nimport ImageInput, { InputImageParams } from '../elements/image-input-block';\r\n\r\nimport { router } from '../utilities/createRouter';\r\n\r\nimport AuthentificationController2 from '../controllers/AuthentificationController2';\r\nimport UsersController from '../controllers/UsersController';\r\n\r\n\r\nconst resourcesLink = \"https://ya-praktikum.tech/api/v2/resources/\";\r\n\r\nconst documentTitle = \"Мой профиль\";\r\n\r\nconst profileForm: FormParams = {\r\n\ttitle: ''\r\n};\r\n\r\nconst profileImageInputs: InputImageParams[] = [\r\n\t{\r\n\t\telement: '.reg-form-fieldset',\r\n\t\tid: 'photoImageUpload',\r\n\t\timageId: 'userAvatar',\r\n\t\tname: 'avatar',\r\n\t\timageLink: '#',\r\n\t\timageAlt: '',\r\n\t\timageTitle: '',\r\n\t\tonChanged: (event) => {\r\n\t\t\tevent.preventDefault();\r\n\t\t\tconst form: HTMLFormElement = document.querySelector(\".reg-form\");\r\n\t\t\tif (!form) return;\r\n\r\n\t\t\tconst data: FormData = new FormData(form);\r\n\t\t\tconsole.log(data)\r\n\t\t\tchangeAvatar(data, function(){\r\n\r\n\t\t\t});\r\n\t\t}\r\n\t}\r\n];\r\n\r\nconst profileInputs: InputParams[] = [\r\n\t{\r\n\t\telement: '.reg-form-fieldset',\r\n\t\tid: 'email',\r\n\t\tname: 'email',\r\n\t\tlabel: 'E-mail',\r\n\t\tvalue: '',\r\n\t\ttype: 'text',\r\n\t\trequired: true,\r\n\t\terrorText: 'Неверный формат email',\r\n\t\tvalidationType: 'email',\r\n\t\tclassList: '',\r\n\t\tonBlur: (event) => {}\r\n\t},\r\n\t{\r\n\t\telement: '.reg-form-fieldset',\r\n\t\tid: 'login',\r\n\t\tname: 'login',\r\n\t\tlabel: 'Логин',\r\n\t\tvalue: '',\r\n\t\ttype: 'text',\r\n\t\trequired: true,\r\n\t\terrorText: 'Логин должен содержать от 3 до 20 латинских символов, может содержать цифры, но не состоять из них, без пробелов, без спецсимволов',\r\n\t\tvalidationType: 'login',\r\n\t\tclassList: '',\r\n\t\tonBlur: (event) => {}\r\n\t},\r\n\t{\r\n\t\telement: '.reg-form-fieldset',\r\n\t\tid: 'secondName',\r\n\t\tname: 'second_name',\r\n\t\tlabel: 'Фамилия',\r\n\t\tvalue: '',\r\n\t\ttype: 'text',\r\n\t\trequired: true,\r\n\t\terrorText: 'Первая буква должна быть заглавной, без пробелов, цифр и спецсимволов, кроме дефиса',\r\n\t\tvalidationType: 'name',\r\n\t\tclassList: '',\r\n\t\tonBlur: (event) => {}\r\n\t},\r\n\t{\r\n\t\telement: '.reg-form-fieldset',\r\n\t\tid: 'firstName',\r\n\t\tname: 'first_name',\r\n\t\tlabel: 'Имя',\r\n\t\tvalue: '',\r\n\t\ttype: 'text',\r\n\t\trequired: true,\r\n\t\terrorText: 'Первая буква должна быть заглавной, без пробелов, цифр и спецсимволов, кроме дефиса',\r\n\t\tvalidationType: 'name',\r\n\t\tclassList: '',\r\n\t\tonBlur: (event) => {}\r\n\t},\r\n\t{\r\n\t\telement: '.reg-form-fieldset',\r\n\t\tid: 'phone',\r\n\t\tname: 'phone',\r\n\t\tlabel: 'Телефон',\r\n\t\tvalue: '',\r\n\t\ttype: 'text',\r\n\t\trequired: true,\r\n\t\terrorText: 'Телефон должен содержать от 10 до 15 символов, состоит из цифр, может начинаться с плюса',\r\n\t\tvalidationType: 'phone',\r\n\t\tclassList: '',\r\n\t\tonBlur: (event) => {}\r\n\t},\r\n];\r\n\r\nconst changePasswordButtons: ButtonParams[] = [\r\n\t{\r\n\t\telement: '.reg-form-fieldset',\r\n\t\tid: 'changePasswordButton',\r\n\t\tname: 'Изменить пароль',\r\n\t\tclasses: 'reg-link',\r\n\t\tonClick: (event) => {\r\n\t\t\tevent.preventDefault();\r\n\t\t\tconst changePasswordButton = document.getElementById(event.target.getAttribute('id'));\r\n\t\t\tlet showElement = changePasswordButton.parentElement.nextElementSibling;\r\n\t\t\twhile (showElement){\r\n\t\t\t\tshowElement.children[0].classList.remove(\"none-block\");\r\n\t\t\t\tshowElement = showElement.nextElementSibling;\r\n\t\t\t}\r\n\t\t},\r\n\t},\r\n];\r\n\r\nconst changePasswordInputs: InputParams[] = [\r\n\t{\r\n\t\telement: '.reg-form-fieldset',\r\n\t\tid: 'oldPassword',\r\n\t\tname: 'old_password',\r\n\t\tlabel: 'Старый пароль',\r\n\t\tvalue: '',\r\n\t\ttype: 'password',\r\n\t\trequired: true,\r\n\t\terrorText: 'Пароль должен содержать от 8 до 40 символов, обязательно хотя бы одну заглавную букву и цифру',\r\n\t\tvalidationType: 'password',\r\n\t\tclassList: 'none-block',\r\n\t\tonBlur: (event) => {}\r\n\t},\r\n\t{\r\n\t\telement: '.reg-form-fieldset',\r\n\t\tid: 'password',\r\n\t\tname: 'password',\r\n\t\tlabel: 'Пароль',\r\n\t\tvalue: '',\r\n\t\ttype: 'password',\r\n\t\trequired: true,\r\n\t\terrorText: 'Пароль должен содержать от 8 до 40 символов, обязательно хотя бы одну заглавную букву и цифру',\r\n\t\tvalidationType: 'password',\r\n\t\tclassList: 'none-block',\r\n\t\tonBlur: (event) => {}\r\n\t},\r\n\t{\r\n\t\telement: '.reg-form-fieldset',\r\n\t\tid: 'repeatPassword',\r\n\t\tname: 'repeat_password',\r\n\t\tlabel: 'Повторите пароль',\r\n\t\tvalue: '',\r\n\t\ttype: 'password',\r\n\t\trequired: true,\r\n\t\terrorText: 'Пароль должен содержать от 8 до 40 символов, обязательно хотя бы одну заглавную букву и цифру',\r\n\t\tvalidationType: 'password',\r\n\t\tclassList: 'none-block',\r\n\t\tonBlur: (event) => {}\r\n\t},\r\n];\r\n\r\nconst profileButtons: ButtonParams[] = [\r\n\t{\r\n\t\telement: '.buttons-wrapper',\r\n\t\tid: '',\r\n\t\tname: 'Изменить данные',\r\n\t\tclasses: 'add-link',\r\n\t\tonClick: (event) => {\r\n\t\t\tevent.preventDefault();\r\n\t\t\tonSubmitForm('.reg-form', function(formData){\r\n\t\t\t\tformData.display_name = formData.first_name;\r\n\t\t\t\t//Изменение данных\r\n\t\t\t\tUsersController.updateUserProfile(formData, function(answer){\r\n\t\t\t\t\tif (answer){\r\n\t\t\t\t\t\tsetChangeUserDataError(answer);\r\n\t\t\t\t\t} else {\r\n\t\t\t\t\t\t//Если менялся пароль - также отправляем изменение пароля\r\n\t\t\t\t\t\tif (formData.password && formData.old_password){\r\n\t\t\t\t\t\t\tchangePassword(formData, redirectToChat);\r\n\t\t\t\t\t\t} else {\r\n\t\t\t\t\t\t\tredirectToChat();\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t}\r\n\t\t\t\t});\r\n\t\t\t});\r\n\t\t},\r\n\t},\r\n\t{\r\n\t\telement: '.buttons-wrapper',\r\n\t\tid: '',\r\n\t\tname: 'Назад',\r\n\t\tclasses: 'reg-link',\r\n\t\tonClick: (event) => {\r\n\t\t\tevent.preventDefault();\r\n\t\t\twindow.history.back();\r\n\t\t},\r\n\t},\r\n];\r\n\r\nfunction redirectToChat(){\r\n\trouter.go('/messenger');\r\n}\r\n\r\nfunction changeAvatar(formData, callback){\r\n\tUsersController.updateUserPhoto(formData, function(answer){\r\n\t\tif (answer && answer.avatar){\r\n\t\t\tsetUserAvatar(answer.avatar)\r\n\t\t}\t\t\t\t\t\t\t\r\n\t});\r\n}\r\n\r\nfunction changePassword(formData, callback){\r\n\tUsersController.updateUserPassword({\r\n\t\toldPassword: formData.old_password,\r\n\t\tnewPassword: formData.password\r\n\t}, function(answer){\r\n\t\tif (answer){\r\n\t\t\tsetChangeUserDataError(answer);\r\n\t\t} else {\r\n\t\t\tcallback(answer);\r\n\t\t}\t\t\t\t\t\t\t\t\r\n\t});\r\n}\r\n\r\nfunction setChangeUserDataError(error){\r\n\tdocument.getElementById(\"formInfoBlock\").textContent = error;\r\n\tgetUserData();\r\n}\r\n\r\nfunction setUserAvatar(url){\r\n\tdocument.getElementById(\"userAvatar\").setAttribute(\"src\", resourcesLink + url);\r\n}\r\n\r\nfunction getUserData(){\r\n\tAuthentificationController2.checkAuth(function(answer){\r\n\t\tfor (let key in answer){\r\n\t\t\tlet element = document.querySelector(\".reg-form [name=\" + key + \"]\");\r\n\t\t\tif (element){\r\n\t\t\t\telement.setAttribute(\"value\", answer[key]);\r\n\t\t\t}\r\n\t\t\tif ((key === \"avatar\") && (answer[key]) ){\r\n\t\t\t\tsetUserAvatar(answer[key]);\r\n\t\t\t}\r\n\t\t}\r\n\t})\r\n}\r\n\r\nexport default function(): void {\r\n\r\n\tdocument.title = documentTitle;\r\n\r\n\tnew Form(profileForm).insertBlock(\"#app\", true);\r\n\r\n\tprofileImageInputs.forEach(function(imageInput) {\r\n\t\tnew ImageInput(imageInput).insertBlock(imageInput.element);\r\n\t});\r\n\r\n\tprofileInputs.forEach(function(input) {\r\n\t\tnew Input(input).insertBlock(input.element);\r\n\t});\r\n\r\n\tchangePasswordButtons.forEach(function(button) {\r\n\t\tnew Button(button).insertBlock(button.element);\r\n\t});\r\n\r\n\tchangePasswordInputs.forEach(function(input) {\r\n\t\tnew Input(input).insertBlock(input.element);\r\n\t});\r\n\r\n\tprofileButtons.forEach(function(button) {\r\n\t\tnew Button(button).insertBlock(button.element);\r\n\t});\r\n\r\n\tgetUserData();\r\n}","//Блок загрузки изображения\r\n\r\nimport Block from '../elements/block';\r\n\r\nconst inputImageTemplate = `\r\n\t<label class=\"image-form-block\" for=\"{{id}}\">\r\n\t\t<input class=\"load-image\" name=\"{{name}}\" hidden accept=\"image/*\" type=\"file\" id=\"{{id}}\">\r\n\t\t<img id=\"{{imageId}}\" src=\"{{imageLink}}\" alt=\"{{imageAlt}}\" title=\"{{imageTitle}}\">\r\n\t</label>`;\r\n\r\nexport type InputImageParams = {\r\n\telement: string,\r\n\tid: string,\r\n\timageId: string,\r\n\tname: string,\r\n\timageLink: string,\r\n\timageAlt: string,\r\n\timageTitle: string,\r\n\tonChanged: (event: Event) => void\r\n}\r\n\r\nexport default class ImageInput extends Block {\r\n\r\n\tconstructor(params: InputImageParams, template: string) {\r\n\t\tif (!template){\r\n\t\t\ttemplate = inputImageTemplate;\r\n\t\t}\r\n\t\tsuper(params, template);\r\n\t}\r\n\r\n\tinsertBlock(element: string, clean: boolean): Record<string, HTMLElement> {\r\n\r\n\t\tconst insertedBlock = super.insertBlock(element, clean);\r\n\t\tconst $this = this;\r\n\t\tif (insertedBlock.inner){\r\n\t\t\tconst input = insertedBlock.inner.querySelector('input');\r\n\t\t\tif (input){\r\n\t\t\t\tinput.addEventListener('change', function(event){\r\n\t\t\t\t\t$this.props.onChanged(event);\r\n\t\t\t\t});\r\n\t\t\t}\t\t\t\r\n\t\t}\r\n\t\treturn insertedBlock;\r\n\t}\r\n\r\n}","//Страница ошибки\r\n\r\nimport Button, { ButtonParams } from '../elements/button-block';\r\nimport Error, { ErrorParams } from '../elements/error-block';\r\nimport authorization from './authorization';\r\n\r\nconst documentTitle = \"Ошибка\";\r\n\r\nconst errorBlock: ErrorParams = {\r\n\ttitle: 'Ошибка 404',\r\n\terrorText: 'Страница не найдена'\r\n};\r\n\r\nconst errorButtons: ButtonParams[] = [\r\n\t{\r\n\t\telement: '.warning-buttons-wrapper',\r\n\t\tid: '',\r\n\t\tname: 'Назад',\r\n\t\tclasses: 'warning-add warning-button',\r\n\t\tonClick: (event) => {\r\n\t\t\tevent.preventDefault();\r\n\t\t\terrorBackFunction();\r\n\t\t},\r\n\t},\r\n];\r\n\r\nlet errorBackFunction = function(): void{\r\n\twindow.history.back();\r\n}\r\n\r\nexport function showError(InnerErrorParams: ErrorParams, innerBackFunction, innerErrorButtons: ButtonParams): void {\r\n\tif (!InnerErrorParams){\r\n\t\tInnerErrorParams = errorBlock;\r\n\t}\r\n\r\n\tif (window.location.pathname == \"/500\"){\r\n\t\tInnerErrorParams.title = \"Ошибка 500\";\r\n\t\tInnerErrorParams.errorText = 'Внутренняя ошибка сервера';\r\n\t}\r\n\r\n\tif (!innerErrorButtons){\r\n\t\tinnerErrorButtons = errorButtons;\r\n\t}\r\n\t\r\n\tif (innerBackFunction){\r\n\t\terrorBackFunction = innerBackFunction;\r\n\t}\r\n\r\n\tdocument.title = documentTitle + ': ' + InnerErrorParams.title;\r\n\r\n\tnew Error(InnerErrorParams).insertBlock(\"#app\", true);\r\n\r\n\terrorButtons.forEach(function(button) {\r\n\t\tnew Button(button).insertBlock(button.element);\r\n\t});\r\n}\r\n\r\nexport default function(): void {\r\n\tshowError(errorBlock, errorBackFunction, errorButtons);\t\r\n}","//Блок ошибки\r\n\r\nimport Block from '../elements/block';\r\n\r\n//<a class=\"warning-add warning-button\" href=\"chat.html\">Назад</a>-\r\n\r\nconst errorBlockTemplate = `\r\n\t<div class=\"warning-message-wrapper warning-on\">\r\n\t\t<div class=\"warning-message-table\">\r\n\t\t\t<div class=\"warning-message-block\">\r\n\t\t\t\t<div class=\"loader none-block\">//убрать none-block для показа</div>\r\n\t\t\t\t<div class=\"error-message warning-message\">\r\n\t\t\t\t\t<div class=\"error-message-header\">{{title}}</div>\r\n\t\t\t\t\t<span>{{errorText}}</span>\r\n\t\t\t\t\t<div class=\"warning-buttons-wrapper\">\r\n\t\t\t\t\t</div>\r\n\t\t\t\t</div>\r\n\t\t\t</div>\r\n\t\t</div>\r\n\t</div>`;\r\n\r\nexport type ErrorParams = {\r\n\ttitle: string,\r\n\terrorText: string\r\n};\r\n\r\nexport default class Error extends Block {\r\n\r\n\tconstructor(params: ErrorParams, template: string) {\r\n\t\tif (!template){\r\n\t\t\ttemplate = errorBlockTemplate;\r\n\t\t}\r\n\t\tsuper(params, template);\r\n\t}\r\n\r\n}","import './scss/init.scss';\r\nimport authorization from './pages/authorization';\r\nimport { chat } from './pages/chat';\r\nimport registration from './pages/registration';\r\nimport profile from './pages/profile';\r\nimport error from './pages/error';\r\n\r\nimport AuthentificationController2 from './controllers/AuthentificationController2';\r\n\r\nimport { router } from './utilities/createRouter';\r\n\r\nrouter\r\n\t.use('/', authorization)\r\n\t.use('/authorization', authorization)\r\n\t.use('/messenger', chat)\r\n\t.use('/settings', profile)\r\n\t.use('/sign-up', registration)\r\n\t.use('*', error)\r\n\t.start();\r\n\r\nAuthentificationController2.checkAuth(function(answer){\r\n\tconst pathArray = window.location.pathname.split(\"/\");\r\n\tif (answer.id && (pathArray[1] == \"\")){\r\n\t\trouter.go('/messenger');\r\n\t}\r\n})"],"names":["document","title","Form","authorizationForm","insertBlock","authorizationInputs","forEach","input","Input","element","authorizationButtons","button","Button","$91695f1c427861cf$var$_formBlock","$91695f1c427861cf$var$_interopRequireWildcard","parcelRequire","$91695f1c427861cf$var$_inputBlock","$91695f1c427861cf$var$_interopRequireDefault","$91695f1c427861cf$var$_buttonBlock","$91695f1c427861cf$var$_AuthentificationController","id","name","label","value","type","required","errorText","validationType","classList","onBlur","event","classes","onClick","preventDefault","onSubmitForm","formData","AuthentificationController2","signIn","error","getElementById","textContent","router","go","selector","callback","form","querySelector","validForm","_console","data","FormData","console","log","apply","_step","obj","_iterator","$ae202c0a4cbfb8e0$var$_createForOfIteratorHelper","keys","s","n","done","key","get","err","e","f","$ae202c0a4cbfb8e0$var$_block","params","template","$ae202c0a4cbfb8e0$var$_classCallCheck","this","_super","call","Block","$f7247865aae568d1$var$_TemplateGen","noTagName","_this","tagName","arguments","length","undefined","$f7247865aae568d1$var$_classCallCheck","$f7247865aae568d1$var$_defineProperty","nextProps","Object","assign","props","eventBus","EventBus","_meta","_makePropsProxy","_registerEvents","emit","EVENTS","INIT","on","init","bind","FLOW_CDM","_componentDidMount","FLOW_CDU","_componentDidUpdate","FLOW_RENDER","_render","_element","_createDocumentElement","_createResources","componentDidMount","oldProps","newProps","componentDidUpdate","block","render","innerHTML","TemplateGen","generateTemplate","self","Proxy","target","property","set","$f7247865aae568d1$var$_objectSpread","deleteProperty","Error","createElement","getContent","style","display","remove","onDestroy","clean","prepend","inner","wrapper","children","$f7247865aae568d1$var$_createForOfIteratorHelper","querySelectorAll","removeAttribute","appendChild","templateBlock","$973bede13e903614$var$_classCallCheck","$973bede13e903614$var$_defineProperty","templateKeys","tmp","templateRegular","exec","templateValue","templateKey","changeTemplateKeys","replace","$6449c5e08ba54517$var$_classCallCheck","listeners","push","concat","filter","listener","_len","args","Array","_key","Event","defaultValidationErrorMessage","validationRegex","email","RegExp","login","phone","password","validValue","getAttribute","regex","inputWrapper","parentElement","errorBlock","test","add","formBlocks","infoBlock","isFormValid","repeatPassword","formBlock","contains","errorWrapper","closest","$002a4a3e1848043a$var$_block","$002a4a3e1848043a$var$_classCallCheck","insertedBlock","$002a4a3e1848043a$var$_get","$002a4a3e1848043a$var$_getPrototypeOf","prototype","$this","addEventListener","$7754adb433268645$var$_block","$7754adb433268645$var$_classCallCheck","$7754adb433268645$var$_get","$7754adb433268645$var$_getPrototypeOf","Router","$644cf53cc41e5521$var$_route","rootQuery","$644cf53cc41e5521$var$_classCallCheck","$644cf53cc41e5521$var$_defineProperty","instance","routes","pathnames","unprotectedPaths","currentRoute","onRouteCallback","window","history","pathname","route","Route","_rootQuery","includes","onpopstate","hasRoute","location","onRoute","getRoute","leave","paths","pushState","back","forward","find","match","view","$6c6ac7e4536728db$var$_classCallCheck","$6c6ac7e4536728db$var$_defineProperty","blockClass","destroy","lhs","rhs","query","$a51c3f2f260ae20f$var$_apiAuthorization","afterAuthorizationAnswer","answer","redirect","reason","hideBodyMask","afterAuthorizationError","response","$a51c3f2f260ae20f$var$_default","user","showBodyMask","apiAuthorization","then","signUp","signOut","checkAuth","APIAuthorization","$483fb41e9515e095$var$_default","$483fb41e9515e095$var$_classCallCheck","post","withCredentials","JSON","stringify","APIBase","$10441ec2a9bceef6$var$_HTTPTransport","defaultHeaders","baseHref","path","headers","$10441ec2a9bceef6$var$_classCallCheck","$10441ec2a9bceef6$var$_defineProperty","http","HTTPTransport","newOptions","options","res","ok","parse","endpoint","getPath","handleOptions","handleResponse","put","METHODS","queryStringify","result","$e1a270160271d0d7$var$_typeof","$e1a270160271d0d7$var$_defineProperty","url","request","$e1a270160271d0d7$var$_objectSpread","method","timeout","Promise","resolve","reject","xhr","XMLHttpRequest","open","setRequestHeader","onload","onabort","onerror","ontimeout","send","$e1a270160271d0d7$var$_default","$831830e1f4309f7f$var$_block","Textarea","$831830e1f4309f7f$var$_classCallCheck","$831830e1f4309f7f$var$_get","$831830e1f4309f7f$var$_getPrototypeOf","textarea","$5f1f743c70af58d9$var$_block","selectBlockTemplate","Select","$5f1f743c70af58d9$var$_classCallCheck","$3b0bc2af79fd68c5$var$_block","Option","$3b0bc2af79fd68c5$var$_classCallCheck","$7d05fecee680a978$var$_block","linkBlockTemplate","Link","$7d05fecee680a978$var$_classCallCheck","$7d05fecee680a978$var$_get","$7d05fecee680a978$var$_getPrototypeOf","$9ace76d802fc35d7$var$_linkBlock","menuLinkBlockTemplate","MenuLink","$9ace76d802fc35d7$var$_classCallCheck","$2bc99bc52c546f23$var$_block","Chat","$2bc99bc52c546f23$var$_classCallCheck","$367df50f684bc0f4$var$_block","ChatBlock","$367df50f684bc0f4$var$_classCallCheck","$367df50f684bc0f4$var$_get","$367df50f684bc0f4$var$_getPrototypeOf","$e910020956be5df2$var$_block","ChatName","$e910020956be5df2$var$_classCallCheck","$2f5d5593a8bd83ec$var$_block","FilesName","$2f5d5593a8bd83ec$var$_classCallCheck","$52e53354ad87dc80$var$_block","MessageBlock","$52e53354ad87dc80$var$_classCallCheck","$9577306b98fa142a$var$_block","Modal","$9577306b98fa142a$var$_classCallCheck","$a1dbf0bbbb19d800$var$_apiChats","afterChatError","ChatController","$a1dbf0bbbb19d800$var$_default","apiChats","getChats","createChat","chatId","deleteChat","getChatToken","getChatUsers","addUsersToChat","deleteUsersFromChat","APIChats","$605ae7667409f6ed$var$_default","$605ae7667409f6ed$var$_classCallCheck","$7f5e8cb7ae7756f2$var$_apiUser","afterUserAnswer","afterUserError","UsersController","$7f5e8cb7ae7756f2$var$_default","apiUser","searchUsers","users","userId","getUserData","updateUserProfile","updateUserPassword","updateUserPhoto","APIUser","$010e6a9d30d89379$var$_default","$010e6a9d30d89379$var$_classCallCheck","$f9a5f028c467db4f$var$_default","MessengerController","$f9a5f028c467db4f$var$_classCallCheck","$f9a5f028c467db4f$var$_defineProperty","onOpen","onMessage","onError","onClose","ws","removeEventListener","getMessages","offset","updateChatMessage","message","removeEvents","wasClean","code","reconnection","connect","token","WebSocket","hostWS","addEvents","content","toString","clearInterval","ping","close","chatParams","chatName","chatNameParams","chatProfileLinks","link","menuLinks","chatUserId","reloadChatList","sendForm","sendButton","textArea","textareaParams","filesName","filesNameParams","messages","isArray","updateMessageToChat","$a5326e997c37e9f7$var$_typeof","$a5326e997c37e9f7$var$_formBlock","$a5326e997c37e9f7$var$_interopRequireWildcard","$a5326e997c37e9f7$var$_textareaBlock","$a5326e997c37e9f7$var$_interopRequireDefault","$a5326e997c37e9f7$var$_buttonBlock","$a5326e997c37e9f7$var$_selectBlock","$a5326e997c37e9f7$var$_optionBlock","$a5326e997c37e9f7$var$_linkBlock","$a5326e997c37e9f7$var$_menuLinkBlock","$a5326e997c37e9f7$var$_chatWrapper","$a5326e997c37e9f7$var$_chatBlock","$a5326e997c37e9f7$var$_chatName","$a5326e997c37e9f7$var$_filesName","$a5326e997c37e9f7$var$_messageBlock","$a5326e997c37e9f7$var$_modalBlock","$a5326e997c37e9f7$var$_inputBlock","$a5326e997c37e9f7$var$_AuthentificationController","$a5326e997c37e9f7$var$_ChatController","$a5326e997c37e9f7$var$_UsersController","$a5326e997c37e9f7$var$_MessengerController","chatMessageLastId","sendMessage","reloadChatSender","wrapClasses","href","createChatModal","createChatForm","createChatInputs","createChatButtons","addUserToChatModal","addUserToChatForm","parseInt","addUserToChatInputs","addUserToChatSelect","select","addUserToChatButtons","addUserToChatClick","deleteUserFromChatModal","deleteUserFromChatForm","chatNameId","deleteUserFromChatSelect","i","first_name","second_name","deleteUserFromChatButtons","deleteUserFromChatClick","toggle","closeChat","setProps","deleteWarningMessage","MessageText","deleteButtons","closeModal","deleteUserData","deleteUserChat","onChatClick","chatBlock","chatWrapper","scrollChatToBottom","modalId","chat","photoAlt","newMessageCount","fromMeHideClass","newMessageHideClass","toMeClass","user_id","text","time","formatDate","Date","scrollTop","scrollHeight","date","dd","getDate","mm","getMonth","getFullYear","getHours","getMinutes","getSeconds","registrationForm","registrationInputs","registrationButtons","$e7d9c4fff4870b96$var$_formBlock","$e7d9c4fff4870b96$var$_interopRequireWildcard","$e7d9c4fff4870b96$var$_inputBlock","$e7d9c4fff4870b96$var$_interopRequireDefault","$e7d9c4fff4870b96$var$_buttonBlock","$e7d9c4fff4870b96$var$_AuthentificationController","profileForm","profileImageInputs","imageInput","ImageInput","profileInputs","changePasswordButtons","changePasswordInputs","profileButtons","$7e7fecefb4a4129d$var$_formBlock","$7e7fecefb4a4129d$var$_interopRequireWildcard","$7e7fecefb4a4129d$var$_inputBlock","$7e7fecefb4a4129d$var$_interopRequireDefault","$7e7fecefb4a4129d$var$_buttonBlock","$7e7fecefb4a4129d$var$_imageInputBlock","$7e7fecefb4a4129d$var$_AuthentificationController","$7e7fecefb4a4129d$var$_UsersController","resourcesLink","imageId","imageLink","imageAlt","imageTitle","onChanged","avatar","setUserAvatar","showElement","nextElementSibling","display_name","setChangeUserDataError","old_password","oldPassword","newPassword","changePassword","redirectToChat","setAttribute","$87a085c262289cfb$var$_block","$87a085c262289cfb$var$_classCallCheck","$87a085c262289cfb$var$_get","$87a085c262289cfb$var$_getPrototypeOf","showError","errorBackFunction","errorButtons","$c2020b7a41de0eca$var$_buttonBlock","$c2020b7a41de0eca$var$_interopRequireDefault","$c2020b7a41de0eca$var$_errorBlock","documentTitle","InnerErrorParams","innerBackFunction","innerErrorButtons","$294a01c843a7bfcc$var$_block","$294a01c843a7bfcc$var$_classCallCheck","$eb9ebc926cfda8aa$var$_authorization","$eb9ebc926cfda8aa$var$_interopRequireDefault","$eb9ebc926cfda8aa$var$_registration","$eb9ebc926cfda8aa$var$_profile","$eb9ebc926cfda8aa$var$_error","$eb9ebc926cfda8aa$var$_AuthentificationController","use","authorization","profile","registration","start","pathArray","split"],"version":3,"file":"index.ee573bc5.js.map","sourceRoot":"../"}