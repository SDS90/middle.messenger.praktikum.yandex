{"mappings":"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","sources":["src/utilities/TemplateGen.ts","src/utilities/eventbus.ts","src/elements/block.ts","src/utilities/validation.ts","src/elements/form-block.ts","src/elements/input-block.ts","src/elements/button-block.ts","src/utilities/route.ts","src/utilities/Router.ts","src/utilities/createRouter.ts","src/utilities/HTTPTransport.ts","src/api/apiBase.ts","src/api/apiAuthorization.ts","src/controllers/AuthorizationController.ts","src/pages/authorization.ts","src/elements/textarea-block.ts","src/elements/add-file-block.ts","src/elements/link-block.ts","src/elements/menu-link-block.ts","src/elements/chat-wrapper.ts","src/elements/chat-block.ts","src/elements/chat-name.ts","src/elements/files-name.ts","src/elements/message-block.ts","src/elements/modal-block.ts","src/api/apiChats.ts","src/utilities/effects.ts","src/controllers/ChatController.ts","src/pages/chat.ts","src/pages/registration.ts","src/elements/image-input-block.ts","src/pages/profile.ts","src/elements/error-block.ts","src/pages/error.ts","src/main.ts"],"sourcesContent":["//Генератор шаблонов\r\n//На вход подаётся строка с макросами в скобках {{}} и объект со значениями макросов\r\n//Пример:\r\n/*\r\n\tСтрока: '<div class=\"{{className}}\"></div>'\r\n\tОбъект: {className: 'test-class'}\r\n*/\r\n\r\nexport default class TemplateGen {\r\n\r\n\treadonly TEMPLATE_REGULAR = /\\{\\{(.*?)\\}\\}/;\r\n\r\n\treadonly templateBlock: string = \"\";\r\n\r\n\tconstructor(templateBlock: string) {\r\n\t\tthis.templateBlock = templateBlock;\r\n\t}\r\n\r\n\tgenerateTemplate(template: Record<string, unknown>): string {\r\n\t\tif (template && this.templateBlock){\r\n\t\t\treturn this.changeTemplateKeys(template, this.templateBlock, this.TEMPLATE_REGULAR);\r\n\t\t}\r\n\t\treturn \"\";\r\n\t}\r\n\r\n\tchangeTemplateKeys(template, tmp, templateRegular): string {\r\n\t\tconst templateKeys = templateRegular.exec(tmp);\r\n\t\tif (templateKeys && templateKeys[1]){\r\n\t\t\tconst templateKey = templateKeys[1];\r\n\t\t\tif (templateKey in template){\r\n\t\t\t\tlet templateValue = template[templateKey];\r\n\t\t\t\tif ((typeof templateValue != \"object\") && (typeof templateValue != \"function\")){\r\n\t\t\t\t\ttemplateValue = templateValue.toString();\r\n\t\t\t\t} else {\r\n\t\t\t\t\ttemplateValue = \"\";\r\n\t\t\t\t}\r\n\t\t\t\ttmp = tmp.replace(templateKeys[0], templateValue);\r\n\t\t\t} else {\r\n\t\t\t\ttmp = tmp.replace(templateKeys[0], \"\");\r\n\t\t\t}\t\r\n\t\t}\r\n\t\tif (templateRegular.exec(tmp)){\r\n\t\t\treturn this.changeTemplateKeys(template, tmp, templateRegular);\r\n\t\t} else {\r\n\t\t\treturn tmp;\r\n\t\t}\r\n\t}\r\n}","//Шина событий\r\n\r\nexport class EventBus {\r\n\tlisteners: Record<string, Array<() => void>>;\r\n\r\n\tconstructor() {\r\n\t\tthis.listeners = {};\r\n\t}\r\n\r\n\ton(event: string, callback: () => void): void {\r\n\t\tif (!this.listeners[event]) {\r\n\t\t\tthis.listeners[event] = [];\r\n\t\t}\r\n\t\tthis.listeners[event].push(callback);\r\n\t}\r\n\r\n\toff(event: string, callback: () => void): void {\r\n\t\tif (!this.listeners[event]) {\r\n\t\t\tthrow new Error(`Нет события: ${event}`);\r\n\t\t}\r\n\r\n\t\tthis.listeners[event] = this.listeners[event].filter(\r\n\t\t\tlistener => listener !== callback\r\n\t\t);\r\n\t}\r\n\r\n\temit(event: string, ...args: unknown[]) {\r\n\t\tif (!this.listeners[event]) {\r\n\t\t\tthrow new Event(`Нет события: ${event}`);\r\n\t\t}\r\n\r\n\t\tthis.listeners[event].forEach(function (listener: (...args: unknown[]) => void) {\r\n\t\t\tlistener(...args);\r\n\t\t});\r\n\t}\r\n}","//Блоки - общее\r\nimport TemplateGen from '../utilities/TemplateGen';\r\nimport {EventBus} from '../utilities/eventbus';\r\n\r\nexport type PropsType = Record<string, any>;\r\n\r\ntype BlockMetaData = {\r\n\ttagName: string,\r\n\tprops: Record<string, unknown>\r\n}\r\n\r\nexport default class Block {\r\n\tstatic EVENTS = {\r\n\t\tINIT: \"init\",\r\n\t\tFLOW_CDM: \"flow:component-did-mount\",\r\n\t\tFLOW_CDU: \"flow:component-did-update\",\r\n\t\tFLOW_RENDER: \"flow:render\"\r\n\t};\r\n\r\n\tnoTagName: false;\r\n\ttemplate: string;\r\n\tprops: PropsType;\r\n\teventBus: () => EventBus;\r\n\r\n\t_element: HTMLElement = null;\r\n\t_meta: BlockMetaData;\r\n\r\n\tconstructor(params: Record<string, unknown>, template: string, noTagName: boolean, tagName = 'div') {\r\n\t\tthis.template = template;\r\n\t\tthis.noTagName = noTagName;\r\n\t\tconst eventBus = new EventBus();\r\n\t\tthis._meta = {\r\n\t\t\ttagName,\r\n\t\t\tparams\r\n\t\t};\r\n\r\n\t\tthis.props = this._makePropsProxy(params);\r\n\r\n\t\tthis.eventBus = () => eventBus;\r\n\r\n\t\tthis._registerEvents(eventBus);\r\n\t\teventBus.emit(Block.EVENTS.INIT);\r\n\t}\r\n\r\n\t_registerEvents(eventBus) {\r\n\t\teventBus.on(Block.EVENTS.INIT, this.init.bind(this));\r\n\t\teventBus.on(Block.EVENTS.FLOW_CDM, this._componentDidMount.bind(this));\r\n\t\teventBus.on(Block.EVENTS.FLOW_CDU, this._componentDidUpdate.bind(this));\r\n\t\teventBus.on(Block.EVENTS.FLOW_RENDER, this._render.bind(this));\r\n\t}\r\n\r\n\t_createResources(): void {\r\n\t\tconst { tagName } = this._meta;\r\n\t\tthis._element = this._createDocumentElement(tagName);\r\n\t\tthis._element;\r\n\t}\r\n\r\n\tinit(): void {\r\n\t\tthis._createResources();\r\n\t\tthis.eventBus().emit(Block.EVENTS.FLOW_CDM);\r\n\t}\r\n\r\n\t_componentDidMount(): void {\r\n\t\tthis.componentDidMount();\r\n\t\tthis.eventBus().emit(Block.EVENTS.FLOW_RENDER);\r\n\t}\r\n\r\n\tcomponentDidMount(): void {\r\n\t\treturn;\r\n\t}\r\n\r\n\tdispatchComponentDidMoun() {return;}\r\n\r\n\t_componentDidUpdate(oldProps: Record<string, unknown>, newProps: Record<string, unknown>): void {\r\n\t\tconst response = this.componentDidUpdate(oldProps, newProps);\r\n\t\tif (!response) {\r\n\t\t\treturn;\r\n\t\t}\r\n\t\tthis._render();\r\n\t}\r\n\r\n\tcomponentDidUpdate(oldProps: Record<string, unknown>, newProps: Record<string, unknown>,): boolean {\r\n\t\treturn true;\r\n\t}\r\n\r\n\tsetProps = nextProps => {\r\n\t\tif (!nextProps) {\r\n\t\t\treturn;\r\n\t\t}\r\n\t\tObject.assign(this.props, nextProps);\r\n\t};\r\n\r\n\tget element(): HTMLElement {\r\n\t\treturn this._element;\r\n\t}\r\n\r\n\t_render() {\r\n\t\tconst block = this.render();\r\n\t\tif (this._element){\r\n\t\t\tthis._element.innerHTML = block;\r\n\t\t}\r\n\t}\r\n\r\n\trender(): string {\r\n\t\treturn new TemplateGen(this.template).generateTemplate(this.props);\r\n\t}\r\n\r\n\tgetContent(): HTMLElement {\r\n\t\treturn this.element;\r\n\t}\r\n\r\n\t_makePropsProxy(props: Record<string, unknown>): Record<string, unknown> {\r\n\t\tconst self = this;\r\n\r\n\t\treturn new Proxy(props, {\r\n\t\t\tget(target, property) {\r\n\t\t\t\tif (typeof target[property] == 'function'){\r\n\t\t\t\t\treturn target[property].bind(target);\r\n\t\t\t\t} else {\r\n\t\t\t\t\treturn target[property];\r\n\t\t\t\t}\r\n\t\t\t},\r\n\t\t\tset(target, property, value) {\r\n\t\t\t\ttarget[property] = value;\r\n\t\t\t\tself.eventBus().emit(Block.EVENTS.FLOW_CDU, {...target}, target);\r\n\t\t\t\treturn true;\r\n\t\t\t},\r\n\t\t\tdeleteProperty() {\r\n\t\t\t\tthrow new Error(\"Нет доступа\");\r\n\t\t\t}\r\n\t\t});\r\n\t}\r\n\r\n\t_createDocumentElement(tagName): HTMLElement {\r\n\t\treturn document.createElement(tagName);\r\n\t}\r\n\r\n\tshow(): void {\r\n\t\tconst element = this.getContent();\r\n\t\tif (element){\r\n\t\t\telement.style.display = \"block\";\r\n\t\t}\t\t\r\n\t}\r\n\r\n\thide(): void {\r\n\t\tconst element = this.getContent();\r\n\t\tif (element){\r\n\t\t\telement.style.display = \"none\";\r\n\t\t}\r\n\t}\r\n\r\n\tdestroy() {\r\n\t\tthis._element.remove();\r\n\t\tthis.onDestroy();\r\n\t}\r\n\r\n\tonDestroy() {}\r\n\r\n\tinsertBlock(element: string, clean: boolean, prepend: boolean): Record<string, HTMLElement> {\r\n\t\tlet inner = this.getContent(); //new DOMParser().parseFromString(new TemplateGen(this.template).generateTemplate(this.props), \"text/html\").getElementsByTagName(\"body\")[0].childNodes[0];\r\n\t\tconst wrapper = document.querySelector(element);\r\n\t\tif (!inner || !wrapper) return {};\r\n\t\tif (this.noTagName){\r\n\t\t\tinner = inner.children[0];\r\n\t\t}\r\n\t\tfor (let el of wrapper.querySelectorAll('[id=\"\"]')) {\r\n\t\t\tel.removeAttribute('id');\r\n\t\t}\r\n\t\tif (clean){\r\n\t\t\twrapper.innerHTML = \"\";\r\n\t\t}\r\n\t\tif (prepend){\r\n\t\t\twrapper.prepend(inner);\r\n\t\t} else {\r\n\t\t\twrapper.appendChild(inner);\r\n\t\t}\r\n\t\treturn {\r\n\t\t\tinner: inner,\r\n\t\t\twrapper: wrapper\r\n\t\t};\r\n\t}\r\n}","//Валидация\r\n\r\nconst defaultValidationErrorMessage = \"Возникла ошибка при заполнении формы. Пожалуйста, проверьте введённые данные.\";\r\nconst repeatPasswordErrorMessage = \"Пароли не совпадают.\";\r\nconst requiredFieldsErrorMessage = \"Не все обязательные поля заполнены.\";\r\nconst requiredFieldMessage = \"Обязательное поле.\";\r\n\r\nconst validationRegex: Record<string, RegExp> = {\r\n\temail: new RegExp(/^([A-Za-z0-9_\\.-]+)@([A-Za-z0-9_\\.-]+)\\.([a-z\\.]{2,6})$/),\r\n\tlogin: new RegExp(/^[A-Za-z0-9_\\.-]{3,20}$/),\r\n\tname: new RegExp(/^[A-ZА-Я][a-zA-Zа-яА-Я-]+$/),\r\n\tphone: new RegExp(/^\\+?\\d{10,15}$/),\r\n\tpassword: new RegExp(/^((?=.*?[A-Z])(?=.*?[0-9])\\S{8,40})\\S$/),\r\n};\r\n\r\nexport const validValue = function(input: HTMLInputElement): boolean {\r\n\tconst validationType = input.getAttribute(\"data-validation-type\");\r\n\tconst errorText = input.getAttribute(\"data-error-text\");\r\n\r\n\tconst value = input.value;\r\n\tconst regex = validationRegex[validationType];\r\n\r\n\tconst inputWrapper = input.parentElement;\r\n\tconst errorBlock = inputWrapper.querySelector(\".error-text-block\");\r\n\r\n\tif (regex && !regex.test(value)) {\r\n\t\tinputWrapper.classList.add('error-input');\r\n\t\tif (errorBlock){\r\n\t\t\tif (errorText){\r\n\t\t\t\terrorBlock.textContent = errorText;\r\n\t\t\t} else {\r\n\t\t\t\terrorBlock.textContent = defaultValidationErrorMessage;\r\n\t\t\t}\r\n\t\t}\t\t\r\n\t\treturn false;\r\n\t}\r\n\tinputWrapper.classList.remove('error-input');\r\n\tif (errorBlock){\r\n\t\terrorBlock.textContent = \"\";\r\n\t}\r\n\treturn true;\r\n};\r\n\r\nexport const validForm = function(form: HTMLFormElement): boolean {\r\n\tconst formBlocks = form.querySelectorAll('.form-block');\r\n\tconst infoBlock = form.querySelector(\".info-block\");\r\n\r\n\tlet isFormValid = true;\r\n\tlet password = \"\", repeatPassword = \"\";\r\n\r\n\tif (infoBlock){\r\n\t\tinfoBlock.textContent = \"\";\r\n\t}\r\n\r\n\tformBlocks.forEach(function(formBlock) {\r\n\t\tconst input = formBlock.querySelector(\"input\") || formBlock.querySelector(\"textarea\");\r\n\t\tif (input){\r\n\t\t\tconst errorText = input.getAttribute(\"data-error-text\");\r\n\r\n\t\t\tif (!formBlock.classList.contains(\"none-block\") && !validValue(input)) {\r\n\t\t\t\tisFormValid = false;\r\n\t\t\t}\r\n\t\t\tif (!input.value && input.getAttribute(\"data-required\") && !formBlock.classList.contains(\"none-block\")){\r\n\t\t\t\tisFormValid = false;\r\n\r\n\t\t\t\tconst errorWrapper = input.parentElement;\r\n\t\t\t\tif (errorWrapper) {\r\n\t\t\t\t\terrorWrapper.classList.add(\"error-input\");\r\n\r\n\t\t\t\t\tif (errorText){\r\n\t\t\t\t\t\terrorWrapper.querySelector(\".error-text-block\").textContent = errorText;\r\n\t\t\t\t\t} else {\r\n\t\t\t\t\t\terrorWrapper.querySelector(\".error-text-block\").textContent = requiredFieldMessage;\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\r\n\t\t\t\tif (infoBlock){\r\n\t\t\t\t\tinfoBlock.textContent = requiredFieldsErrorMessage;\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t\tif (input.name == \"password\"){\r\n\t\t\t\tpassword = input.value;\r\n\t\t\t}\r\n\t\t\tif (input.name == \"repeat_password\"){\r\n\t\t\t\trepeatPassword = input.value;\r\n\t\t\t}\r\n\t\t}\r\n\t});\r\n\t\r\n\tif (password && repeatPassword && (password != repeatPassword)){\r\n\t\tisFormValid = false;\r\n\t\tinfoBlock.textContent = repeatPasswordErrorMessage;\r\n\t}\t\r\n\treturn isFormValid;\r\n};","//Блок input\r\n\r\nimport Block from '../elements/block';\r\nimport {validForm} from \"../utilities/validation\";\r\n\r\nconst formBlockTemplate = `\r\n\t<div class=\"reg-form-page\">\r\n\t\t<div class=\"reg-form-wrapper\">\r\n\t\t\t<h2>{{title}}</h2>\r\n\t\t\t<form class=\"reg-form\">\r\n\t\t\t\t<fieldset>\r\n\t\t\t\t\t<div class=\"reg-form-fieldset\"></div>\r\n\t\t\t\t\t<div class=\"form-block info-block\" id=\"formInfoBlock\"></div>\r\n\t\t\t\t\t<div class=\"form-block buttons-wrapper\"></div>\r\n\t\t\t\t</fieldset>\r\n\t\t\t</form>\r\n\t\t</div>\r\n\t</div>`;\r\n\r\nexport type FormParams = {\r\n\ttitle: string\r\n};\r\n\r\nexport default class Form extends Block {\r\n\r\n\tconstructor(params: FormParams, template: string) {\r\n\t\tif (!template){\r\n\t\t\ttemplate = formBlockTemplate;\r\n\t\t}\r\n\t\tsuper(params, template);\r\n\t}\r\n}\r\n\r\nexport function onSubmitForm(selector: string, callback): void {\r\n\tconst form: HTMLFormElement = document.querySelector(selector);\r\n\tif (!form) return;\r\n\r\n\tif (validForm(form)){\r\n\t\tconst data: FormData = new FormData(form);\r\n\t\tconsole.log(...data);\r\n\t\tif (callback){\r\n\t\t\tlet obj : Record<any, any> = {};\r\n\t\t\tfor (let key of data.keys()) {\r\n\t\t\t\tobj[key] = data.get(key);\r\n\t\t\t}\r\n\t\t\tcallback(obj);\r\n\t\t}\r\n\t}\r\n\treturn;\r\n}","//Блок input\r\n\r\nimport Block from '../elements/block';\r\nimport {validValue} from \"../utilities/validation\";\r\n\r\nconst inputBlockTemplate = `\r\n\t<div class=\"form-block {{classList}}\">\r\n\t\t<label class=\"form-label\" for=\"{{id}}\">{{label}}</label>\r\n\t\t<div class=\"input-wrapper\">\r\n\t\t\t<input class=\"form-control input-styles\" data-required=\"{{required}}\" data-error-text=\"{{errorText}}\" \r\n\t\t\tdata-validation-type=\"{{validationType}}\" id=\"{{id}}\" type=\"{{type}}\" value=\"{{value}}\" name=\"{{name}}\">\r\n\t\t\t<div class=\"error-text-block\"></div>\r\n\t\t</div>\r\n\t</div>`;\r\n\r\nexport type InputParams = {\r\n\telement: string,\r\n\tid: string,\r\n\tlabel: string,\r\n\tvalue: string,\r\n\ttype: string,\r\n\tname: string,\r\n\trequired: boolean,\r\n\terrorText: string,\r\n\tvalidationType: string,\r\n\tclassList: string,\r\n}\r\n\r\nexport default class Input extends Block {\r\n\t//params: InputParams\r\n\r\n\tconstructor(params: InputParams, template: string) {\r\n\t\tif (!template){\r\n\t\t\ttemplate = inputBlockTemplate;\r\n\t\t}\r\n\t\tsuper(params, template);\r\n\t}\r\n\r\n\tinsertBlock(element: string, clean: boolean): Record<string, HTMLElement> {\r\n\r\n\t\tconst insertedBlock = super.insertBlock(element, clean);\r\n\t\tif (insertedBlock.inner){\r\n\t\t\tconst input = insertedBlock.inner.querySelector('input');\r\n\t\t\tif (input){\r\n\t\t\t\tinput.addEventListener('focus', function(){\r\n\t\t\t\t\tthis.classList.add('focus-input');\r\n\t\t\t\t});\r\n\t\t\t\tinput.addEventListener('blur', function(){\r\n\t\t\t\t\tthis.classList.remove('focus-input');\r\n\t\t\t\t\tvalidValue(this);\r\n\t\t\t\t});\r\n\t\t\t}\t\t\t\r\n\t\t}\r\n\t\treturn insertedBlock;\r\n\t}\r\n}","//Блок кнопки\r\n\r\nimport Block from '../elements/block';\r\n\r\nconst buttonBlockTemplate = `<button id=\"{{id}}\" class=\"button-link {{classes}}\">{{name}}</button>`;\r\n\r\nexport type ButtonParams = {\r\n\telement: string,\r\n\tid: string,\r\n\tclasses: string,\r\n\tname: string,\r\n\tonClick: (event: Event) => void\r\n}\r\n\r\nexport default class Button extends Block {\r\n\r\n\tconstructor(params: ButtonParams, template: string) {\r\n\t\tif (!template){\r\n\t\t\ttemplate = buttonBlockTemplate;\r\n\t\t}\r\n\t\tsuper(params, template);\r\n\t}\r\n\r\n\tinsertBlock(element: string, clean: boolean): Record<string, HTMLElement> {\r\n\t\tconst insertedBlock = super.insertBlock(element, clean);\r\n\t\tif (insertedBlock.inner){\r\n\t\t\tinsertedBlock.inner.addEventListener('click', this.props.onClick);\r\n\t\t\tinsertedBlock.inner.addEventListener('touchstart', this.props.onClick);\t\t\t\r\n\t\t}\r\n\t\treturn insertedBlock;\r\n\t}\r\n}","import Block, { PropsType } from '../elements/block';\r\n\r\nfunction isEqual(lhs: string, rhs: string) {\r\n\treturn lhs === rhs;\r\n}\r\n\r\nfunction renderBlock(query: string, block: Block) {\r\n\tconst root = document.querySelector(query);\r\n\tif (root && block) {\r\n\t\t//root.append(block.getContent());\r\n\t\treturn root;\r\n\t}\r\n\treturn false;\r\n}\r\n\r\nclass Route {\r\n\tpathname: string;\r\n\tblockClass: typeof Block;\r\n\tblock: Block | null;\r\n\tprops: PropsType;\r\n\r\n\tconstructor(pathname: string, view: typeof Block, props: PropsType) {\r\n\t\tthis.pathname = pathname;\r\n\t\tthis.blockClass = view;\r\n\t\tthis.block = null;\r\n\t\tthis.props = props;\r\n\t}\r\n\r\n\tgetPathname() {\r\n\t\treturn this.pathname;\r\n\t}\r\n\r\n\tleave() {\r\n\t\tif (this.block && (Object.keys(this.block).length)) {\r\n\t\t\tthis.block.destroy();\r\n\t\t}\r\n\t}\r\n\r\n\tmatch(pathname: string) {\r\n\t\treturn isEqual(pathname, this.pathname);\r\n\t}\r\n\r\n\trender() {\r\n\t\t//if (!this.block) {\r\n\t\t\tthis.block = new this.blockClass();\r\n\t\t\trenderBlock(this.props.rootQuery, this.block);\r\n\t\t\treturn;\r\n\t\t//}\r\n\t\t//if (this.block && (Object.keys(this.block).length)) {\r\n\t\t//\tthis.block.show();\r\n\t\t//}\r\n\t}\r\n}\r\n\r\nexport default Route;","import Route from './route';\r\nimport Block from '../elements/block';\r\n\r\nclass Router {\r\n\tpublic routes: Route[];\r\n\tpublic history: History;\r\n\tprivate _currentRoute: Route | null;\r\n\tprivate _rootQuery: string;\r\n\tprivate _pathnames: string[];\r\n\tprivate _onRouteCallback: () => void;\r\n\tprivate _unprotectedPaths: `/${string}`[];\r\n\tstatic __instance: Router;\r\n\r\n\tconstructor(rootQuery: string) {\r\n\t\tif (Router.__instance) {\r\n\t\t\treturn Router.__instance;\r\n\t\t}\r\n\t\tthis.routes = [];\r\n\t\tthis._pathnames = [];\r\n\t\tthis._unprotectedPaths = [];\r\n\t\tthis.history = window.history;\r\n\t\tthis._currentRoute = null;\r\n\t\tthis._rootQuery = rootQuery;\r\n\t\tthis._onRouteCallback = () => {};\r\n\t\tRouter.__instance = this;\r\n\t}\r\n\r\n\tget currentRoute() {\r\n\t\treturn this._currentRoute;\r\n\t}\r\n\r\n\tpublic use(pathname: string, block: typeof Block) {\r\n\t\tconst route = new Route(pathname, block, { rootQuery: this._rootQuery });\r\n\t\tthis.routes.push(route);\r\n\t\tthis._pathnames.push(pathname);\r\n\t\treturn this;\r\n\t}\r\n\r\n\tprivate _hasRoute(pathname: string) {\r\n\t\tif (!this._pathnames.includes(pathname)) {\r\n\t\t\treturn '*';\r\n\t\t}\r\n\t\treturn pathname;\r\n\t}\r\n\r\n\tpublic start() {\r\n\t\t/*window.onpopstate = (() => {\r\n\t        this._onRoute(window.location.pathname);\r\n\t      }).bind(this);\r\n\t      this._onRoute(window.location.pathname);*/\r\n\t\twindow.onpopstate = () => {\r\n\t\tconst pathname = this._hasRoute(window.location.pathname);\r\n\t\t\tthis._onRoute(pathname);\r\n\t\t};\r\n\t\tconst pathname = this._hasRoute(window.location.pathname);\r\n\t\tthis._onRoute(pathname);\r\n\t}\r\n\r\n\tprivate _onRoute(pathname: string) {\r\n\t\tconst route = this.getRoute(pathname);\r\n\t\tif (!route) {\r\n\t\t\treturn;\r\n\t\t}\r\n\t\tif (this._currentRoute) {\r\n\t\t\tthis._currentRoute.leave();\r\n\t\t}\r\n\t\tthis._currentRoute = route;\r\n\t\troute.render();\r\n\t\tif (!this._unprotectedPaths.includes(pathname as `/${string}`)) {\r\n\t\t\tthis._onRouteCallback();\r\n\t\t}\r\n\t}\r\n\r\n\tpublic onRoute(callback: () => void) {\r\n\t\tthis._onRouteCallback = callback;\r\n\t\treturn this;\r\n\t}\r\n\r\n\tpublic setUnprotectedPaths(paths: `/${string}`[]) {\r\n\t\tthis._unprotectedPaths = paths;\r\n\t\treturn this;\r\n\t}\r\n\r\n\tpublic go(pathname: string) {\r\n\t\tthis.history.pushState({}, '', pathname);\r\n\t\tthis._onRoute(pathname);\r\n\t}\r\n\r\n\tpublic back() {\r\n\t\tthis.history.back();\r\n\t}\r\n\r\n\tpublic forward() {\r\n\t\tthis.history.forward();\r\n\t}\r\n\r\n\tpublic getRoute(pathname: string) {\r\n\t\treturn this.routes.find((route) => route.match(pathname));\r\n\t}\r\n\r\n\tpublic getLocationPathname() {\r\n\t\treturn window.location.pathname;\r\n\t}\r\n}\r\n\r\nexport default Router;","import Router from './Router';\r\n\r\nexport const router = new Router('#app');","//HTTPTransport\r\nconst METHODS = {\r\n\tGET: 'GET',\r\n\tPOST: 'POST',\r\n\tPUT: 'PUT',\r\n\tDELETE: 'DELETE',\r\n};\r\n\r\nfunction queryStringify(data) {\r\n\tlet result: string = \"\";\r\n\tif (typeof data == 'object') {\r\n\t\tresult = \"\"\r\n\t\tfor (let key in data){\r\n\t\t\tif (result == \"\"){\r\n\t\t\t\tresult = result + \"?\"\r\n\t\t\t} else {\r\n\t\t\t\tresult = result + \"&\"\r\n\t\t\t}\r\n\t\t\tresult = result + key + \"=\" + data[key];\r\n\t\t}\r\n\t}\r\n\treturn result;\r\n}\r\n \r\nclass HTTPTransport {\r\n\tget = (url: string, options = {}) => {\r\n\t\treturn this.request(url, {...options, method: METHODS.GET}, options.timeout);\r\n\t};\r\n\r\n\tpost = (url: string, options = {}) => {\r\n\t\treturn this.request(url, {...options, method: METHODS.POST}, options.timeout);\r\n\t};\r\n\r\n\tput = (url: string, options = {}) => {\r\n\t\treturn this.request(url, {...options, method: METHODS.PUT}, options.timeout);\r\n\t};\r\n\r\n\tdelete = (url: string, options = {}) => { \r\n\t\treturn this.request(url, {...options, method: METHODS.DELETE}, options.timeout);\r\n\t};\r\n\r\n\trequest = (url: string, options = {}, timeout = 5000) => {\r\n\t\treturn new Promise(function(resolve, reject) {\r\n\t\t\tconst xhr = new XMLHttpRequest();\r\n\t\t\tconsole.log(options)\r\n\r\n\t\t\tif ((options.method == METHODS.GET) && options.data && (typeof options.data == 'object')){\r\n\t\t\t\txhr.open(options.method, queryStringify(options.data));\r\n\t\t\t} else {\r\n\t\t\t\txhr.open(options.method, url);\r\n\t\t\t}\r\n\r\n\t\t\tfor (let key in options.headers){\r\n\t\t\t\txhr.setRequestHeader(key, options.headers[key]);\r\n\t\t\t}\r\n\r\n\t\t\tif (options.withCredentials) {\r\n\t\t\t\txhr.withCredentials = true;\r\n\t\t\t}\r\n\r\n\t\t\t//xhr.responseType = 'json';\r\n\r\n\t\t\txhr.onload = function() {\r\n\t\t\t\tconsole.log(xhr)\r\n\t\t\t\tresolve(xhr);\r\n\t\t\t};\r\n\r\n\t\t\txhr.onabort = reject;\r\n\t\t\txhr.onerror = reject;\r\n\r\n\t\t\txhr.timeout = timeout;\r\n\t\t\txhr.ontimeout = reject;\r\n\r\n\t\t\tif (options.method === METHODS.GET || !options.data) {\r\n\t\t\t\txhr.send();\r\n\t\t\t} else {\r\n\t\t\t\txhr.send(options.data);\r\n\t\t\t}\r\n\t\t\t//xhr.send(options.data);\r\n\t\t});\r\n\t};\r\n}\r\n\r\nexport default new HTTPTransport();","import HTTPTransport from '../utilities/HTTPTransport';\r\n\r\nconst defaultHeaders = {\r\n\t'Content-type': 'application/json',\r\n};\r\n\r\nclass APIBase {\r\n\thttp: typeof HTTPTransport;\r\n\tbaseHref: string;\r\n\tpath: string;\r\n\theaders: Record<string, string>;\r\n\r\n\tconstructor(baseHref: string, path: string, headers: Record<string, string>) {\r\n\t\tthis.http = HTTPTransport;\r\n\t\tthis.baseHref = baseHref || \"https://ya-praktikum.tech/api/v2\";\r\n\t\tthis.path = path || '';\r\n\t\tthis.headers = defaultHeaders;\r\n\t}\r\n\r\n\tgetPath() {\r\n\t\treturn this.baseHref + this.path;\r\n\t}\r\n\r\n\thandleOptions(newOptions: Record<any, any>) {\r\n\t\tconst options = newOptions || {};\r\n\t\tif (newOptions.headers){\r\n\t\t\toptions.headers = newOptions.headers\r\n\t\t} else {\r\n\t\t\toptions.headers = this.headers\r\n\t\t}\r\n\t\treturn options;\r\n\t}\r\n\r\n\thandleResponse(res: XMLHttpRequest) {\r\n\t\tif (res.response == 'OK') {\r\n\t\t\treturn {ok: true};\r\n\t\t}\r\n\t\tlet response = JSON.parse(res.response);\r\n\t\treturn response;\r\n\t}\r\n\r\n\tgetHeaders() {\r\n\t\treturn this.headers;\r\n\t}\r\n\r\n\tget(endpoint: `/${string}`, options?: {}) {\r\n\t\treturn this.http.get(this.getPath() + endpoint, this.handleOptions(options))\r\n\t\t.then(this.handleResponse);\r\n\t}\r\n\r\n\tpost(endpoint: `/${string}`, options?: {}) {\r\n\t\treturn this.http.post(this.getPath() + endpoint, this.handleOptions(options))\r\n\t\t.then(this.handleResponse);\r\n\t}\r\n\r\n\tput(endpoint: `/${string}`, options?: {}) {\r\n\t\treturn this.http.put(this.getPath() + endpoint, this.handleOptions(options))\r\n\t\t.then(this.handleResponse);\r\n\t}\r\n\r\n\tdelete(endpoint: `/${string}`, options?: {}) {\r\n\t\treturn this.http.delete(this.getPath() + endpoint, this.handleOptions(options))\r\n\t\t.then(this.handleResponse);\r\n\t}\r\n}\r\n\r\nexport default APIBase;","import APIBase from './apiBase';\r\nimport { AuthorizationSignInInterface, AuthorizationSignUpInterface } from '../interfaces/interfaces';\r\n\r\nclass APIAuthorization extends APIBase {\r\n\tconstructor() {\r\n\t\tsuper('','/auth');\r\n\t}\r\n\r\n\tsignIn(data: AuthorizationSignInInterface) {\r\n\t\treturn this.post('/signin', {\r\n\t\t\twithCredentials: true,\r\n\t\t\tdata: JSON.stringify(data),\r\n\t\t});\r\n\t}\r\n\r\n\tsignUp(data: AuthorizationSignUpInterface) {\r\n\t\treturn this.post('/signup', {\r\n\t\t\tdata: JSON.stringify(data),\r\n\t\t});\r\n\t}\r\n\r\n\tcheckAuth() {\r\n\t\treturn this.get('/user', {\r\n\t\t\twithCredentials: true,\r\n\t\t});\r\n\t}\r\n\r\n\tsignOut() {\r\n\t\treturn this.post('/logout', {\r\n\t\t\twithCredentials: true,\r\n\t\t});\r\n\t}\r\n}\r\n\r\nexport default new APIAuthorization();","import apiAuthorization from '../api/apiAuthorization';\r\nimport { router } from '../utilities/createRouter';\r\nimport { AuthorizationSignInInterface, AuthorizationSignUpInterface } from '../interfaces/interfaces';\r\n//import { showPreloader, hidePreloader } from '../utils/preloader';\r\n//import { handleError } from '../utils/apiHandler';\r\n//import { IAuthApiSignIn, IAuthApiSignUp } from '../interfaces/IAuthApi';\r\n//import { store } from '../store';\r\n\r\n\r\n\r\nclass AuthorizationController {\r\n\tpublic signIn(user: AuthorizationSignInInterface, callback) {\r\n\t\t//showPreloader();\r\n\t\treturn apiAuthorization.signIn(user)\r\n\t\t.then((answer) => {\r\n\t\t\tif (answer.reason && callback){\r\n\t\t\t\tcallback(answer.reason);\r\n\t\t\t} else {\r\n\t\t\t\trouter.go('/messenger');\r\n\t\t\t}\t\t\r\n\t\t})\r\n\t\t.catch((error) => {\r\n\t\t\tif (error.response && callback){\r\n\t\t\t\tcallback(error.response);\r\n\t\t\t} else {\r\n\t\t\t\trouter.go('/500');\r\n\t\t\t}\t\t\t\r\n\t\t});\r\n\t}\r\n\r\n\tpublic signUp(user: AuthorizationSignUpInterface) {\r\n\t\t//showPreloader();\r\n\t\tconsole.log(user)\r\n\t\treturn apiAuthorization.signUp(user)\r\n\t\t.then((answer) => {\r\n\t\t\tconsole.log(answer)\r\n\t\t\trouter.go('/messenger');\r\n\t\t})\r\n\t\t.catch(() => {\r\n\t\t\trouter.go('/500');\r\n\t\t\t//hidePreloader();\r\n\t\t});\r\n\t}\r\n\r\n\tpublic signOut() {\r\n\t\treturn apiAuthorization.signOut()\r\n\t\t.then(() => {\r\n\t\t\t//localStorage.removeItem('last-select-chat-id');\r\n\t\t\trouter.go('/authorization');\r\n\t\t});\r\n\t}\r\n\r\n\tpublic checkAuth() {\r\n\t\treturn apiAuthorization.checkAuth()\r\n\t\t.then((user) => {\r\n\t\t\tconsole.log(user)\r\n\t\t\t//store.setState({\r\n\t\t\t//  currentUser: user,\r\n\t\t\t//});\r\n\t\t})\r\n\t\t.catch((error) => {\r\n\t\t\tconsole.log(error)\r\n\t\t\t//handleError(error);\r\n\t\t\trouter.go('/sign-in');\r\n\t\t});\r\n\t}\r\n}\r\n\r\nexport default new AuthorizationController();","//Страница авторизации\r\n\r\nimport Form, { FormParams, onSubmitForm } from '../elements/form-block';\r\nimport Input, { InputParams } from '../elements/input-block';\r\nimport Button, { ButtonParams } from '../elements/button-block';\r\n\r\nimport { router } from '../utilities/createRouter';\r\n\r\nimport AuthorizationController from '../controllers/AuthorizationController';\r\n\r\nconst documentTitle = \"Вход\";\r\n\r\nconst authorizationForm: FormParams = {\r\n\ttitle: 'Вход',\r\n};\r\n\r\nconst authorizationInputs: InputParams[] = [\r\n\t{\r\n\t\telement: '.reg-form-fieldset',\r\n\t\tid: 'login',\r\n\t\tname: 'login',\r\n\t\tlabel: 'Логин',\r\n\t\tvalue: '',\r\n\t\ttype: 'text',\r\n\t\trequired: true,\r\n\t\terrorText: 'Обязательное поле',\r\n\t\tvalidationType: '',\r\n\t\tclassList: '',\r\n\t},\r\n\t{\r\n\t\telement: '.reg-form-fieldset',\r\n\t\tid: 'password',\r\n\t\tname: 'password',\r\n\t\tlabel: 'Пароль',\r\n\t\tvalue: '',\r\n\t\ttype: 'password',\r\n\t\trequired: true,\r\n\t\terrorText: 'Обязательное поле',\r\n\t\tvalidationType: '',\r\n\t\tclassList: '',\r\n\t},\r\n];\r\n\r\nconst authorizationButtons: ButtonParams[] = [\r\n\t{\r\n\t\telement: '.buttons-wrapper',\r\n\t\tid: '',\r\n\t\tname: 'Авторизоваться',\r\n\t\tclasses: 'add-link',\r\n\t\tonClick: (event) => {\r\n\t\t\tevent.preventDefault();\r\n\t\t\tonSubmitForm('.reg-form', function(formData){\r\n\t\t\t\tAuthorizationController.signIn(formData, function(error){\r\n\t\t\t\t\tdocument.getElementById(\"formInfoBlock\").textContent = error;\r\n\t\t\t\t});\r\n\t\t\t});\t\t\t\r\n\t\t},\r\n\t},\r\n\t{\r\n\t\telement: '.buttons-wrapper',\r\n\t\tid: '',\r\n\t\tname: 'Зарегистрироваться',\r\n\t\tclasses: 'reg-link',\r\n\t\tonClick: (event) => {\r\n\t\t\tevent.preventDefault();\r\n\t\t\trouter.go('/sign-up');\r\n\t\t},\r\n\t},\r\n];\r\n\r\nexport default function(): void {\r\n\r\n\tdocument.title = documentTitle;\r\n\r\n\tnew Form(authorizationForm).insertBlock(\"#app\", true);\r\n\r\n\tauthorizationInputs.forEach(function(input) {\r\n\t\tnew Input(input, '').insertBlock(input.element);\r\n\t});\r\n\r\n\tauthorizationButtons.forEach(function(button) {\r\n\t\tnew Button(button).insertBlock(button.element);\r\n\t});\r\n\r\n\t\r\n}","//Блок textarea\r\n\r\nimport Block from '../elements/block';\r\n\r\nconst textareaBlockTemplate = `\r\n\t<div class=\"form-block\">\r\n\t\t<textarea id=\"{{id}}\"  data-required=\"{{required}}\" name=\"{{name}}\" value=\"{{value}}\"></textarea>\r\n\t</div>\r\n\t`;\r\n\r\nexport type TextareaParams = {\r\n\telement: string,\r\n\tid: string,\r\n\tname: string,\r\n\tvalue: string,\r\n\trequired: boolean,\r\n}\r\n\r\nexport default class Textarea extends Block {\r\n\t//params: InputParams\r\n\r\n\tconstructor(params: TextareaParams, template: string) {\r\n\t\tif (!template){\r\n\t\t\ttemplate = textareaBlockTemplate;\r\n\t\t}\r\n\t\tsuper(params, template);\r\n\t}\r\n\r\n\tinsertBlock(element: string, clean: boolean): Record<string, HTMLElement> {\r\n\r\n\t\tconst insertedBlock = super.insertBlock(element, clean);\r\n\t\tif (insertedBlock.inner){\r\n\t\t\tconst textarea = insertedBlock.inner.querySelector('textarea');\r\n\t\t\tif (textarea){\r\n\t\t\t\ttextarea.addEventListener('focus', function(){\r\n\t\t\t\t\tthis.classList.add('focus-input');\r\n\t\t\t\t});\r\n\t\t\t\ttextarea.addEventListener('blur', function(){\r\n\t\t\t\t\tthis.classList.remove('focus-input');\r\n\t\t\t\t});\r\n\t\t\t}\r\n\t\t}\r\n\t\treturn insertedBlock;\r\n\t}\r\n}","//Блок кнопки добавления файла\r\n\r\nimport Button from '../elements/button-block';\r\n\r\nconst addFileBlockTemplate = `\r\n<label for=\"{{id}}\" title=\"Прикрепить файл\" class=\"button-link {{classes}}\">\r\n\t{{name}}\r\n\t<input class=\"load-image\" hidden accept=\"image/*\" type=\"file\" id=\"{{id}}\" value=\"{{value}}\" name=\"file\">\r\n</label>`;\r\n\r\nexport type AddFileButtonParams = {\r\n\telement: string,\r\n\tid: string,\r\n\tclasses: string,\r\n\tname: string,\r\n\tvalue: string,\r\n\tonClick: (event: Event) => void,\r\n\tonChange: (event: Event) => void,\r\n}\r\n\r\nexport default class AddFileButton extends Button {\r\n\tconstructor(params: AddFileButtonParams, template: string) {\r\n\t\tif (!template){\r\n\t\t\ttemplate = addFileBlockTemplate;\r\n\t\t}\r\n\t\tsuper(params, template);\r\n\t}\r\n\r\n\tinsertBlock(element: string, clean: boolean): Record<string, HTMLElement> {\r\n\t\tconst insertedBlock = super.insertBlock(element, clean);\r\n\t\tif (insertedBlock.inner){\r\n\t\t\tconst innerInput = insertedBlock.inner.querySelector('input');\r\n\t\t\tif (innerInput){\r\n\t\t\t\tinnerInput.addEventListener('change', this.props.onChange);\r\n\t\t\t}\r\n\t\t}\r\n\t\treturn insertedBlock;\r\n\t}\r\n}","//Блок ссылки\r\n\r\nimport Block from '../elements/block';\r\n\r\nconst linkBlockTemplate = `<a id=\"{{id}}\" class=\"{{classes}}\" href=\"{{href}}\">{{name}}</a>`;\r\n\r\nexport type LinkParams = {\r\n\telement: string,\r\n\tid: string,\r\n\tclasses: string,\r\n\tname: string,\r\n\thref: string,\r\n\tonClick: (event: Event) => void\r\n}\r\n\r\nexport default class Link extends Block {\r\n\r\n\tconstructor(params: LinkParams, template: string, noTagName: boolean = false) {\r\n\t\tif (!template){\r\n\t\t\ttemplate = linkBlockTemplate;\r\n\t\t}\r\n\t\tsuper(params, template, noTagName);\r\n\t}\r\n\r\n\tinsertBlock(element: string, clean: boolean): Record<string, HTMLElement> {\r\n\t\tconst insertedBlock = super.insertBlock(element, clean);\r\n\t\tif (insertedBlock.inner){\r\n\t\t\tinsertedBlock.inner.addEventListener('click', this.props.onClick);\r\n\t\t\tinsertedBlock.inner.addEventListener('touchstart', this.props.onClick);\r\n\t\t}\r\n\t\treturn insertedBlock;\r\n\t}\r\n}","//Блок ссылки в меню\r\n\r\nimport Link from '../elements/link-block';\r\n\r\nconst menuLinkBlockTemplate = `<li><a id=\"{{id}}\" class=\"{{classes}}\" href=\"{{href}}\">{{name}}</a></li>`;\r\n\r\nexport type MenuLinkParams = {\r\n\telement: string,\r\n\tid: string,\r\n\tclasses: string,\r\n\tname: string,\r\n\thref: string,\r\n\tonClick: (event: Event) => void\r\n}\r\n\r\nexport default class MenuLink extends Link {\r\n\r\n\tconstructor(params: MenuLinkParams, template: string, noTagName: boolean = true) {\r\n\t\tif (!template){\r\n\t\t\ttemplate = menuLinkBlockTemplate;\r\n\t\t}\r\n\t\tsuper(params, template, noTagName);\r\n\t}\r\n}","//Блок чата (общий)\r\n\r\nimport Block from '../elements/block';\r\n\r\nconst chatWrapperTemplate = `\r\n\t<div class=\"chat-form-page clear\">\r\n\t\t<div class=\"chat-list-column\" id=\"chatList\">\r\n\t\t\t<div class=\"profile-block clear\"></div>\r\n\t\t\t<ul class=\"menu-list none-block\" id=\"menuBlock\"></ul>\r\n\t\t\t<!--<form class=\"search-wrapper\">\r\n\t\t\t\t<input class=\"input-styles search-input\" type=\"text\" placeholder=\"Поиск\" name=\"search\">\r\n\t\t\t</form> -->\r\n\t\t\t<div class=\"chat-list\" id=\"chatListBlock\"></div>\r\n\t\t</div>\r\n\t\t<div class=\"chat-full-block\" id=\"chatFullBlock\">\r\n\t\t\t<div class=\"chat-full-name\"></div>\r\n\t\t\t<div class=\"select-chat-wrapper\" id=\"selectChat\">\r\n\t\t\t\t<div class=\"select-chat-cell\">\r\n\t\t\t\t\t<span>Выберите чат</span>\r\n\t\t\t\t</div>\r\n\t\t\t</div>\r\n\t\t\t<div class=\"chat-wrapper\" id=\"chatWrapper\"><div class=\"chat\" id=\"chat\"></div></div>\r\n\t\t</div>\r\n\t</div>\r\n\t`;\r\n\r\nexport type ChatParams = Record<string, unknown>;\r\n\r\nexport default class Chat extends Block {\r\n\r\n\tconstructor(params: ChatParams, template: string) {\r\n\t\tif (!template){\r\n\t\t\ttemplate = chatWrapperTemplate;\r\n\t\t}\r\n\t\tsuper(params, template);\r\n\t}\r\n}","//Блок чата (пользователь)\r\n\r\nimport Block from '../elements/block';\r\n\r\nconst chatBlockTemplate = `\r\n\t<div class=\"chat-block\" id=\"{{id}}\" data-user-name=\"{{name}}\">\r\n\t\t<div class=\"chat-photo-wrapper\">\r\n\t\t\t<img class=\"chat-photo\" src=\"{{photoLink}}\" alt=\"{{photoAlt}}\">\r\n\t\t</div>\r\n\t\t<div class=\"chat-name\">{{name}}</div>\r\n\t\t<div class=\"chat-preview-text\">\r\n\t\t\t<strong class=\"{{fromMeHideClass}}\">Вы: </strong>\r\n\t\t\t<span>{{text}}</span>\r\n\t\t</div>\r\n\t\t<div class=\"chat-time\">{{time}}</div>\r\n\t\t<div class=\"new-messages-info {{newMessageHideClass}}\">{{newMessageCount}}</div>\r\n\t\t<a class=\"delete-chat-button\" href=\"#\">X</a>\r\n\t</div>`;\r\n\r\nexport type ChatBlockParams = {\r\n\telement: string,\r\n\tid: string,\r\n\tphotoLink: string,\r\n\tphotoAlt: string,\r\n\tname: string,\r\n\tfromMeHideClass: string,\r\n\ttext: string,\r\n\ttime: string,\r\n\tnewMessageHideClass: string,\r\n\tnewMessageCount: number,\r\n\tonClick: (this, event: Event) => void\r\n};\r\n\r\nexport default class ChatBlock extends Block {\r\n\r\n\tconstructor(params: ChatBlockParams, template: string) {\r\n\t\tif (!template){\r\n\t\t\ttemplate = chatBlockTemplate;\r\n\t\t}\r\n\t\tsuper(params, template);\r\n\t}\r\n\r\n\tinsertBlock(element: string, clean: boolean): Record<string, HTMLElement> {\r\n\t\tconst insertedBlock = super.insertBlock(element, clean);\r\n\t\tif (insertedBlock.inner){\r\n\t\t\tinsertedBlock.inner.addEventListener('click', this.props.onClick);\r\n\t\t}\r\n\t\treturn insertedBlock;\r\n\t}\r\n}","//Имя чата\r\n\r\nimport Block from '../elements/block';\r\n\r\nconst chatNameTemplate = `{{name}}`;\r\n\r\nexport type ChatNameData = {\r\n\telement: string,\r\n\tname: string,\r\n};\r\n\r\nexport default class ChatName extends Block {\r\n\r\n\tconstructor(params: ChatNameData, template: string) {\r\n\t\tif (!template){\r\n\t\t\ttemplate = chatNameTemplate;\r\n\t\t}\r\n\t\tsuper(params, template);\r\n\t}\r\n}","//Названия файлов\r\n\r\nimport Block from '../elements/block';\r\n\r\nconst filesNameTemplate = `<div class=\"files-names\">{{name}}</div>`;\r\n\r\nexport type FilesNameData = {\r\n\telement: string,\r\n\tname: string,\r\n};\r\n\r\nexport default class FilesName extends Block {\r\n\r\n\tconstructor(params: FilesNameData, template: string) {\r\n\t\tif (!template){\r\n\t\t\ttemplate = filesNameTemplate;\r\n\t\t}\r\n\t\tsuper(params, template);\r\n\t}\r\n}","//Блок сообщения\r\n\r\nimport Block from '../elements/block';\r\n\r\nconst messageBlockTemplate = `\r\n\t<div class=\"chat-message-wrapper {{toMeClass}}\">\r\n\t\t<div class=\"chat-message-block\">\r\n\t\t\t<div class=\"chat-message-time\">{{time}}</div>\r\n\t\t\t<div>\r\n\t\t\t\t{{text}}\r\n\t\t\t</div>\r\n\t\t</div>\r\n\t</div>`;\r\n\r\nexport type MessageBlockParams = {\r\n\telement: string,\r\n\ttoMeClass: string, //message-to-me\r\n\ttext: string,\r\n\ttime: string,\r\n};\r\n\r\nexport default class MessageBlock extends Block {\r\n\r\n\tconstructor(params: MessageBlockParams, template: string) {\r\n\t\tif (!template){\r\n\t\t\ttemplate = messageBlockTemplate;\r\n\t\t}\r\n\t\tsuper(params, template);\r\n\t}\r\n\r\n}","//Блок модального окна\r\n\r\nimport Block from '../elements/block';\r\n//import Input, { InputParams } from '../elements/input-block'; - может пригодиться позже при использовании форм в окне\r\n\r\nconst modalTemplate = `\r\n\t<div class=\"warning-message-wrapper warning-on\" id=\"{{id}}\">\r\n\t\t<div class=\"warning-message-table\">\r\n\t\t\t<div class=\"warning-message-block\">\r\n\t\t\t\t<div class=\"warning-message\">\r\n\t\t\t\t\t\t<span>{{MessageText}}</span>\r\n\t\t\t\t\t\t<!--<div class=\"form-block\">\r\n\t\t\t\t\t\t\t<label>Логин</label>\r\n\t\t\t\t\t\t\t<div class=\"input-wrapper\">\r\n\t\t\t\t\t\t\t\t<input class=\"form-control input-styles\" type=\"text\">\r\n\t\t\t\t\t\t\t\t<div class=\"error-text-block none-block\"></div>\r\n\t\t\t\t\t\t\t</div>\r\n\t\t\t\t\t\t</div>-->\r\n\t\t\t\t\t<div class=\"warning-buttons-wrapper\"></div>\r\n\t\t\t\t</div>\r\n\t\t\t</div>\r\n\t\t</div>\r\n\t</div>`;\r\n\r\nexport type ModalParams = {\r\n\telement: string,\r\n\tid: string,\r\n\tMessageText: string,\r\n};\r\n\r\nexport default class Modal extends Block {\r\n\r\n\tconstructor(params: ModalParams, template: string) {\r\n\t\tif (!template){\r\n\t\t\ttemplate = modalTemplate;\r\n\t\t}\r\n\t\tsuper(params, template);\r\n\t}\r\n}","import APIBase from './apiBase';\r\nimport { ChatCreateInterface, ChatAddUserInterface } from '../interfaces/interfaces';\r\n\r\nclass APIChats extends APIBase {\r\n\tconstructor() {\r\n\t\tsuper('','/chats');\r\n\t}\r\n\r\n\tcreateChat(data: ChatCreateInterface) {\r\n\t\treturn this.post('/', {\r\n\t\t\twithCredentials: true,\r\n\t\t\tdata: JSON.stringify(data),\r\n\t\t});\r\n\t}\r\n\r\n\tgetChats() {\r\n\t\treturn this.get('/', {\r\n\t\t\twithCredentials: true,\r\n\t\t});\r\n\t}\r\n\r\n\tdeleteChat(chatId: number) {\r\n\t\treturn this.delete('/', {\r\n\t\t\twithCredentials: true,\r\n\t\t\tdata: JSON.stringify({ chatId }),\r\n\t\t});\r\n\t}\r\n\r\n\taddUsersToChat(data: ChatAddUserInterface) {\r\n\t\treturn this.put('/users', {\r\n\t\t\twithCredentials: true,\r\n\t\t\tdata: JSON.stringify(data),\r\n\t\t});\r\n\t}\r\n\r\n\tdeleteUsersFromChat(data: ChatAddUserInterface) {\r\n\t\treturn this.delete('/users', {\r\n\t\t\twithCredentials: true,\r\n\t\t\tdata: JSON.stringify(data),\r\n\t\t});\r\n\t}\r\n\r\n\trequestTokenToConnect(chatId: number) {\r\n\t\treturn this.post(`/token/${chatId}`, {\r\n\t\t\twithCredentials: true,\r\n\t\t});\r\n\t}\r\n\r\n\tgetChatUsers(chatId: number) {\r\n\t\treturn this.get(`/${chatId}/users`, {\r\n\t\t\twithCredentials: true,\r\n\t\t});\r\n\t}\r\n}\r\n\r\nexport default new APIChats();","export function showBodyMask(){\r\n\tdocument.getElementById(\"app\").classList.add('loading');\r\n}\r\n\r\nexport function hideBodyMask(){\r\n\tdocument.getElementById(\"app\").classList.remove('loading');\r\n}","import apiChats from '../api/apiChats';\r\nimport { router } from '../utilities/createRouter';\r\nimport { ChatCreateInterface, ChatAddUserInterface } from '../interfaces/interfaces';\r\nimport { showBodyMask, hideBodyMask } from '../utilities/effects';\r\n\r\nfunction afterChatAnswer(answer, callback, redirect: string){\r\n\tif (answer.error && callback){\r\n\t\tif (answer.reason){\r\n\t\t\tcallback(answer.reason);\r\n\t\t} else {\r\n\t\t\tcallback(answer.error);\r\n\t\t}\t\t\t\t\r\n\t} else {\r\n\t\tif (redirect){\r\n\t\t\trouter.go(redirect);\r\n\t\t}\t\t\r\n\t}\t\r\n}\r\n\r\nfunction afterChatError(error, callback, redirect: string){\r\n\tif (error.response && callback){\r\n\t\tcallback(error.response);\r\n\t} else {\r\n\t\trouter.go(redirect);\r\n\t}\r\n\thideBodyMask();\r\n}\r\n\r\nclass ChatController {\r\n\r\n\tgetChats(callback) {\r\n    \tshowBodyMask();\r\n\t    return apiChats.getChats()\r\n\t\t.then((answer) => {\r\n\t\t\tconsole.log(answer)\r\n\t\t\tcallback(answer);\r\n\t\t\thideBodyMask();\r\n\t\t})\r\n\t\t.catch((error) => {\r\n\t\t\trouter.go('/');\r\n\t\t\tconsole.error(error);\r\n\t\t\tafterChatError(error);\r\n\t\t});\r\n\t}\r\n\r\n\tcreateChat(data: ChatCreateInterface, callback) {\r\n    \tshowBodyMask();\r\n\t\treturn apiChats.createChat(data)\r\n\t\t.then((answer) => {\r\n\t\t\tconsole.log(answer)\r\n\t\t\tcallback(answer.id);\r\n\t\t\thideBodyMask();\r\n\t\t})\r\n\t\t.catch((error) => {\r\n\t\t\trouter.go('/');\r\n\t\t\tconsole.error(error);\r\n\t\t\tafterChatError(error);\r\n\t\t})\r\n  }\r\n}\r\n\r\nexport default new ChatController();","//Страница чата\r\n\r\nimport Form, { FormParams, onSubmitForm } from '../elements/form-block';\r\nimport Textarea, { TextareaParams } from '../elements/textarea-block';\r\nimport Button, { ButtonParams } from '../elements/button-block';\r\nimport AddFileButton, { AddFileButtonParams } from '../elements/add-file-block';\r\nimport Link, { LinkParams } from '../elements/link-block';\r\nimport MenuLink, { MenuLinkParams } from '../elements/menu-link-block';\r\nimport Chat, { ChatParams } from '../elements/chat-wrapper';\r\nimport ChatBlock, { ChatBlockParams } from '../elements/chat-block';\r\nimport ChatName, { ChatNameData } from '../elements/chat-name';\r\nimport FilesName, { FilesNameData } from '../elements/files-name';\r\nimport MessageBlock, { MessageBlockParams } from '../elements/message-block';\r\nimport Modal, { ModalParams } from '../elements/modal-block';\r\nimport Input, { InputParams } from '../elements/input-block';\r\n\r\nimport {showError} from './error'; //может пригодиться передача параметров ошибки в {showError}\r\nimport profile from './profile';\r\n\r\nimport AuthorizationController from '../controllers/AuthorizationController';\r\nimport ChatController from '../controllers/ChatController';\r\n\r\nimport { router } from '../utilities/createRouter';\r\n\r\n\r\nconst documentTitle = \"Чат\";\r\n\r\nconst chatParams: ChatParams = {};\r\nlet chatName: ChatName;\r\nconst chatNameParams: ChatNameData = {\r\n\telement: '.chat-full-name',\r\n\tname: '',\r\n};\r\n\r\nconst sendForm: FormParams = {\r\n\ttitle: ''\r\n};\r\n\r\nlet textArea: Textarea;\r\nlet filesName: FilesName;\r\nconst filesNameParams: FilesNameData = {\r\n\telement: '.chat-send-box',\r\n\tname: '',\r\n};\r\nconst sendButton: ButtonParams = {\r\n\telement: '.chat-send-box',\r\n\tid: '',\r\n\tname: ' >',\r\n\tclasses: 'chat-send-button',\r\n\tonClick: (event) => {\r\n\t\tevent.preventDefault();\r\n\t\tonSubmitForm('.chat-send-box', function(){\r\n\t\t\treloadChatSender();\r\n\t\t});\r\n\t},\r\n};\r\n\r\nlet addFile: AddFileButton;\r\nconst addFileButton: AddFileButtonParams = {\r\n\telement: '.chat-send-box',\r\n\tid: 'addFileToMessage',\r\n\tname: '📎',\r\n\tclasses: 'add-file-button',\r\n\tvalue: '',\r\n\tonClick: (event) => {\r\n\t\treturn event;\r\n\t},\r\n\tonChange: (event) => {\r\n\t\tif (event.target && event.target.value){\r\n\t\t\tconst valueArray: [] = event.target.value.split(\"\\\\\");\r\n\t\t\tfilesName.setProps({ name: valueArray[valueArray.length - 1] });\r\n\t\t}\r\n\t},\r\n};\r\n\r\nconst menuLinks: MenuLinkParams[] = [\r\n\t{\r\n\t\telement: '.menu-list',\r\n\t\tid: '',\r\n\t\tclasses: 'create-chat-link',\r\n\t\tname: 'Создать чат',\r\n\t\thref: '#',\r\n\t\tonClick: (event) => {\r\n\t\t\tevent.preventDefault();\r\n\t\t\tcreateChatClick(event);\r\n\r\n\t\t\t//showError({\ttitle: 'Ошибка 400', errorText: 'Неверный запрос'}, chat); //передача параметров ошибки\r\n\r\n\t\t},\r\n\t},\r\n\t{\r\n\t\telement: '.menu-list',\r\n\t\tid: '',\r\n\t\tclasses: 'create-chat-link',\r\n\t\tname: 'Мой профиль',\r\n\t\thref: '/settings',\r\n\t\tonClick: (event) => {\r\n\t\t\tevent.preventDefault();\r\n\t\t\trouter.go('/settings');\t\r\n\t\t},\r\n\t},\r\n\t{\r\n\t\telement: '.menu-list',\r\n\t\tid: '',\r\n\t\tclasses: 'create-chat-link',\r\n\t\tname: 'Выход',\r\n\t\thref: '/',\r\n\t\tonClick: (event) => {\r\n\t\t\tevent.preventDefault();\r\n\t\t\tAuthorizationController.signOut();\t\t\r\n\t\t},\r\n\t},\r\n];\r\n\r\nconst chatProfileLinks: LinkParams[] = [\r\n\t{\r\n\t\telement: '.profile-block',\r\n\t\tid: '',\r\n\t\tclasses: 'create-chat-link',\r\n\t\tname: 'Меню',\r\n\t\thref: '#',\r\n\t\tonClick: (event) => {\r\n\t\t\tevent.preventDefault();\r\n\t\t\tdocument.getElementById('menuBlock').classList.toggle('none-block');\r\n\t\t},\r\n\t},\r\n\t{\r\n\t\telement: '.chat-full-name',\r\n\t\tid: '',\r\n\t\tclasses: 'chat-back-button',\r\n\t\tname: 'Закрыть',\r\n\t\thref: '#',\r\n\t\tonClick: (event) => {\r\n\t\t\tevent.preventDefault();\r\n\t\t\tdocument.getElementById(\"selectChat\").classList.remove(\"none-block\");\r\n\t\t\tdocument.getElementById(\"chatList\").classList.remove('chat-full-show');\r\n\t\t\tdocument.getElementById(\"chatFullBlock\").classList.remove('chat-full-show');\r\n\t\t},\r\n\t},\r\n];\r\n\r\nconst chatList: ChatBlockParams[] = [\r\n\t{\r\n\t\telement: '.chat-list',\r\n\t\tid: '1',\r\n\t\tphotoLink: '',\r\n\t\tname: 'Андрей Андрейченков',\r\n\t\tphotoAlt: '',\r\n\t\tfromMeHideClass: 'none-block',\r\n\t\ttext: 'Круто!',\r\n\t\ttime: '15.04.2022 15:31',\r\n\t\tnewMessageHideClass: '',\r\n\t\tnewMessageCount: 10,\r\n\t\tonClick: (event) => {\r\n\t\t\tevent.preventDefault();\r\n\t\t\tonChatClick(event);\r\n\t\t},\r\n\t},\r\n\t{\r\n\t\telement: '.chat-list',\r\n\t\tid: '2',\r\n\t\tphotoLink: '',\r\n\t\tname: 'Михалыч',\r\n\t\tphotoAlt: '',\r\n\t\tfromMeHideClass: '',\r\n\t\ttext: 'Отлично!',\r\n\t\ttime: '15.04.2022 15:31',\r\n\t\tnewMessageHideClass: 'none-block',\r\n\t\tnewMessageCount: 0,\r\n\t\tonClick: (event) => {\r\n\t\t\tevent.preventDefault();\r\n\t\t\tonChatClick(event);\r\n\t\t},\r\n\t},\r\n];\r\n\r\nconst messageList: MessageBlockParams[] = [\r\n\t{\r\n\t\telement: '#chat',\r\n\t\ttoMeClass: 'message-to-me',\r\n\t\ttext: 'Lorem ipsum dolor sit amet, consectetur adipisicing elit, sed do eiusmod tempor incididunt ut labore et dolore magna aliqua. Ut enim ad minim veniam, quis nostrud exercitation ullamco laboris nisi ut aliquip ex ea commodo consequat Duis aute irure dolor in reprehenderit in voluptate velit esse cillum dolore eu fugiat nulla pariatur  Excepteur sint occaecat cupidatat non proident sunt in culpa qui officia deserunt mollit anim id est laborum.',\r\n\t\ttime: '15.04.2022 12:37',\r\n\t},\r\n\t{\r\n\t\telement: '#chat',\r\n\t\ttoMeClass: 'message-to-me',\r\n\t\ttext: 'Lorem ipsum dolor sit amet, consectetur adipisicing elit, sed do eiusmod tempor incididunt ut labore et dolore magna aliqua. Ut enim ad minim veniam, quis nostrud exercitation ullamco laboris nisi ut aliquip ex ea commodo consequat Duis aute irure dolor in reprehenderit in voluptate velit esse cillum dolore eu fugiat nulla pariatur  Excepteur sint occaecat cupidatat non proident sunt in culpa qui officia deserunt mollit anim id est laborum.',\r\n\t\ttime: '15.04.2022 12:37',\r\n\t},\r\n\t{\r\n\t\telement: '#chat',\r\n\t\ttoMeClass: '',\r\n\t\ttext: 'Lorem ipsum dolor sit amet, consectetur adipisicing elit, sed do eiusmod tempor incididunt ut labore et dolore magna aliqua. Ut enim ad minim veniam, quis nostrud exercitation ullamco laboris nisi ut aliquip ex ea commodo consequat Duis aute irure dolor in reprehenderit in voluptate velit esse cillum dolore eu fugiat nulla pariatur  Excepteur sint occaecat cupidatat non proident sunt in culpa qui officia deserunt mollit anim id est laborum.',\r\n\t\ttime: '15.04.2022 12:37',\r\n\t},\r\n];\r\n\r\nconst textareaParams: TextareaParams = {\r\n\telement: '.chat-send-box',\r\n\tid: 'chatSendBox',\r\n\tname: 'message',\r\n\tvalue: '',\r\n\trequired: true,\r\n};\r\n\r\n//Форма удаления чата\r\n\r\nconst deleteWarningMessage: ModalParams = {\r\n\telement: '#app',\r\n\tid: 'deleteWarningMessage',\r\n\tMessageText: 'Вы действительно хотите удалить этот чат?',\r\n};\r\n\r\nconst deleteButtons: ButtonParams[] = [\r\n\t{\r\n\t\telement: '.warning-buttons-wrapper',\r\n\t\tid: '',\r\n\t\tname: 'Да',\r\n\t\tclasses: 'warning-add warning-button',\r\n\t\tonClick: (event) => {\r\n\t\t\tevent.preventDefault();\r\n\t\t\t//Вызывать удаление\r\n\t\t\tdocument.getElementById(\"deleteWarningMessage\").remove();\r\n\t\t},\r\n\t},\r\n\t{\r\n\t\telement: '.warning-buttons-wrapper',\r\n\t\tid: '',\r\n\t\tname: 'Нет',\r\n\t\tclasses: 'warning-back warning-button',\r\n\t\tonClick: (event) => {\r\n\t\t\tevent.preventDefault();\r\n\t\t\tdocument.getElementById(\"deleteWarningMessage\").remove();\r\n\t\t},\r\n\t},\r\n];\r\n\r\n//Форма создания чата\r\n\r\nconst createChatModal: ModalParams = {\r\n\telement: '#app',\r\n\tid: 'createChatModal',\r\n\tMessageText: '',\r\n};\r\n\r\nconst createChatForm: FormParams = {\r\n\ttitle: 'Создать чат',\r\n};\r\n\r\nconst createChatInputs: InputParams[] = [\r\n\t{\r\n\t\telement: '#createChatModal .reg-form-fieldset',\r\n\t\tid: 'chatName',\r\n\t\tname: 'title',\r\n\t\tlabel: 'Название',\r\n\t\tvalue: '',\r\n\t\ttype: 'text',\r\n\t\trequired: true,\r\n\t\terrorText: 'Обязательное поле',\r\n\t\tvalidationType: '',\r\n\t\tclassList: '',\r\n\t},\r\n];\r\n\r\nconst createChatButtons: ButtonParams[] = [\r\n\t{\r\n\t\telement: '#createChatModal .buttons-wrapper',\r\n\t\tid: '',\r\n\t\tname: 'Создать',\r\n\t\tclasses: 'add-link',\r\n\t\tonClick: (event) => {\r\n\t\t\tevent.preventDefault();\r\n\t\t\tonSubmitForm('#createChatModal .reg-form', function(formData){\r\n\t\t\t\tconsole.log(formData)\r\n\t\t\t\tChatController.createChat(formData, function(answer){\r\n\t\t\t\t\tconsole.log(answer)\r\n\t\t\t\t\treloadChatList();\r\n\t\t\t\t\tdocument.getElementById(\"createChatModal\").remove();\r\n\t\t\t\t});\r\n\t\t\t});\t\t\t\r\n\t\t},\r\n\t},\r\n\t{\r\n\t\telement: '#createChatModal .buttons-wrapper',\r\n\t\tid: '',\r\n\t\tname: 'Отмена',\r\n\t\tclasses: 'reg-link',\r\n\t\tonClick: (event) => {\r\n\t\t\tevent.preventDefault();\r\n\t\t\tdocument.getElementById(\"createChatModal\").remove();\r\n\t\t},\r\n\t},\r\n];\r\n\r\nfunction createChatClick(event){\r\n\tnew Modal(createChatModal).insertBlock(\"#app\");\r\n\tnew Form(createChatForm).insertBlock(\"#createChatModal\", true);\r\n\r\n\tcreateChatInputs.forEach(function(input) {\r\n\t\tnew Input(input, '').insertBlock(input.element);\r\n\t});\r\n\r\n\tcreateChatButtons.forEach(function(button) {\r\n\t\tnew Button(button).insertBlock(button.element);\r\n\t});\r\n}\r\n\r\n\r\nfunction onChatClick(event){\r\n\tconst chatBlock: HTMLElement = event.target.closest(\".chat-block\");\r\n\tconst chatWrapper : HTMLElement = document.getElementById(\"chatWrapper\");\r\n\tif (!chatBlock || !chatWrapper) return;\r\n\r\n\tif (event.target.classList.contains(\"delete-chat-button\")){\r\n\t\tnew Modal(deleteWarningMessage).insertBlock(\"#app\");\r\n\t\tdeleteButtons.forEach(function(button) {\r\n\t\t\tnew Button(button, '').insertBlock(button.element);\r\n\t\t});\r\n\t} else {\r\n\t\tdocument.getElementById(\"chatList\").classList.toggle('chat-full-show');\r\n\t\tdocument.getElementById('menuBlock').classList.add('none-block');\r\n\t\tdocument.getElementById(\"selectChat\").classList.add(\"none-block\");\r\n\t\tdocument.getElementById(\"chatFullBlock\").classList.toggle('chat-full-show');\r\n\r\n\t\tdocument.getElementById(\"chat\").innerHTML = \"\";\r\n\t\tmessageList.forEach(function(message){\r\n\t\t\tnew MessageBlock(message, '').insertBlock(message.element, false, true);\r\n\t\t});\r\n\t\treloadChatSender();\r\n\t\tchatWrapper.scrollTop = chatWrapper.scrollHeight;\r\n\t\tif (chatName){\r\n\t\t\tchatName.setProps({ name: chatBlock.getAttribute(\"data-user-name\") });\r\n\t\t}\r\n\r\n\t}\r\n}\r\n\r\nfunction reloadChatSender(){\r\n\ttextArea.setProps({ value: \"\" });\r\n\tfilesName.setProps({ name: \"\" });\r\n}\r\n\r\nfunction reloadChatList(){\r\n\tdocument.getElementById(\"chatListBlock\").textContent = \"\";\r\n\r\n\tChatController.getChats(function(answer){\r\n\t\tconsole.log(answer)\r\n\t\tchatList.forEach(function(chat){\r\n\t\t\tnew ChatBlock(chat, '').insertBlock(chat.element);\r\n\t\t});\r\n\t});\r\n}\r\n\r\nexport function chat(): void {\r\n\r\n\tdocument.title = documentTitle;\r\n\r\n\tnew Chat(chatParams).insertBlock(\"#app\", true);\r\n\t\r\n\tchatName = new ChatName(chatNameParams);\r\n\tchatName.insertBlock('.chat-full-name');\r\n\r\n\tchatProfileLinks.forEach(function(link) {\r\n\t\tnew Link(link, '').insertBlock(link.element);\r\n\t});\r\n\r\n\tmenuLinks.forEach(function(link) {\r\n\t\tnew MenuLink(link, '').insertBlock(link.element);\r\n\t});\r\n\r\n\treloadChatList()\r\n\t\r\n\tnew Form(sendForm, '<form class=\"chat-send-box\"></form>').insertBlock(\".chat-full-block\");\r\n\tnew Button(sendButton).insertBlock(\".chat-send-box\");\r\n\r\n\taddFile = new AddFileButton(addFileButton, '');\r\n\taddFile.insertBlock(\".chat-send-box\");\r\n\r\n\ttextArea = new Textarea(textareaParams);\r\n\ttextArea.insertBlock(\".chat-send-box\");\r\n\r\n\tfilesName = new FilesName(filesNameParams);\r\n\tfilesName.insertBlock(\".chat-send-box\");\r\n}","//Страница регистрации\r\n\r\nimport Form, { FormParams, onSubmitForm } from '../elements/form-block';\r\nimport Input, { InputParams } from '../elements/input-block';\r\nimport Button, { ButtonParams } from '../elements/button-block';\r\n\r\nimport AuthorizationController from '../controllers/AuthorizationController';\r\n\r\nconst documentTitle = \"Регистрация\";\r\n\r\nconst registrationForm: FormParams = {\r\n\ttitle: 'Регистрация'\r\n};\r\n\r\nconst registrationInputs: InputParams[] = [\r\n\t{\r\n\t\telement: '.reg-form-fieldset',\r\n\t\tid: 'email',\r\n\t\tname: 'email',\r\n\t\tlabel: 'E-mail',\r\n\t\tvalue: '',\r\n\t\ttype: 'text',\r\n\t\trequired: true,\r\n\t\terrorText: 'Неверный формат email',\r\n\t\tvalidationType: 'email',\r\n\t\tclassList: '',\r\n\t},\r\n\t{\r\n\t\telement: '.reg-form-fieldset',\r\n\t\tid: 'login',\r\n\t\tname: 'login',\r\n\t\tlabel: 'Логин',\r\n\t\tvalue: '',\r\n\t\ttype: 'text',\r\n\t\trequired: true,\r\n\t\terrorText: 'Логин должен содержать от 3 до 20 латинских символов, может содержать цифры, но не состоять из них, без пробелов, без спецсимволов',\r\n\t\tvalidationType: 'login',\r\n\t\tclassList: '',\r\n\t},\r\n\t{\r\n\t\telement: '.reg-form-fieldset',\r\n\t\tid: 'secondName',\r\n\t\tname: 'second_name',\r\n\t\tlabel: 'Фамилия',\r\n\t\tvalue: '',\r\n\t\ttype: 'text',\r\n\t\trequired: true,\r\n\t\terrorText: 'Первая буква должна быть заглавной, без пробелов, цифр и спецсимволов, кроме дефиса',\r\n\t\tvalidationType: 'name',\r\n\t\tclassList: '',\r\n\t},\r\n\t{\r\n\t\telement: '.reg-form-fieldset',\r\n\t\tid: 'firstName',\r\n\t\tname: 'first_name',\r\n\t\tlabel: 'Имя',\r\n\t\tvalue: '',\r\n\t\ttype: 'text',\r\n\t\trequired: true,\r\n\t\terrorText: 'Первая буква должна быть заглавной, без пробелов, цифр и спецсимволов, кроме дефиса',\r\n\t\tvalidationType: 'name',\r\n\t\tclassList: '',\r\n\t},\r\n\t{\r\n\t\telement: '.reg-form-fieldset',\r\n\t\tid: 'phone',\r\n\t\tname: 'phone',\r\n\t\tlabel: 'Телефон',\r\n\t\tvalue: '',\r\n\t\ttype: 'text',\r\n\t\trequired: true,\r\n\t\terrorText: 'Телефон должен содержать от 10 до 15 символов, состоит из цифр, может начинаться с плюса',\r\n\t\tvalidationType: 'phone',\r\n\t\tclassList: '',\r\n\t},\r\n\t{\r\n\t\telement: '.reg-form-fieldset',\r\n\t\tid: 'password',\r\n\t\tname: 'password',\r\n\t\tlabel: 'Пароль',\r\n\t\tvalue: '',\r\n\t\ttype: 'password',\r\n\t\trequired: true,\r\n\t\terrorText: 'Пароль должен содержать от 8 до 40 символов, обязательно хотя бы одну заглавную букву и цифру',\r\n\t\tvalidationType: 'password',\r\n\t\tclassList: '',\r\n\t},\r\n\t{\r\n\t\telement: '.reg-form-fieldset',\r\n\t\tid: 'repeatPassword',\r\n\t\tname: 'repeat_password',\r\n\t\tlabel: 'Повторите пароль',\r\n\t\tvalue: '',\r\n\t\ttype: 'password',\r\n\t\trequired: true,\r\n\t\terrorText: 'Пароль должен содержать от 8 до 40 символов, обязательно хотя бы одну заглавную букву и цифру',\r\n\t\tvalidationType: 'password',\r\n\t\tclassList: '',\r\n\t},\r\n];\r\n\r\nconst registrationButtons: ButtonParams[] = [\r\n\t{\r\n\t\telement: '.buttons-wrapper',\r\n\t\tid: '',\r\n\t\tname: 'Зарегистрироваться',\r\n\t\tclasses: 'add-link',\r\n\t\tonClick: (event) => {\r\n\t\t\tevent.preventDefault();\r\n\t\t\tonSubmitForm('.reg-form', function(formData){\r\n\t\t\t\tAuthorizationController.signUp(formData, function(error){\r\n\t\t\t\t\tdocument.getElementById(\"formInfoBlock\").textContent = error;\r\n\t\t\t\t});\r\n\t\t\t});\r\n\t\t},\r\n\t},\r\n\t{\r\n\t\telement: '.buttons-wrapper',\r\n\t\tid: '',\r\n\t\tname: 'Назад',\r\n\t\tclasses: 'reg-link',\r\n\t\tonClick: (event) => {\r\n\t\t\tevent.preventDefault();\r\n\t\t\twindow.history.back();\r\n\t\t},\r\n\t},\r\n];\r\n\r\nexport default function(): void {\r\n\r\n\tdocument.title = documentTitle;\r\n\t//window.history.pushState('', '', 'registration');\r\n\r\n\tnew Form(registrationForm).insertBlock(\"#app\", true);\r\n\r\n\tregistrationInputs.forEach(function(input) {\r\n\t\tnew Input(input).insertBlock(input.element);\r\n\t});\r\n\r\n\tregistrationButtons.forEach(function(button) {\r\n\t\tnew Button(button).insertBlock(button.element);\r\n\t});\r\n}","//Блок загрузки изображения\r\n\r\nimport Block from '../elements/block';\r\n\r\nconst inputImageTemplate = `\r\n\t<label class=\"image-form-block\" for=\"{{id}}\">\r\n\t\t<input class=\"load-image\" hidden accept=\"image/*\" type=\"file\" id=\"{{id}}\">\r\n\t\t<img id=\"{{id}}\" src=\"{{imageLink}}\" alt=\"{{imageAlt}}\" title=\"{{imageTitle}}\">\r\n\t</label>`;\r\n\r\nexport type InputImageParams = {\r\n\telement: string,\r\n\tid: string,\r\n\timageLink: string,\r\n\timageAlt: string,\r\n\timageTitle: string,\r\n}\r\n\r\nexport default class ImageInput extends Block {\r\n\r\n\tconstructor(params: InputImageParams, template: string) {\r\n\t\tif (!template){\r\n\t\t\ttemplate = inputImageTemplate;\r\n\t\t}\r\n\t\tsuper(params, template);\r\n\t}\r\n\r\n}","//Страница профиля\r\n\r\nimport Form, { FormParams, onSubmitForm } from '../elements/form-block';\r\nimport Input, { InputParams } from '../elements/input-block';\r\nimport Button, { ButtonParams } from '../elements/button-block';\r\nimport ImageInput, { InputImageParams } from '../elements/image-input-block';\r\nimport { chat } from './chat';\r\n\r\nconst documentTitle = \"Мой профиль\";\r\n\r\nconst profileForm: FormParams = {\r\n\ttitle: ''\r\n};\r\n\r\nconst profileImageInputs: InputImageParams[] = [\r\n\t{\r\n\t\telement: '.reg-form-fieldset',\r\n\t\tid: 'photoImageUpload',\r\n\t\timageLink: '#',\r\n\t\timageAlt: '',\r\n\t\timageTitle: '',\r\n\t}\r\n];\r\n\r\nconst profileInputs: InputParams[] = [\r\n\t{\r\n\t\telement: '.reg-form-fieldset',\r\n\t\tid: 'email',\r\n\t\tname: 'email',\r\n\t\tlabel: 'E-mail',\r\n\t\tvalue: '',\r\n\t\ttype: 'text',\r\n\t\trequired: true,\r\n\t\terrorText: 'Неверный формат email',\r\n\t\tvalidationType: 'email',\r\n\t\tclassList: '',\r\n\t},\r\n\t{\r\n\t\telement: '.reg-form-fieldset',\r\n\t\tid: 'login',\r\n\t\tname: 'login',\r\n\t\tlabel: 'Логин',\r\n\t\tvalue: '',\r\n\t\ttype: 'text',\r\n\t\trequired: true,\r\n\t\terrorText: 'Логин должен содержать от 3 до 20 латинских символов, может содержать цифры, но не состоять из них, без пробелов, без спецсимволов',\r\n\t\tvalidationType: 'login',\r\n\t\tclassList: '',\r\n\t},\r\n\t{\r\n\t\telement: '.reg-form-fieldset',\r\n\t\tid: 'secondName',\r\n\t\tname: 'second_name',\r\n\t\tlabel: 'Фамилия',\r\n\t\tvalue: '',\r\n\t\ttype: 'text',\r\n\t\trequired: true,\r\n\t\terrorText: 'Первая буква должна быть заглавной, без пробелов, цифр и спецсимволов, кроме дефиса',\r\n\t\tvalidationType: 'name',\r\n\t\tclassList: '',\r\n\t},\r\n\t{\r\n\t\telement: '.reg-form-fieldset',\r\n\t\tid: 'firstName',\r\n\t\tname: 'first_name',\r\n\t\tlabel: 'Имя',\r\n\t\tvalue: '',\r\n\t\ttype: 'text',\r\n\t\trequired: true,\r\n\t\terrorText: 'Первая буква должна быть заглавной, без пробелов, цифр и спецсимволов, кроме дефиса',\r\n\t\tvalidationType: 'name',\r\n\t\tclassList: '',\r\n\t},\r\n\t{\r\n\t\telement: '.reg-form-fieldset',\r\n\t\tid: 'phone',\r\n\t\tname: 'phone',\r\n\t\tlabel: 'Телефон',\r\n\t\tvalue: '',\r\n\t\ttype: 'text',\r\n\t\trequired: true,\r\n\t\terrorText: 'Телефон должен содержать от 10 до 15 символов, состоит из цифр, может начинаться с плюса',\r\n\t\tvalidationType: 'phone',\r\n\t\tclassList: '',\r\n\t},\r\n];\r\n\r\nconst changePasswordButtons: ButtonParams[] = [\r\n\t{\r\n\t\telement: '.reg-form-fieldset',\r\n\t\tid: 'changePasswordButton',\r\n\t\tname: 'Изменить пароль',\r\n\t\tclasses: 'reg-link',\r\n\t\tonClick: (event) => {\r\n\t\t\tevent.preventDefault();\r\n\t\t\tconst changePasswordButton = document.getElementById(event.target.getAttribute('id'));\r\n\t\t\tlet showElement = changePasswordButton.parentElement.nextElementSibling;\r\n\t\t\twhile (showElement){\r\n\t\t\t\tshowElement.children[0].classList.remove(\"none-block\");\r\n\t\t\t\tshowElement = showElement.nextElementSibling;\r\n\t\t\t}\r\n\t\t},\r\n\t},\r\n];\r\n\r\nconst changePasswordInputs: InputParams[] = [\r\n\t{\r\n\t\telement: '.reg-form-fieldset',\r\n\t\tid: 'oldPassword',\r\n\t\tname: 'old_password',\r\n\t\tlabel: 'Старый пароль',\r\n\t\tvalue: '',\r\n\t\ttype: 'password',\r\n\t\trequired: true,\r\n\t\terrorText: 'Пароль должен содержать от 8 до 40 символов, обязательно хотя бы одну заглавную букву и цифру',\r\n\t\tvalidationType: 'password',\r\n\t\tclassList: 'none-block',\r\n\t},\r\n\t{\r\n\t\telement: '.reg-form-fieldset',\r\n\t\tid: 'password',\r\n\t\tname: 'password',\r\n\t\tlabel: 'Пароль',\r\n\t\tvalue: '',\r\n\t\ttype: 'password',\r\n\t\trequired: true,\r\n\t\terrorText: 'Пароль должен содержать от 8 до 40 символов, обязательно хотя бы одну заглавную букву и цифру',\r\n\t\tvalidationType: 'password',\r\n\t\tclassList: 'none-block',\r\n\t},\r\n\t{\r\n\t\telement: '.reg-form-fieldset',\r\n\t\tid: 'repeatPassword',\r\n\t\tname: 'repeat_password',\r\n\t\tlabel: 'Повторите пароль',\r\n\t\tvalue: '',\r\n\t\ttype: 'password',\r\n\t\trequired: true,\r\n\t\terrorText: 'Пароль должен содержать от 8 до 40 символов, обязательно хотя бы одну заглавную букву и цифру',\r\n\t\tvalidationType: 'password',\r\n\t\tclassList: 'none-block',\r\n\t},\r\n];\r\n\r\nconst profileButtons: ButtonParams[] = [\r\n\t{\r\n\t\telement: '.buttons-wrapper',\r\n\t\tid: '',\r\n\t\tname: 'Изменить данные',\r\n\t\tclasses: 'add-link',\r\n\t\tonClick: (event) => {\r\n\t\t\tevent.preventDefault();\r\n\t\t\tonSubmitForm('.reg-form', function(){\r\n\t\t\t\tchat();\r\n\t\t\t});\r\n\t\t},\r\n\t},\r\n\t{\r\n\t\telement: '.buttons-wrapper',\r\n\t\tid: '',\r\n\t\tname: 'Назад',\r\n\t\tclasses: 'reg-link',\r\n\t\tonClick: (event) => {\r\n\t\t\tevent.preventDefault();\r\n\t\t\tchat();\r\n\t\t},\r\n\t},\r\n];\r\n\r\nexport default function(): void {\r\n\r\n\tdocument.title = documentTitle;\r\n\r\n\tnew Form(profileForm).insertBlock(\"#app\", true);\r\n\r\n\tprofileImageInputs.forEach(function(imageInput) {\r\n\t\tnew ImageInput(imageInput).insertBlock(imageInput.element);\r\n\t});\r\n\r\n\tprofileInputs.forEach(function(input) {\r\n\t\tnew Input(input).insertBlock(input.element);\r\n\t});\r\n\r\n\tchangePasswordButtons.forEach(function(button) {\r\n\t\tnew Button(button).insertBlock(button.element);\r\n\t});\r\n\r\n\tchangePasswordInputs.forEach(function(input) {\r\n\t\tnew Input(input).insertBlock(input.element);\r\n\t});\r\n\r\n\tprofileButtons.forEach(function(button) {\r\n\t\tnew Button(button).insertBlock(button.element);\r\n\t});\r\n}","//Блок ошибки\r\n\r\nimport Block from '../elements/block';\r\n\r\n//<a class=\"warning-add warning-button\" href=\"chat.html\">Назад</a>-\r\n\r\nconst errorBlockTemplate = `\r\n\t<div class=\"warning-message-wrapper warning-on\">\r\n\t\t<div class=\"warning-message-table\">\r\n\t\t\t<div class=\"warning-message-block\">\r\n\t\t\t\t<div class=\"loader none-block\">//убрать none-block для показа</div>\r\n\t\t\t\t<div class=\"error-message warning-message\">\r\n\t\t\t\t\t<div class=\"error-message-header\">{{title}}</div>\r\n\t\t\t\t\t<span>{{errorText}}</span>\r\n\t\t\t\t\t<div class=\"warning-buttons-wrapper\">\r\n\t\t\t\t\t</div>\r\n\t\t\t\t</div>\r\n\t\t\t</div>\r\n\t\t</div>\r\n\t</div>`;\r\n\r\nexport type ErrorParams = {\r\n\ttitle: string,\r\n\terrorText: string\r\n};\r\n\r\nexport default class Error extends Block {\r\n\r\n\tconstructor(params: ErrorParams, template: string) {\r\n\t\tif (!template){\r\n\t\t\ttemplate = errorBlockTemplate;\r\n\t\t}\r\n\t\tsuper(params, template);\r\n\t}\r\n\r\n}","//Страница ошибки\r\n\r\nimport Button, { ButtonParams } from '../elements/button-block';\r\nimport Error, { ErrorParams } from '../elements/error-block';\r\nimport authorization from './authorization';\r\n\r\nconst documentTitle = \"Ошибка\";\r\n\r\nconst errorBlock: ErrorParams = {\r\n\ttitle: 'Ошибка 404',\r\n\terrorText: 'Страница не найдена'\r\n};\r\n\r\nconst errorButtons: ButtonParams[] = [\r\n\t{\r\n\t\telement: '.warning-buttons-wrapper',\r\n\t\tid: '',\r\n\t\tname: 'Назад',\r\n\t\tclasses: 'warning-add warning-button',\r\n\t\tonClick: (event) => {\r\n\t\t\tevent.preventDefault();\r\n\t\t\terrorBackFunction();\r\n\t\t},\r\n\t},\r\n];\r\n\r\nlet errorBackFunction = function(): void{\r\n\twindow.history.back();\r\n}\r\n\r\nexport function showError(InnerErrorParams: ErrorParams, innerBackFunction, innerErrorButtons: ButtonParams): void {\r\n\tif (!InnerErrorParams){\r\n\t\tInnerErrorParams = errorBlock;\r\n\t}\r\n\r\n\tif (window.location.pathname == \"/500\"){\r\n\t\tInnerErrorParams.title = \"Ошибка 500\";\r\n\t\tInnerErrorParams.errorText = 'Внутренняя ошибка сервера';\r\n\t}\r\n\r\n\tif (!innerErrorButtons){\r\n\t\tinnerErrorButtons = errorButtons;\r\n\t}\r\n\t\r\n\tif (innerBackFunction){\r\n\t\terrorBackFunction = innerBackFunction;\r\n\t}\r\n\r\n\tdocument.title = documentTitle + ': ' + InnerErrorParams.title;\r\n\r\n\tnew Error(InnerErrorParams).insertBlock(\"#app\", true);\r\n\r\n\terrorButtons.forEach(function(button) {\r\n\t\tnew Button(button).insertBlock(button.element);\r\n\t});\r\n}\r\n\r\nexport default function(): void {\r\n\tshowError(errorBlock, errorBackFunction, errorButtons);\t\r\n}","import './scss/init.scss';\r\nimport authorization from './pages/authorization';\r\nimport { chat } from './pages/chat';\r\nimport registration from './pages/registration';\r\nimport profile from './pages/profile';\r\nimport error from './pages/error';\r\n\r\nimport AuthorizationController from './controllers/AuthorizationController';\r\n\r\nimport { router } from './utilities/createRouter';\r\n\r\nrouter\r\n\t.use('/', authorization)\r\n\t.use('/authorization', authorization)\r\n\t.use('/messenger', chat)\r\n\t.use('/settings', profile)\r\n\t.use('/sign-up', registration)\r\n\t.use('*', error)\r\n\t.start();\r\n\r\nAuthorizationController.checkAuth()"],"names":["$ea179994c2e62f0e$export$2e2bcd8739ae039","TEMPLATE_REGULAR","templateBlock","constructor","this","generateTemplate","template","changeTemplateKeys","tmp","templateRegular","templateKeys","exec","templateKey","templateValue","toString","replace","$520553f39a89de5b$export$5087227eb54526","listeners","on","event","callback","push","off","Error","filter","listener","emit","args","Event","forEach","$2f12cd551daa3e41$export$2e2bcd8739ae039","static","INIT","FLOW_CDM","FLOW_CDU","FLOW_RENDER","_element","params","noTagName","tagName","eventBus","_meta","props","_makePropsProxy","_registerEvents","EVENTS","init","bind","_componentDidMount","_componentDidUpdate","_render","_createResources","_createDocumentElement","componentDidMount","dispatchComponentDidMoun","oldProps","newProps","componentDidUpdate","setProps","nextProps","Object","assign","element","block","render","innerHTML","getContent","self","Proxy","get","target","property","set","value","deleteProperty","document","createElement","show","style","display","hide","destroy","remove","onDestroy","insertBlock","clean","prepend","inner","wrapper","querySelector","children","el","querySelectorAll","removeAttribute","appendChild","$c06e06c0e2a8e299$var$validationRegex","email","RegExp","login","name","phone","password","$c06e06c0e2a8e299$export$5ca26c99531348ec","input","validationType","getAttribute","errorText","regex","inputWrapper","parentElement","errorBlock","test","classList","add","textContent","$160682af531b0660$export$163d82ae5407ed7c","selector","form","formBlocks","infoBlock","isFormValid","repeatPassword","formBlock","contains","errorWrapper","super","insertedBlock","addEventListener","$56aaf2b78fa10785$export$2e2bcd8739ae039","onClick","$e049113238d296bf$export$2e2bcd8739ae039","pathname","view","blockClass","getPathname","leave","keys","length","match","lhs","rhs","query","root","$e049113238d296bf$var$renderBlock","rootQuery","$f7abdd8828430f42$var$Router","__instance","routes","_pathnames","_unprotectedPaths","history","window","_currentRoute","_rootQuery","_onRouteCallback","currentRoute","use","route","_hasRoute","includes","start","onpopstate","location","_onRoute","pathname1","getRoute","paths","pushState","back","forward","find","getLocationPathname","$3640a77ef4a67b72$export$5375cda95f0b0eb4","$a90dceee7ff5eef9$var$METHODS","$a90dceee7ff5eef9$export$2e2bcd8739ae039","url","options","request","method","timeout","post","put","delete","Promise","resolve","reject","xhr","XMLHttpRequest","console","log","data","open","result","key","$a90dceee7ff5eef9$var$queryStringify","headers","setRequestHeader","withCredentials","onload","onabort","onerror","ontimeout","send","$5603592c59cd1199$var$defaultHeaders","$5603592c59cd1199$export$2e2bcd8739ae039","baseHref","path","http","getPath","handleOptions","newOptions","handleResponse","res","response","ok","JSON","parse","getHeaders","endpoint","then","$ff1af15fd4b7f57b$export$2e2bcd8739ae039","signIn","stringify","signUp","checkAuth","signOut","$a6c54bf277e1edfa$export$2e2bcd8739ae039","user","answer","reason","go","catch","error","$9d66ae0e255a5bf1$var$authorizationForm","title","$9d66ae0e255a5bf1$var$authorizationInputs","id","label","type","required","$9d66ae0e255a5bf1$var$authorizationButtons","classes","preventDefault","formData","getElementById","$9d66ae0e255a5bf1$export$2e2bcd8739ae039","$160682af531b0660$export$2e2bcd8739ae039","$3b5868aba66e82f2$export$2e2bcd8739ae039","button","textarea","$941d3e236f2f3ab7$export$2e2bcd8739ae039","innerInput","onChange","$304d99fcbd5f2de6$export$2e2bcd8739ae039","$d2392d2d9d026022$export$2e2bcd8739ae039","$35007161c04abc5d$export$2e2bcd8739ae039","$7036ceb11834fbf6$export$2e2bcd8739ae039","$bcc170c5f9e480c2$export$2e2bcd8739ae039","createChat","getChats","deleteChat","chatId","addUsersToChat","deleteUsersFromChat","requestTokenToConnect","getChatUsers","$daba33ec390ac02e$export$7fdd5d21bf342ca5","$daba33ec390ac02e$export$ed216e442c6c98fa","$e5b6ff9cddc779b4$var$afterChatError","redirect","$e5b6ff9cddc779b4$export$2e2bcd8739ae039","$02abb5fcca8ec534$var$chatParams","$02abb5fcca8ec534$var$chatName","$02abb5fcca8ec534$var$chatNameParams","$02abb5fcca8ec534$var$sendForm","$02abb5fcca8ec534$var$textArea","$02abb5fcca8ec534$var$filesName","$02abb5fcca8ec534$var$filesNameParams","$02abb5fcca8ec534$var$sendButton","$02abb5fcca8ec534$var$reloadChatSender","$02abb5fcca8ec534$var$addFile","$02abb5fcca8ec534$var$addFileButton","valueArray","split","$02abb5fcca8ec534$var$menuLinks","href","$2bf7bed257cd7c2d$export$2e2bcd8739ae039","$02abb5fcca8ec534$var$createChatModal","$02abb5fcca8ec534$var$createChatForm","$02abb5fcca8ec534$var$createChatInputs","$02abb5fcca8ec534$var$createChatButtons","$02abb5fcca8ec534$var$chatProfileLinks","toggle","$02abb5fcca8ec534$var$chatList","photoLink","photoAlt","fromMeHideClass","text","time","newMessageHideClass","newMessageCount","$02abb5fcca8ec534$var$onChatClick","$02abb5fcca8ec534$var$messageList","toMeClass","$02abb5fcca8ec534$var$textareaParams","$02abb5fcca8ec534$var$deleteWarningMessage","MessageText","$02abb5fcca8ec534$var$deleteButtons","$02abb5fcca8ec534$var$reloadChatList","chatBlock","closest","chatWrapper","message","$19124f774463db32$export$2e2bcd8739ae039","scrollTop","scrollHeight","$02abb5fcca8ec534$export$530dccc8e24f4e99","$07e628826b80842c$export$2e2bcd8739ae039","$1b9a869b90a3ae4b$export$2e2bcd8739ae039","link","$21c29699499f144f$export$2e2bcd8739ae039","$fb81a59f87df34a9$var$registrationForm","$fb81a59f87df34a9$var$registrationInputs","$fb81a59f87df34a9$var$registrationButtons","$dfaf1c831bb1ea13$export$2e2bcd8739ae039","$3187ea00653b05f0$var$profileForm","$3187ea00653b05f0$var$profileImageInputs","imageLink","imageAlt","imageTitle","$3187ea00653b05f0$var$profileInputs","$3187ea00653b05f0$var$changePasswordButtons","showElement","nextElementSibling","$3187ea00653b05f0$var$changePasswordInputs","$3187ea00653b05f0$var$profileButtons","$ef2bdb53c468de7b$var$errorBlock","$ef2bdb53c468de7b$var$errorButtons","$ef2bdb53c468de7b$var$errorBackFunction","imageInput","InnerErrorParams","innerBackFunction","innerErrorButtons","$ef2bdb53c468de7b$var$documentTitle","$880dd279761bf785$export$2e2bcd8739ae039"],"version":3,"file":"index.ee066659.js.map","sourceRoot":"../"}